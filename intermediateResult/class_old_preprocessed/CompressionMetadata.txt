licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra compress import java import java util hash map import java util map import org apach cassandra config configur import org apach cassandra sstabl compon import org apach cassandra sstabl descriptor import org apach cassandra util file util import org apach cassandra util big long array hold metadata compress file public class compress metadata public final long data length public final long compress file length privat final big long array chunk offset public final string index file path public final compress paramet paramet creat metadata compress file includ uncompress data length chunk size list chunk offset compress data expens oper don creat sstabl param data file path path compress file return metadata compress file public static compress metadata creat string data file path descriptor desc descriptor filenam data file path tri return compress metadata desc filenam compon file data file path length catch throw error packag protect becaus test compress metadata string index file path long compress length throw index file path index file path data input stream stream data input stream file input stream index file path string compressor stream read int option count stream read int map string string option hash map string string int option count string key stream read string valu stream read option put key valu int chunk length stream read int tri paramet compress paramet compressor chunk length option catch configur throw runtim creat compress paramet store paramet data length stream read long compress file length compress length chunk offset read chunk offset stream file util close quiet stream public compressor compressor return paramet sstabl compressor public int chunk length return paramet chunk length read offset individu chunk input param input sourc data return collect chunk offset throw java ani error privat big long array read chunk offset data input input throw int chunk count input read int big long array offset big long array chunk count int chunk count tri offset set input read long catch throw string format corrupt index file read expect chunk index file path chunk count return offset chunk compress data offset length correspond posit param posit posit file return pair chunk offset length throw java ani error public chunk chunk long posit throw posit chunk int idx int posit paramet chunk length idx chunk offset size throw long chunk offset chunk offset idx long chunk offset idx chunk offset size compress file length chunk offset idx return chunk chunk offset int chunk offset chunk offset byte reserv checksum public static class writer extend random access file place uncompress data length index file privat long data length offset public writer string path throw super path public void write header compress paramet paramet throw algorithm write paramet sstabl compressor class simpl write int paramet option size map entri string string entri paramet option entri set write entri key write entri valu store length chunk write int paramet chunk length store posit reserv place uncompress data length chunk count data length offset file pointer write long write int public void final header long data length int chunk throw assert data length offset write header wasn call long current posit file pointer seek data length posit seek data length offset write uncompress data length chunk count write long data length write int chunk seek previous posit seek current posit chunk offset index param chunk index index chunk return offset chunk compress file throw ani error public long chunk offset int chunk index throw data length offset throw illeg state write header wasn call long posit file pointer seek posit chunk seek data length offset size reserv uncompress data length size reserv chunk count chunk index tri return read long final origin posit seek posit reset writer chunk offset written code chunk index public void reset truncat int chunk index throw seek data length offset size reserv uncompress data length size reserv chunk count chunk index channel truncat file pointer hold offset length file chunk public static class chunk public final long offset public final int length public chunk long offset int length offset offset length length public string string return string format chunk offset length offset length 