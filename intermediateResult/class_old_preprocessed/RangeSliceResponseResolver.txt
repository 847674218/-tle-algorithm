licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra servic import java import java net inet address import java util import java util concurr link block queue import googl common collect abstract iter import org slf logger import org slf logger factori import org apach cassandra column famili import org apach cassandra decor key import org apach cassandra rang slice repli import org apach cassandra row import org apach cassandra net async result import org apach cassandra net messag import org apach cassandra util pair import org apach cassandra util closeabl iter import org apach cassandra util merg iter turn rang slice repli object row string map resolv column famili set read repair necessari public class rang slice respons resolv implement respons resolv iter row privat static final logger logger logger factori logger rang slice respons resolv class privat static final compar pair row inet address pair compar compar pair row inet address public int compar pair row inet address pair row inet address return left key compar left key privat final string tabl privat list inet address sourc protect final collect messag respons link block queue messag public final list async result repair result array list async result public rang slice respons resolv string tabl tabl tabl public void set sourc list inet address endpoint sourc endpoint public list row data throw messag respons respons iter rang slice repli repli rang slice repli read respons messag bodi respons version return repli row note deseri respons time data call current issu sinc don read repair rang queri public iter row resolv throw array list row iter iter array list row iter respons size int messag respons respons rang slice repli repli rang slice repli read respons messag bodi respons version math max repli row size iter add row iter repli row iter respons row comput combin differ version repair incomplet version call close closeabl iter row iter merg iter iter pair compar reduc list row resolv row array list row iter resolv row add iter return resolv row public void preprocess messag messag respons add messag public boolean data present return respons empti privat static class row iter extend abstract iter pair row inet address implement closeabl iter pair row inet address privat final iter row iter privat final inet address sourc privat row iter iter row iter inet address sourc iter iter sourc sourc protect pair row inet address comput return iter pair row inet address iter sourc data public void close public iter messag messag return respons public int max live column throw unsupport oper privat class reduc extend merg iter reduc pair row inet address row list column famili version array list column famili sourc size list inet address version sourc array list inet address sourc size decor key key public void reduc pair row inet address current key current left key version add current left version sourc add current protect row reduc column famili resolv version size row repair resolv resolv superset version version version size sourc size add placehold row sourc didn ani data mayb schedul repair inet address sourc sourc version sourc sourc version add null version sourc add sourc resolv null version doesn null becaus call remov delet resolv super set resolv null repair result add row repair resolv schedul repair resolv tabl key version version sourc version clear version sourc clear return row key resolv 