licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra util import java data input import java data output import java import java util array import java util concurr atom atom long array import googl common base object import org apach cassandra serial public class estim histogram public static estim histogram serial serial estim histogram serial seri valu count bucket correspond bucket valu valu seri start grow time remov duplic goe default creat bucket give time resolut microsecond precis number larger bucket repres valu previous bucket offset current offset privat long bucket offset bucket element longer bucket offset element valu greater offset final atom long array bucket public estim histogram public estim histogram int bucket count offset bucket count bucket atom long array bucket offset length public estim histogram long offset long bucket data assert bucket data length offset length bucket offset offset bucket atom long array bucket data privat void offset int size bucket offset long size long bucket offset int size long math bucket offset return histogram valu correspond bucket index public long bucket offset return bucket offset increment count bucket closest param public void add long int index array binari search bucket offset index inexact match bucket higher index index els exact match good bucket increment index return count bucket long int bucket return bucket bucket param reset bucket afterward true return long current histogram bucket public long bucket boolean reset long long bucket length int bucket length bucket reset int bucket length bucket set return return smallest valu ad histogram public long min int bucket length bucket return bucket offset return return largest valu ad histogram histogram overflow return long public long max int bucket bucket length bucket bucket return long int bucket bucket return bucket offset return return histogram valu averag bucket offset weight count throw illeg state ani valu greater largest bucket threshold public long int bucket bucket length bucket bucket throw illeg state unabl comput ceil max histogram overflow long element long sum int bucket element bucket sum bucket bucket offset return long math ceil doubl sum element return total number valu public long count long sum int bucket length sum bucket return sum return true histogram overflow valu larger largest bucket bound ad public boolean overflow return bucket bucket length overrid public boolean equal object return true instanceof estim histogram return fals estim histogram estim histogram return array equal bucket offset bucket offset array equal bucket fals bucket fals overrid public int hash code return object hash code bucket offset bucket fals public static class estim histogram serial implement serial estim histogram public void serial estim histogram data output dos throw long offset bucket offset long bucket bucket fals dos write int bucket length int bucket length dos write long offset dos write long bucket public estim histogram deseri data input dis throw int size dis read int long offset long size long bucket long size int size offset dis read long bucket dis read long return estim histogram offset bucket public long serial size estim histogram object throw unsupport oper 