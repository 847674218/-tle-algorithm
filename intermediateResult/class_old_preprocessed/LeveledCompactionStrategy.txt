packag org apach cassandra compact licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java import java util import java util concurr atom atom refer import googl common annot visibl test import googl common base joiner import googl common collect import org slf logger import org slf logger factori import org apach cassandra column famili store import org apach cassandra decor key import org apach cassandra columniter column iter import org apach cassandra dht rang import org apach cassandra dht token import org apach cassandra sstabl tabl import org apach cassandra sstabl tabl reader import org apach cassandra sstabl tabl scanner import org apach cassandra notif notif import org apach cassandra notif notif consum import org apach cassandra notif tabl ad notif import org apach cassandra notif tabl list chang notif public class level compact strategi extend abstract compact strategi implement notif consum privat static final logger logger logger factori logger level compact strategi class privat static final string sstabl size visibl test final level manifest manifest privat final int max tabl size privat final atom refer level compact task task atom refer level compact task public level compact strategi column famili store cfs map string string option super cfs option int configur max tabl size option null string valu option key option null null valu tri configur max tabl size integ pars int valu catch number format logger warn string format parsabl int base default valu valu max tabl size configur max tabl size cfs data tracker subscrib logger debug subscrib data tracker manifest level manifest creat cfs max tabl size logger debug creat manifest public void shutdown super shutdown cfs data tracker unsubscrib public int level size int return manifest level size onli differ background maxim maxim explicit user request compact disabl public abstract compact task background task int befor cfs compact disabl return null return maxim task befor public abstract compact task maxim task int befor level compact task current task task current task null current task logger debug compact progress return null collect tabl reader sstabl manifest compact candid sstabl empti logger debug compact necessari return null level compact task task level compact task cfs sstabl befor max tabl size return task compar set current task task task null public abstract compact task user defin task collect tabl reader sstabl int befor throw unsupport oper level compact strategi doe user specifi compact public int estim remain task return manifest estim task public void handl notif notif notif object sender notif instanceof tabl ad notif tabl ad notif flush notif tabl ad notif notif manifest add flush notif ad els notif instanceof tabl list chang notif tabl list chang notif list chang notif tabl list chang notif notif switch list chang notif compact type cleanup scrub updat tabl shouldn promot case case case manifest replac list chang notif remov list chang notif ad break default manifest promot list chang notif remov list chang notif ad break public long max tabl size return max tabl size public boolean key exist expens set extend tabl sstabl ignor set tabl reader immut set copi manifest level return set differ sstabl ignor size manifest level count public list compact scanner scanner collect tabl reader sstabl rang token rang throw multimap integ tabl reader level array list multimap creat tabl reader sstabl sstabl level manifest level sstabl add sstabl list compact scanner scanner array list compact scanner sstabl size integ level level key set level sstabl ad data tracker level manifest sinc don level sstabl belong simpli sstabl level guarante overlap ness creat direct scanner tabl reader sstabl level level scanner add sstabl direct scanner rang els creat level scanner onli open sstabl time sort order scanner add level scanner level level rang return scanner lazili creat tabl bound scanner sstabl assum level overlap privat static class level scanner extend abstract iter column iter implement compact scanner privat final rang token rang privat final list tabl reader sstabl privat final iter tabl reader sstabl iter privat final long total length privat tabl scanner current scanner privat long posit offset public level scanner collect tabl reader sstabl rang token rang rang rang sstabl array list tabl reader sstabl collect sort sstabl tabl sstabl compar sstabl iter sstabl iter current scanner sstabl iter direct scanner rang long length tabl reader sstabl sstabl length sstabl uncompress length total length length protect column iter comput tri true current scanner return current scanner posit offset current scanner length byte current scanner close sstabl iter reset null current posit doe return wrong valu current scanner null return data current scanner sstabl iter direct scanner rang catch throw runtim public void close throw current scanner null current scanner close public long length byte return total length public long current posit return posit offset current scanner null current scanner current posit public string file return joiner join sstabl overrid public string string return string format hash code cfs column famili 