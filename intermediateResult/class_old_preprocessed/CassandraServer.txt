licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra thrift import java import java unsupport encod import java net socket address import java nio byte buffer import java nio charset charact code import java util import java util concurr timeout import java util zip data format import java util zip inflat import googl common base predic import googl common collect map import org slf logger import org slf logger factori import org antlr runtim recognit import org apach cassandra auth permiss import org apach cassandra auth permiss deni import org apach cassandra config import org apach cassandra cql statement import org apach cassandra cql queri processor import org apach cassandra import org apach cassandra context counter context import org apach cassandra filter queri path import org apach cassandra marshal marshal import org apach cassandra dht import org apach cassandra util data output buffer import org apach cassandra locat dynam endpoint snitch import org apach cassandra schedul request schedul import org apach cassandra servic import org apach cassandra util byte buffer util import org apach cassandra util pair import org apach thrift public class cassandra server implement cassandra ifac privat static logger logger logger factori logger cassandra server class privat final static int privat final static list column super column collect empti list privat final static list column collect empti list privat final static list counter column collect empti list thread local state session inform public final thread local client state client state thread local client state overrid public client state initi valu return client state request schedul perform schedul incom request privat final request schedul request schedul public cassandra server request schedul databas descriptor request schedul public client state state socket address remot socket socket session manag servic remot socket remot socket null return client state client state state socket session manag servic instanc remot socket state null state client state socket session manag servic instanc put remot socket state return state protect map decor key column famili read column famili list read command command consist level consist level throw invalid request unavail time support multipl column famili row row onli column famili map decor key column famili column famili key map hash map decor key column famili list row row tri schedul databas descriptor rpc timeout tri row storag proxi read command consist level final releas catch timeout logger debug time throw time catch throw runtim row row row column famili key map put row key row return column famili key map public list column thriftifi column collect column column column null column empti return array list column thrift column array list column column size column column column column mark delet continu column thrift column column column set valu column valu set timestamp column timestamp column instanceof expir column thrift column set ttl expir column column time live thrift column add thrift column return thrift column public list counter column thriftifi counter column collect column column column null column empti return array list counter column thrift column array list counter column column size column column column column mark delet continu assert column instanceof org apach cassandra counter column counter column thrift column counter column column counter context instanc total column valu thrift column add thrift column return thrift column public list column super column thriftifi column collect column column boolean revers order array list column super column thrift column array list column super column column size column column column column mark delet continu column instanceof org apach cassandra counter column counter column thrift column counter column column counter context instanc total column valu thrift column add column super column set counter column thrift column els column thrift column column column set valu column valu set timestamp column timestamp column instanceof expir column thrift column set ttl expir column column time live thrift column add column super column set column thrift column revers sinc intern pass result column famili object alway sort column natur order inconveni direct user storag proxi revers order collect revers thrift column return thrift column privat list column super column thriftifi super column collect column column boolean revers order boolean counter counter return thriftifi counter super column column revers order els return thriftifi super column column revers order privat list column super column thriftifi super column collect column column boolean revers order array list column super column thrift super column array list column super column column size column column column list column subcolumn thriftifi column column column subcolumn empti continu super column super column super column column subcolumn thrift super column add column super column set super column super column revers order collect revers thrift super column return thrift super column privat list column super column thriftifi counter super column collect column column boolean revers order array list column super column thrift super column array list column super column column size column column column list counter column subcolumn thriftifi counter column column column subcolumn empti continu counter super column super column counter super column column subcolumn thrift super column add column super column set counter super column super column revers order collect revers thrift super column return thrift super column privat map byte buffer list column super column slice list read command command consist level consist level throw invalid request unavail time map decor key column famili column famili read column famili command consist level map byte buffer list column super column column famili map hash map byte buffer list column super column read command command command column famili column famili storag servic partition decor key command key boolean revers order command instanceof slice read command slice read command command revers list column super column thriftifi column thriftifi column famili command queri path super column null revers order column famili map put command key thriftifi column return column famili map privat list column super column thriftifi column famili column famili boolean subcolumn onli boolean revers order null empti return subcolumn onli column column iter collect column subcolumn column column subcolumn null subcolumn empti return els return thriftifi column subcolumn revers order super boolean counter metadata default valid commut return thriftifi super column sort column revers order counter els return thriftifi column sort column revers order public list column super column slice byte buffer key column parent column parent slice predic predic consist level consist level throw invalid request unavail time logger debug slice client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss return multiget slice intern keyspac collect singleton list key column parent predic consist level key public map byte buffer list column super column multiget slice list byte buffer key column parent column parent slice predic predic consist level consist level throw invalid request unavail time logger debug multiget slice client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss return multiget slice intern keyspac key column parent predic consist level privat map byte buffer list column super column multiget slice intern string keyspac list byte buffer key column parent column parent slice predic predic consist level consist level throw invalid request unavail time meta data metadata thrift valid valid column famili keyspac column parent column famili thrift valid valid column parent metadata column parent thrift valid valid predic metadata column parent predic thrift valid valid consist level keyspac consist level request type list read command command array list read command key size predic column null byte buffer key key thrift valid valid key metadata key command add slice read command keyspac key column parent predic column els slice rang rang predic slice rang byte buffer key key thrift valid valid key metadata key command add slice read command keyspac key column parent rang start rang finish rang revers rang count return slice command consist level privat column super column intern byte buffer key column path column path consist level consist level throw invalid request unavail time client state state state string keyspac state keyspac state column famili access keyspac column path column famili permiss meta data metadata thrift valid valid column famili keyspac column path column famili thrift valid valid column path metadata column path thrift valid valid consist level keyspac consist level request type queri path path queri path column path column famili column path column null null column path super column list byte buffer list array list column path column null column path super column column path column thrift valid valid key metadata key read command command slice read command keyspac key path list map decor key column famili cfamili read column famili array list command consist level column famili cfamili storag servic partition decor key command key null throw list column super column tcolumn thriftifi column famili command queri path super column null fals tcolumn empti throw assert tcolumn size return tcolumn public column super column byte buffer key column path column path consist level consist level throw invalid request unavail time logger debug return intern key column path consist level public int count byte buffer key column parent column parent slice predic predic consist level consist level throw invalid request unavail time logger debug count client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss tabl tabl tabl open keyspac column famili store cfs tabl column famili store column parent column famili predic column null return slice key column parent predic consist level size int page size request page larg row cfs column int averag column size int cfs row size cfs column page size math min databas descriptor memori compact limit averag column size page size math max page size logger debug averag row column size page size averag column size page size els page size int total count list column super column column predic slice rang null predic slice rang slice rang byte buffer util byte buffer util fals integ final int request count predic slice rang count int remain request count int page true predic slice rang count math min page size math max remain fetch column column slice key column parent predic consist level column empti break byte buffer column int column page equal predic slice rang start column size column size total count column count return origin limit total count request count return request count remain column page queri number column request user fetch page onli column alreadi fetch remain column size equal predic slice rang start break els predic slice rang start column column size return total count privat static byte buffer column super column cosc return cosc set super column cosc super column cosc set column cosc column cosc set counter column cosc counter column cosc counter super column public map byte buffer integ multiget count list byte buffer key column parent column parent slice predic predic consist level consist level throw invalid request unavail time logger debug multiget count client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss map byte buffer integ count hash map byte buffer integ map byte buffer list column super column column famili map multiget slice intern keyspac key column parent predic consist level map entri byte buffer list column super column column famili map entri set count put key valu size return count privat void intern insert byte buffer key column parent column parent column column consist level consist level throw invalid request unavail time client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss meta data metadata thrift valid valid column famili keyspac column parent column famili fals thrift valid valid key metadata key thrift valid valid column parent metadata column parent super column field usual option insert metadata type column famili type super column parent super column null throw invalid request mandatori super column super column parent column famili thrift valid valid column metadata column parent array list column thrift valid valid column data metadata column column parent super column null row mutat row mutat keyspac key tri add queri path column parent column famili column parent super column column column valu column timestamp column ttl catch marshal throw invalid request messag insert consist level array list public void insert byte buffer key column parent column parent column column consist level consist level throw invalid request unavail time logger debug insert intern insert key column parent column consist level privat void intern batch mutat map byte buffer map string list mutat mutat map consist level consist level throw invalid request unavail time list string cfam array list string list mutat row mutat array list mutat client state state state string keyspac state keyspac map entri byte buffer map string list mutat mutat entri mutat map entri set byte buffer key mutat entri key separ row mutat standard counter encapsul counter mutat becaus doesn follow code path row mutat standard null row mutat counter null map string list mutat column famili mutat mutat entri valu map entri string list mutat column famili mutat column famili mutat entri set string column famili mutat key avoid unneed author cfam state column famili access keyspac permiss cfam add meta data metadata thrift valid valid column famili keyspac thrift valid valid key metadata key row mutat metadata default valid commut thrift valid valid commut write metadata consist level counter counter null row mutat keyspac key counter counter els standard standard null row mutat keyspac key standard standard mutat mutat column famili mutat valu thrift valid valid mutat metadata mutat mutat delet null delet column super column mutat delet mutat column supercolumn null add column super column mutat column supercolumn standard null standard empti row mutat add standard counter null counter empti row mutat add org apach cassandra counter mutat counter consist level insert consist level row mutat public void batch mutat map byte buffer map string list mutat mutat map consist level consist level throw invalid request unavail time logger debug batch mutat intern batch mutat mutat map consist level privat void intern remov byte buffer key column path column path long timestamp consist level consist level boolean commut throw invalid request unavail time client state state state string keyspac state keyspac state column famili access keyspac column path column famili permiss meta data metadata thrift valid valid column famili keyspac column path column famili commut thrift valid valid key metadata key thrift valid valid column path parent metadata column path commut thrift valid valid commut write metadata consist level row mutat row mutat keyspac key delet queri path column path timestamp commut insert consist level array list counter mutat consist level els insert consist level array list public void remov byte buffer key column path column path long timestamp consist level consist level throw invalid request unavail time logger debug remov intern remov key column path timestamp consist level fals privat void insert consist level consist level list extend mutat mutat throw unavail time invalid request thrift valid valid consist level state keyspac consist level request type mutat empti return tri schedul databas descriptor rpc timeout tri storag proxi mutat mutat consist level final releas catch timeout logger debug time throw time public def describ keyspac string tabl throw invalid request state keyspac access tabl permiss meta data ksm schema instanc tabl definit tabl ksm null throw return ksm thrift public list key slice rang slice column parent column parent slice predic predic key rang rang consist level consist level throw invalid request unavail time logger debug rang slice client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss meta data metadata thrift valid valid column famili keyspac column parent column famili thrift valid valid column parent metadata column parent thrift valid valid predic metadata column parent predic thrift valid valid key rang metadata column parent super column rang thrift valid valid consist level keyspac consist level request type list row row tri partition storag servic partition abstract bound row posit bound rang start key null token token factori token factori token factori token left token factori string rang start token token token factori string rang token bound rang row rang left els row posit rang key null token factori string rang token max key bound row posit key rang key bound bound row posit row posit key rang start key schedul databas descriptor rpc timeout tri row storag proxi rang slice rang slice command keyspac column parent predic bound rang row filter rang count consist level final releas assert row null catch timeout logger debug time throw time catch throw runtim return thriftifi key slice row column parent predic public list key slice page slice string column famili key rang rang byte buffer start column consist level consist level throw invalid request unavail time logger debug page slice client state state state string keyspac state keyspac state column famili access keyspac column famili permiss meta data metadata thrift valid valid column famili keyspac column famili thrift valid valid key rang metadata null rang thrift valid valid consist level keyspac consist level request type slice predic predic slice predic set slice rang slice rang start column byte buffer util fals partition storag servic partition abstract bound row posit bound rang start key null token key unsupport assum token token token token factori token factori token factori token left token factori string rang start token token token factori string rang token bound rang row rang left els row posit rang key null token factori string rang token max key bound row posit key rang key bound bound row posit row posit key rang start key list row row tri schedul databas descriptor rpc timeout tri row storag proxi rang slice rang slice command keyspac column famili null predic bound rang row filter rang count true true consist level final releas assert row null catch timeout logger debug time throw time catch throw runtim return thriftifi key slice row column parent column famili predic privat list key slice thriftifi key slice list row row column parent column parent slice predic predic list key slice key slice array list key slice row size boolean revers predic slice rang null predic slice rang revers row row row list column super column thriftifi column thriftifi column famili row column parent super column null revers key slice add key slice row key key thriftifi column return key slice public list key slice index slice column parent column parent index claus index claus slice predic column predic consist level consist level throw invalid request unavail time logger debug scan client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss meta data metadata thrift valid valid column famili keyspac column parent column famili fals thrift valid valid column parent metadata column parent thrift valid valid predic metadata column parent column predic thrift valid valid index claus metadata index claus thrift valid valid consist level keyspac consist level request type partition storag servic partition abstract bound row posit bound bound row posit row posit key index claus start key minimum token min key bound rang slice command command rang slice command keyspac column parent column famili null column predic bound index claus express index claus count list row row tri row storag proxi rang slice command consist level catch throw runtim catch timeout logger debug time throw time return thriftifi key slice row column parent column predic public list def describ keyspac throw invalid request set string keyspac schema instanc tabl list def ksset array list def keyspac size string keyspac tri ksset add describ keyspac catch permiss deni logger debug enabl logger debug permiss deni messag catch nfe logger info fail find metadata keyspac continu return ksset public string describ cluster throw return databas descriptor cluster public string describ version throw return constant public list token rang describ ring string keyspac throw invalid request return storag servic instanc describ ring keyspac public map string string describ token map throw invalid request return storag servic instanc token endpoint map public string describ partition throw return storag servic partition class public string describ snitch throw databas descriptor endpoint snitch instanceof dynam endpoint snitch return dynam endpoint snitch databas descriptor endpoint snitch subsnitch class return databas descriptor endpoint snitch class deprec public list string describ split string string start token string token int key split throw invalid request list split split describ split start token token key split list string result array list string split size result add split start token split split split result add split token return result public list split describ split string string start token string token int key split throw invalid request add keyspac author call post token token factori storag servic partition token factori rang token rang token string start token string token list pair rang token long split storag servic instanc split state keyspac key split list split result array list split split size pair rang token long split split result add split split left left string split left string split return result public void login authent request auth request throw authent author state login auth request credenti schedul current thread access requir servic privat void schedul long timeout throw timeout request schedul queue thread current thread state schedul valu timeout releas count resourc privat void releas request schedul releas public string system add column famili def def throw invalid request schema disagr logger debug add column famili state column famili access def keyspac def permiss valid schema agreement tri def unset explicit ignor ani set client hector set meta data cfm meta data thrift def cfm add default index migrat manag announc column famili cfm return schema instanc version string catch configur invalid request invalid request messag init caus throw public string system drop column famili string column famili throw invalid request schema disagr logger debug drop column famili client state state state string keyspac state keyspac state column famili access keyspac column famili permiss valid schema agreement tri migrat manag announc column famili drop keyspac column famili return schema instanc version string catch configur invalid request invalid request messag init caus throw public string system add keyspac def def throw invalid request schema disagr logger debug add keyspac thrift valid valid keyspac system def state keyspac access def permiss valid schema agreement thrift valid valid keyspac exist def generat meaning error user setup keyspac column definit incorrect def def def keyspac equal def throw invalid request def keyspac definit match def tri collect meta data def array list meta data def def size def def def def def unset explicit ignor ani set client system add column famili meta data cfm meta data thrift def cfm add default index def add cfm migrat manag announc keyspac meta data thrift def def array meta data def size return schema instanc version string catch configur invalid request invalid request messag init caus throw public string system drop keyspac string keyspac throw invalid request schema disagr logger debug drop keyspac thrift valid valid keyspac system keyspac state keyspac access keyspac permiss valid schema agreement tri migrat manag announc keyspac drop keyspac return schema instanc version string catch configur invalid request invalid request messag init caus throw updat exist keyspac column famili modif throw schema disagr public string system updat keyspac def def throw invalid request schema disagr logger debug updat keyspac thrift valid valid keyspac system def state keyspac access def permiss thrift valid valid tabl def def def null def def size throw invalid request keyspac updat ani column famili definit valid schema agreement tri migrat manag announc keyspac updat meta data thrift def return schema instanc version string catch configur invalid request invalid request messag init caus throw public string system updat column famili def def throw invalid request schema disagr logger debug updat column famili def keyspac null def null throw invalid request keyspac set state column famili access def keyspac def permiss meta data cfm schema instanc meta data def keyspac def cfm null throw invalid request find column famili definit modifi valid schema agreement tri meta data appli implicit default def meta data cfm meta data thrift def cfm add default index migrat manag announc column famili updat cfm return schema instanc version string catch configur invalid request invalid request messag init caus throw privat void valid schema agreement throw schema disagr unreach host don count disagr map string list string version map filter key storag proxi describ schema version predic predic equal storag proxi version size throw schema disagr public void truncat string cfname throw invalid request unavail time client state state state string keyspac state keyspac logger debug truncat cfname keyspac state column famili access keyspac cfname permiss tri schedul databas descriptor rpc timeout tri storag proxi truncat block keyspac cfname final releas catch timeout logger debug time throw time catch throw unavail unavail init caus public void set keyspac string keyspac throw invalid request thrift valid valid tabl keyspac state set keyspac keyspac public map string list string describ schema version throw invalid request logger debug check schema agreement return storag proxi describ schema version counter method public void add byte buffer key column parent column parent counter column column consist level consist level throw invalid request unavail time logger debug add client state state state string keyspac state keyspac state column famili access keyspac column parent column famili permiss meta data metadata thrift valid valid column famili keyspac column parent column famili true thrift valid valid key metadata key thrift valid valid commut write metadata consist level thrift valid valid column parent metadata column parent super column field usual option ad metadata type column famili type super column parent super column null throw invalid request mandatori super column super column parent column famili thrift valid valid column metadata column parent array list column row mutat row mutat keyspac key tri add counter queri path column parent column famili column parent super column column column valu catch marshal throw invalid request messag insert consist level array list counter mutat consist level public void remov counter byte buffer key column path path consist level consist level throw invalid request unavail time logger debug remov counter intern remov key path system current time milli consist level true privat static string uncompress byte buffer queri compress compress throw invalid request string queri string null decompress queri string tri switch compress case data output buffer decompress data output buffer byte buffer byte buffer byte inflat decompressor inflat int len read true decompressor input len read queri remain queri remain queri buffer len read decompressor set input buffer len read int len write len write decompressor inflat buffer decompress write buffer len write decompressor finish break decompressor queri string string decompress data decompress size break case tri queri string byte buffer util string queri catch charact code throw invalid request messag break catch data format throw invalid request error deflat queri string catch unsupport encod throw invalid request unknown queri string encod return queri string public cql result execut cql queri byte buffer queri compress compress throw invalid request unavail time schema disagr logger debug enabl logger debug execut cql queri string queri string uncompress queri compress tri client state state state state version major return queri processor process queri string state els return org apach cassandra cql queri processor process queri string state catch recognit invalid request ire invalid request invalid malform queri string ire init caus throw ire public cql prepar result prepar cql queri byte buffer queri compress compress throw invalid request logger debug enabl logger debug prepar cql queri string queri string uncompress queri compress tri client state state state state version major return queri processor prepar queri string state els return org apach cassandra cql queri processor prepar queri string state catch recognit invalid request ire invalid request invalid malform queri string ire init caus throw ire public cql result execut prepar cql queri int item list byte buffer bind variabl throw invalid request unavail time schema disagr logger debug enabl logger debug execut prepar cql queri client state state state state version major statement statement state prepar item statement null throw invalid request string format prepar queri item logger trace retriev prepar statement bind marker item statement bound term return queri processor process prepar statement state bind variabl els org apach cassandra cql statement statement state prepar item statement null throw invalid request string format prepar queri item logger trace retriev prepar statement bind marker item statement bound term return org apach cassandra cql queri processor process prepar statement state bind variabl public void set cql version string version throw invalid request logger debug set cql version version state set version version main method move cassandra daemon 