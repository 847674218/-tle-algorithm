licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra servic import java file import java error import java import java lang manag manag factori import java net inet address import java net unknown host import java nio byte buffer import java util import java util map entri import java util concurr import java util concurr atom atom integ import java util concurr atom atom long import javax manag bean server import javax manag notif import javax manag notif broadcast support import javax manag object import googl common base supplier import googl common collect import org apach cassandra metric client request metric import org apach log level import org apach common lang string util import org slf logger import org slf logger factori import org apach cassandra concurr debugg schedul thread pool executor import org apach cassandra concurr stage import org apach cassandra concurr stage manag import org apach cassandra config import org apach cassandra import org apach cassandra tabl import org apach cassandra commitlog commit log import org apach cassandra dht import org apach cassandra dht rang import org apach cassandra gms import org apach cassandra sstabl tabl delet task import org apach cassandra sstabl tabl loader import org apach cassandra util file util import org apach cassandra locat abstract replic strategi import org apach cassandra locat dynam endpoint snitch import org apach cassandra locat endpoint snitch import org apach cassandra locat token metadata import org apach cassandra net async result import org apach cassandra net messag import org apach cassandra net messag servic import org apach cassandra net respons verb handler import org apach cassandra servic anti entropi servic tree request verb handler import org apach cassandra stream import org apach cassandra thrift import org apach cassandra util util import org apach cassandra util node import org apach cassandra util pair import org apach cassandra util output handler import org apach cassandra util wrap runnabl abstract token identifi node identifi space token gossip class maintain histogram load inform node cluster public class storag servic extend notif broadcast support implement endpoint state chang subscrib storag servic bean privat static logger logger logger factori logger storag servic class public static final int ring delay delay assum ring stabliz notif serial number counter privat final atom long notif serial number atom long verb handler identifi public enum verb deprec client initi read write deprec deprec deprec deprec deprec respons intern call similar snapshot pad compat previous version valid verb futur rememb add verb sinc serial ordin public static final verb verb valu public static final enum map storag servic verb stage verb stage enum map storag servic verb stage storag servic verb class put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage doe realli belong misc copi behavior put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage put verb stage privat static int ring delay string newdelay system properti cassandra ring delay newdelay null logger info overrid newdelay return integ pars int newdelay els return pool period short task public static final debugg schedul thread pool executor schedul task debugg schedul thread pool executor schedul task pool task longer execut time usual period public static final debugg schedul thread pool executor task debugg schedul thread pool executor period task task wait shutdown drain public static final debugg schedul thread pool executor option task debugg schedul thread pool executor option task static task set execut exist delay task shutdown polici fals abstract maintain token endpoint metadata inform privat token metadata token metadata token metadata public version valu version valu factori valu factori version valu version valu factori partition public static final storag servic instanc storag servic public static partition partition return databas descriptor partition public collect rang token local rang string tabl return rang endpoint tabl util broadcast address public rang token local primari rang return primari rang endpoint util broadcast address sake local primari rang intern public list string primari rang return local primari rang list privat final set inet address replic node collect synchron set hash set inet address privat cassandra daemon daemon privat inet address remov node start node bootstrap mode privat boolean bootstrap mode bootstrap join ring told privat boolean survey mode boolean pars boolean system properti cassandra write survey fals intial client shouldn write system tabl privat boolean client mode privat boolean initi privat volatil boolean join fals privat static enum mode privat mode oper mode privat final migrat manag migrat manag migrat manag track drain progress privat volatil int total remain privat static final atom integ repair command atom integ privat final object jmx object public void finish bootstrap bootstrap mode fals method updat local token disk public void set token token token logger debug enabl logger debug set token token system tabl updat token token token metadata updat normal token token util broadcast address gossip instanc add local applic state applic state valu factori normal local token set mode mode fals public storag servic bean server mbs manag factori platform bean server tri jmx object object org apach cassandra type storag servic mbs regist bean jmx object catch throw runtim regist verb handler messag servic instanc regist verb handler verb row mutat verb handler messag servic instanc regist verb handler verb read repair verb handler messag servic instanc regist verb handler verb read verb handler messag servic instanc regist verb handler verb rang slice verb handler messag servic instanc regist verb handler verb index scan verb handler messag servic instanc regist verb handler verb counter mutat verb handler messag servic instanc regist verb handler verb truncat verb handler boot strapper summari bootstrap verb interact messag servic instanc regist verb handler verb boot strapper bootstrap token verb handler messag servic instanc regist verb handler verb stream request verb handler messag servic instanc regist verb handler verb stream repli verb handler messag servic instanc regist verb handler verb replic finish verb handler messag servic instanc regist verb handler verb respons verb handler messag servic instanc regist verb handler verb respons verb handler messag servic instanc regist verb handler verb tree request verb handler messag servic instanc regist verb handler verb anti entropi servic tree respons verb handler messag servic instanc regist verb handler verb stream repair task stream repair request messag servic instanc regist verb handler verb stream repair task stream repair respons messag servic instanc regist verb handler verb gossip digest syn verb handler messag servic instanc regist verb handler verb gossip digest ack verb handler messag servic instanc regist verb handler verb gossip digest ack verb handler messag servic instanc regist verb handler verb gossip shutdown verb handler messag servic instanc regist verb handler verb definit updat verb handler messag servic instanc regist verb handler verb schema check verb handler messag servic instanc regist verb handler verb migrat request verb handler messag servic instanc regist verb handler verb snapshot verb handler spin stream servic avail jmx tool stream servic instanc null throw runtim stream servic unavail public void regist daemon cassandra daemon daemon daemon daemon onli call public void stop gossip initi logger warn stop gossip oper request gossip instanc stop initi fals onli call public void start gossip initi logger warn start gossip oper request gossip instanc start int system current time milli initi true onli call public void start server daemon null throw illeg state configur daemon daemon start server public void stop server daemon null throw illeg state configur daemon daemon stop server public boolean server run daemon null return fals return daemon server run public void stop client gossip instanc unregist migrat manag gossip instanc unregist gossip instanc stop messag servic instanc shutdown give task accept befor messag servic shutdown submit stage avoid reject execut tri thread sleep catch interrupt stage manag shutdown public boolean initi return initi public synchron void init client throw configur init client public synchron void init client int delay throw configur initi client mode throw unsupport oper storag servic doe support switch mode return initi true client mode true logger info start client gossip set mode mode fals gossip instanc regist gossip instanc start int system current time milli node ring gather messag servic instanc listen util local address sleep gossip warm node befor repli tri thread sleep delay catch throw error schema instanc updat version announc public synchron void init server throw configur init server public synchron void init server int delay throw configur logger info cassandra version util releas version string logger info thrift version constant logger info support version string util join client state support version default client state initi client mode throw unsupport oper storag servic doe support switch mode return initi true client mode fals ensur storag proxi initi start tri class org apach cassandra servic storag proxi catch class throw assert error client mode touch metric class trigger static initi metric becom avail start client request metric boolean pars boolean system properti cassandra load ring state true logger info load persist ring state map entri token inet address entri system tabl load token entri set entri valu util local address entri mistaken ad delet system tabl remov token entri key els token metadata updat normal token entri key entri valu gossip instanc add save endpoint entri valu boolean pars boolean system properti cassandra renew counter fals logger info renew local node request node renew local daemon thread executor continu run shutdown hook invok thread drain shutdown thread wrap runnabl overrid public void run throw throw execut interrupt thread pool executor mutat stage stage manag stage stage mutat stage shutdown return drain alreadi stop server option task shutdown gossip instanc stop progress write origin generat hint written shut messag servic befor mutat stage hint save befor shut messag servic instanc shutdown mutat stage shutdown mutat stage await termin time unit storag proxi instanc verifi hint progress list futur flush array list futur tabl tabl tabl meta data ksm schema instanc meta data tabl ksm durabl write column famili store cfs tabl column famili store futur futur cfs forc flush futur null flush add futur util wait futur flush commit log instanc shutdown block wait miscellan task sstabl commitlog segment delet task shutdown task await termin time unit logger warn miscellan task executor busi minut proceed shutdown storag servic shutdown hook runtim runtim add shutdown hook drain shutdown boolean pars boolean system properti cassandra join ring true join token ring delay els logger info join ring request storag servic join ring initi ring join privat void join token ring int delay throw org apach cassandra config configur logger info start server gossip join true start gossip servic befor ani info node necessari bootstrap load info won part storag ring add node state gossip instanc regist gossip instanc regist migrat manag gossip instanc start system tabl increment generat node ring gather gossip schema empti version forc immedi check schema updat migrat manag mayb schedul schema pull schema instanc updat version announc ensur actual schema prepar updat add rpc listen info gossip instanc add local applic state applic state valu factori rpcaddress databas descriptor rpc address null databas descriptor replac token gossip instanc add local applic state applic state valu factori hibern true messag servic instanc listen util local address load broadcast instanc start broadcast gossip instanc add local applic state applic state valu factori releas version hint hand manag instanc start bootstrap haven success bootstrap befor long seed seed user manual set auto bootstrap fals skip stream data node jump direct ring seed check skip sleep singl node cluster case user test attempt replac schema presenc check meaning sleep schema info gossip defeat purpos gori detail token token inet address current null logger debug bootstrap variabl object databas descriptor auto bootstrap system tabl bootstrap progress system tabl bootstrap complet databas descriptor seed util broadcast address databas descriptor auto bootstrap system tabl bootstrap complet databas descriptor seed util broadcast address system tabl bootstrap progress logger warn detect previous bootstrap failur retri els system tabl set bootstrap state system tabl bootstrap state set mode mode wait ring inform true sleep delay peer int delay schema proceed check direct schema instanc version equal schema empti version logger debug schema schema instanc version break tri thread sleep catch interrupt throw assert error schema hasn match sleep doe post don expect necessari veri doesn hurt care migrat manag readi bootstrap set mode mode wait schema inform complet true tri thread sleep catch interrupt throw assert error set mode mode schema complet true set mode mode wait pend rang calcul true pend rang calcul servic instanc block finish set mode mode calcul complet readi bootstrap true logger debug enabl logger debug ring schema info databas descriptor replac token null token metadata member util broadcast address string node alreadi member token ring bootstrap abort replac dead node remov ring throw unsupport oper set mode mode bootstrap token true token boot strapper bootstrap token token metadata load broadcast instanc load info els tri sleep addit server actual aliv give time gossip aliv thread sleep load broadcast catch interrupt throw assert error token storag servic partition token factori string databas descriptor replac token check oper error current token metadata endpoint token null current gossip instanc endpoint state endpoint current updat timestamp system current time milli delay throw unsupport oper cannnot replac token live node set mode mode replac node token token true bootstrap token assert bootstrap mode bootstrap block finish els token system tabl save token token null string initi token databas descriptor initi token initi token null token partition random token logger warn generat random token token random token result unbalanc ring http wiki apach org cassandra oper els token partition token factori string initi token logger info save token token configur els logger info save token token survey mode start particip ring system tabl set bootstrap state system tabl bootstrap state set token token remov exist info replac node current null gossip instanc replac endpoint current logger info bootstrap replac move complet serv read assert token metadata sort token size els logger info bootstrap complet write survey mode activ becom activ ring member storag servic join ring final ring join public synchron void join ring throw org apach cassandra config configur join logger info join ring oper request join token ring els survey mode set token system tabl save token system tabl set bootstrap state system tabl bootstrap state survey mode fals logger info leav write survey mode join ring oper request assert token metadata sort token size public boolean join return join public void rebuild string sourc logger info rebuild sourc null ani sourc rang streamer streamer rang streamer token metadata util broadcast address oper type streamer add sourc filter rang streamer failur detector sourc filter failur detector instanc sourc null streamer add sourc filter rang streamer singl datacent filter databas descriptor endpoint snitch sourc string tabl schema instanc system tabl streamer add rang tabl local rang tabl streamer fetch public void set stream throughput sec int valu databas descriptor set stream throughput outbound megabit sec valu logger info setstreamthroughput throttl set valu public int stream throughput sec return databas descriptor stream throughput outbound megabit sec public int compact throughput sec return databas descriptor compact throughput sec public void set compact throughput sec int valu databas descriptor set compact throughput sec valu public boolean increment backup enabl return databas descriptor increment backup enabl public void set increment backup enabl boolean valu databas descriptor set increment backup enabl valu privat void set mode mode boolean log set mode null log privat void set mode mode string msg boolean log oper mode string log msg msg null string string format msg log logger info log msg els logger debug log msg privat void bootstrap token token throw bootstrap mode true system tabl updat token token set token part ring local incorrect bootstrap null databas descriptor replac token exist token bootstrap gossip instanc add local applic state applic state valu factori bootstrap token set mode mode sleep pend rang setup true tri thread sleep catch interrupt throw assert error els dont set ani state node bootstrap exist token token metadata updat normal token token util broadcast address set mode mode start bootstrap true boot strapper util broadcast address token token metadata bootstrap handl token updat public boolean bootstrap mode return bootstrap mode public token metadata token metadata return token metadata keyspac return rang correspond listen address param keyspac return public map list string list string rang endpoint map string keyspac rang token map list string list string map hash map list string list string map entri rang token list inet address entri rang address map keyspac entri set map put entri key list stringifi entri valu return map return rpc address associ endpoint string param endpoint endpoint rpc address return public string rpcaddress inet address endpoint endpoint equal util broadcast address return databas descriptor rpc address host address els gossip instanc endpoint state endpoint endpoint applic state applic state null return endpoint host address els return gossip instanc endpoint state endpoint endpoint applic state applic state valu keyspac return rang correspond address keyspac param keyspac return public map list string list string rang rpcaddress map string keyspac rang token map list string list string map hash map list string list string map entri rang token list inet address entri rang address map keyspac entri set list string rpcaddr array list string entri valu size inet address endpoint entri valu rpcaddr add rpcaddress endpoint map put entri key list rpcaddr return map public map list string list string pend rang endpoint map string keyspac peopl visual represent null set system tabl keyspac null keyspac schema instanc system tabl map list string list string map hash map list string list string map entri rang token collect inet address entri token metadata pend rang keyspac entri set list inet address array list inet address entri valu map put entri key list stringifi return map public map rang token list inet address rang address map string keyspac peopl visual represent null set system tabl keyspac null keyspac schema instanc system tabl list rang token rang rang token metadata sort token return construct rang endpoint map keyspac rang code describ ring string convert token rang string compat param keyspac keyspac fetch inform return list token rang convert string keyspac throw invalid request ring inform avail keyspac public list string describ ring string keyspac throw invalid request list token rang token rang describ ring keyspac list string result array list string token rang size token rang token rang token rang result add token rang string return result token rang keyspac param keyspac keyspac fetch inform return list token rang keyspac throw invalid request ring inform avail keyspac public list token rang describ ring string keyspac throw invalid request keyspac null schema instanc system tabl keyspac throw invalid request ring keyspac keyspac list token rang rang array list token rang token token factori partition token factori map entri rang token list inet address entri rang address map keyspac entri set rang rang entri key list inet address address entri valu list string endpoint array list string address size list string rpc endpoint array list string address size list endpoint detail detail array list endpoint detail address size inet address endpoint address endpoint detail detail endpoint detail detail host endpoint host address detail datacent databas descriptor endpoint snitch datacent endpoint detail rack databas descriptor endpoint snitch rack endpoint endpoint add detail host rpc endpoint add rpcaddress endpoint detail add detail token rang token rang string rang left token string rang token endpoint set endpoint detail detail set rpc endpoint rpc endpoint rang add return rang public map string string token endpoint map map token inet address map inet address token metadata normal bootstrap token endpoint map order preserv token ascend order link hash map map string string map string link hash map string string map inet address size list token token array list token map inet address key set collect sort token token token token map string put token string map inet address token host address return map string construct rang endpoint map base true view world param rang return map rang replica respons privat map rang token list inet address construct rang endpoint map string keyspac list rang token rang map rang token list inet address rang endpoint map hash map rang token list inet address rang token rang rang rang endpoint map put rang tabl open keyspac replic strategi natur endpoint rang return rang endpoint map privat map inet address collect rang token construct endpoint rang map string keyspac multimap inet address rang token endpoint rang map multimap list multimap hash map inet address collect rang token supplier list rang token public list rang token return list array list list rang token rang rang token metadata sort token rang token rang rang inet address endpoint tabl open keyspac replic strategi natur endpoint rang left endpoint rang map put endpoint rang return endpoint rang map map handl recept applic state endpoint note valu applic state necessarili chang sinc valu alreadi receiv updat somewher els chang onli applic state piec chang time mani applic state updat receiv time perform kind state machin concern event token associ endpoint oper mode node start bootstrap normal mode bootstrap mode chang mode normal node bootstrap mode pendingrang set token metadata node normal mode part token ring normal progress applic state valu node token bootstrap stay file receiv token readi serv read write token readi leav cluster part decommiss token set decommiss complet valu possibl anywher normal progress newtoken set node current move token ring deadtoken set node dead remov deadtoken set node dead remov note ani time node state chang visibl node follow bootstrap node dure removetoken decommiss move public void chang inet address endpoint applic state state version valu valu switch state case string state valu valu valu string piec state valu split version valu assert piec length string move piec move equal version valu handl state bootstrap endpoint piec els move equal version valu handl state normal endpoint piec els move equal version valu move equal version valu handl state remov endpoint piec els move equal version valu handl state leav endpoint piec els move equal version valu handl state left endpoint piec els move equal version valu handl state move endpoint piec handl node bootstrap param endpoint bootstrap node param piec bootstrap token string privat void handl state bootstrap inet address endpoint string piec assert piec length token token partition token factori string piec logger debug enabl logger debug node endpoint state bootstrap token token node present token metadata intermedi state node crash print warn clear obsolet stuff continu token metadata member endpoint leav fals howev leav true onli wait time complet leav oper rebootstrap relat short quit common time gossip spread therefor report onli log token metadata leav endpoint logger info node endpoint state jump bootstrap token metadata remov endpoint endpoint token metadata add bootstrap token token endpoint pend rang calcul servic instanc updat handl node move normal state node enter token ring particip read param endpoint node param piec token privat void handl state normal inet address endpoint string piec assert piec length token token partition token factori string piec logger debug enabl logger debug node endpoint state normal token token token metadata member endpoint logger info node endpoint state jump normal don updat node respons token startup time endpoint inet address current owner token metadata endpoint token current owner null logger debug node endpoint token token token metadata updat normal token token endpoint client mode system tabl updat token endpoint token els endpoint equal current owner set state normal sinc node tri leav fail persist token chang token metadata updat normal token token endpoint els gossip instanc compar endpoint startup endpoint current owner logger info string format node token owner endpoint current owner token endpoint token metadata updat normal token token endpoint gossip instanc remov endpoint current owner client mode system tabl updat token endpoint token els logger info string format node token ignor endpoint current owner token endpoint token metadata move endpoint endpoint move token token metadata remov move endpoint pend rang calcul servic instanc updat handl node prepar leav ring param endpoint node param piec token privat void handl state leav inet address endpoint string piec assert piec length string move valu piec token token partition token factori string move valu logger debug enabl logger debug node endpoint state leav token token node previous unknown token match updat tokenmetadata node normal token befor leav pend rang token metadata member endpoint logger info node endpoint state jump leav token metadata updat normal token token endpoint els token metadata token endpoint equal token logger warn node endpoint leav token mismatch long network partit token metadata updat normal token token endpoint point endpoint member token proceed normal token metadata add leav endpoint endpoint pend rang calcul servic instanc updat handl node leav ring happen node decommiss param endpoint reason leav decommiss endpoint leav node param piec token privat void handl state left inet address endpoint string piec assert piec length token token partition token factori string piec logger debug enabl logger debug node endpoint state left token token excis token endpoint extract expir time piec handl node move insid ring param endpoint move endpoint address param piec token privat void handl state move inet address endpoint string piec assert piec length token token partition token factori string piec logger debug enabl logger debug node endpoint state move token token token metadata add move endpoint token endpoint pend rang calcul servic instanc updat handl notif node activ remov ring removetoken param endpoint node param piec node replica restor privat void handl state remov inet address endpoint string piec assert piec length endpoint equal util broadcast address logger info receiv remov token gossip node rejoin explicit removetoken tri drain catch throw runtim return token metadata member endpoint string state piec token remov token token metadata token endpoint version valu equal state excis remov token endpoint extract expir time piec els version valu equal state logger debug enabl logger debug token remov token remov manual endpoint endpoint note endpoint remov token metadata add leav endpoint endpoint pend rang calcul servic instanc updat find endpoint coordin remov notifi string coordin gossip instanc endpoint state endpoint endpoint applic state applic state valu split version valu token coordtoken partition token factori string coordin grab ani data respons notifi respons node restor replica count endpoint token metadata endpoint coordtoken els gossip told nonexist member notifi gossip remov gossip instanc remov endpoint endpoint privat void excis token token inet address endpoint hint hand manag instanc delet hint endpoint endpoint gossip instanc remov endpoint endpoint token metadata remov endpoint endpoint token metadata remov bootstrap token token pend rang calcul servic instanc updat client mode logger info remov token token endpoint system tabl remov token token privat void excis token token inet address endpoint long expir time add expir time endpoint expir time excis token endpoint protect void add expir time inet address endpoint long expir time expir time gossip instanc add expir time endpoint endpoint expir time protect long extract expir time string piec long expir time piec length expir time long pars long piec return expir time find live endpoint respons rang param tabl tabl rang belong param rang rang find sourc return multimap address rang address respons privat multimap inet address rang token sourc rang string tabl set rang token rang inet address address util broadcast address multimap rang token inet address rang address tabl open tabl replic strategi rang address token metadata multimap inet address rang token sourc rang hash multimap creat failur detector failur detector failur detector instanc find aliv sourc rang rang token rang rang collect inet address possibl rang rang address rang endpoint snitch snitch databas descriptor endpoint snitch list inet address sourc snitch sort list proxim address possibl rang assert sourc address inet address sourc sourc failur detector aliv sourc sourc rang put sourc rang break return sourc rang send notif node indic finish replic data param local local address param remot node send notif privat void send replic notif inet address local inet address remot notifi remot token messag msg messag local storag servic verb byte gossip instanc version remot failur detector failur detector failur detector instanc logger debug enabl logger debug notifi remot string replic complet failur detector aliv remot async result iar messag servic instanc send msg remot tri iar databas descriptor rpc timeout time unit return catch timeout tri call endpoint remov ring function check node becom respons rang consequ stream data ineffect doe matter sinc call veri seldom param endpoint node left privat void restor replica count inet address endpoint final inet address notifi endpoint final multimap inet address string fetch sourc hash multimap creat multimap string map entri inet address collect rang token rang fetch hash multimap creat final inet address address util broadcast address string tabl schema instanc system tabl multimap rang token inet address chang rang chang rang leav tabl endpoint set rang token rang hash set rang token map entri rang token inet address entri chang rang entri entri valu equal address rang add entri key multimap inet address rang token sourc rang sourc rang tabl rang map entri inet address collect rang token entri sourc rang map entri set fetch sourc put entri key tabl rang fetch put tabl entri final string tabl rang fetch key set map entri inet address collect rang token entri rang fetch tabl final inet address sourc entri key collect rang token rang entri valu final stream callback callback stream callback public void success synchron fetch sourc fetch sourc remov sourc tabl fetch sourc empti send replic notif address notifi endpoint public void failur logger warn stream sourc fail success call success send notif logger debug enabl logger debug request sourc rang string util join rang stream request rang sourc tabl rang callback oper type modifi accept tabl privat multimap rang token inet address chang rang leav string tabl inet address endpoint rang leav endpoint respons collect rang token rang rang endpoint tabl endpoint logger debug enabl logger debug node endpoint rang string util join rang map rang token list inet address current replica endpoint hash map rang token list inet address find rang node store replica rang rang token rang rang current replica endpoint put rang tabl open tabl replic strategi calcul natur endpoint rang token metadata token metadata temp token metadata clone left endpoint leav leav removetoken command present temp remov temp member endpoint temp remov endpoint endpoint multimap rang token inet address chang rang hash multimap creat rang rang check store replica rang leav endpoint present replica endpoint list current replica endpoint list rang rang token rang rang collect inet address replica endpoint tabl open tabl replic strategi calcul natur endpoint rang temp replica endpoint remov current replica endpoint rang logger debug enabl replica endpoint empti logger debug rang rang alreadi replica els logger debug rang rang respons string util join replica endpoint chang rang put rang replica endpoint return chang rang public void join inet address endpoint endpoint state state map entri applic state version valu entri state applic state map entri set chang endpoint entri key entri valu public void aliv inet address endpoint endpoint state state client mode token metadata member endpoint hint hand manag instanc schedul hint deliveri endpoint public void remov inet address endpoint token metadata remov endpoint endpoint pend rang calcul servic instanc updat public void dead inet address endpoint endpoint state state messag servic instanc convict endpoint public void restart inet address endpoint endpoint state state restart befor node mark reset connect pool state aliv dead endpoint state raw load valu public doubl load doubl byte string tabl schema instanc tabl tabl tabl tabl open tabl column famili store cfs tabl column famili store byte cfs live disk space return byte public string load string return file util stringifi file size load public map string string load map map string string map hash map string string map entri inet address doubl entri load broadcast instanc load info entri set map put entri key host address file util stringifi file size entri valu gossip doesn updat special case local node map put util broadcast address host address load string return map public final void deliv hint string host throw unknown host hint hand manag instanc schedul hint deliveri host public token local token token token system tabl save token assert token null call befor init server set return token method belong bean interfac public string token return local token string public string releas version return util releas version string public string schema version return schema instanc version string public list string leav node return stringifi token metadata leav endpoint public list string move node list string endpoint array list string pair token inet address node token metadata move endpoint endpoint add node host address return endpoint public list string join node return stringifi token metadata bootstrap token valu public list string live node return stringifi gossip instanc live member public list string unreach node return stringifi gossip instanc unreach member privat static string canon path string filenam tri return file filenam canon path catch throw error public string data file locat string locat databas descriptor data file locat int locat length locat canon path locat return locat public string commit log locat return canon path databas descriptor commit log locat public string save cach locat return canon path databas descriptor save cach locat privat list string stringifi iter inet address endpoint list string string endpoint array list string inet address endpoint string endpoint add host address return string endpoint public int current generat number return gossip instanc current generat number util broadcast address public void forc tabl cleanup string tabl string column famili throw execut interrupt tabl equal tabl throw runtim cleanup system tabl necessari wise node shot renew node renew node shot renew column famili store store valid column famili tabl column famili store forc cleanup node renew public void scrub string tabl string column famili throw execut interrupt column famili store store valid column famili tabl column famili store scrub public void upgrad tabl string tabl string column famili throw execut interrupt column famili store store valid column famili tabl column famili store sstabl rewrit public void forc tabl compact string tabl string column famili throw execut interrupt column famili store store valid column famili tabl column famili store forc major compact snapshot tabl snapshot specifi param tag tag snapshot null empti param tabl tabl snapshot empti public void snapshot string tag string tabl throw tag null tag equal throw suppli snapshot iter tabl tabl tabl length tabl tabl els array list tabl array list tabl tabl length string tabl tabl add valid tabl tabl tabl check snapshot exist befor actual snapshot tabl tabl tabl tabl snapshot exist tag throw snapshot tag alreadi exist tabl tabl tabl tabl snapshot tag null snapshot specif column famili snapshot specifi param tabl keyspac hold specifi column famili param column famili column famili snapshot param tag tag snapshot null empti public void column famili snapshot string tabl string column famili string tag throw tabl null throw suppli tabl column famili null throw mus suppli column famili tag null tag equal throw suppli snapshot tabl tabl valid tabl tabl tabl snapshot exist tag throw snapshot tag alreadi exist tabl snapshot tag column famili privat tabl valid tabl string tabl throw schema instanc tabl tabl throw tabl tabl doe exist return tabl open tabl remov snapshot tabl tag specifi remov snapshot public void clear snapshot string tag string tabl throw tag null tag iter tabl tabl tabl length tabl tabl els array list tabl temp tabl array list tabl tabl length string tabl tabl temp tabl add valid tabl tabl tabl temp tabl tabl tabl tabl tabl clear snapshot tag logger debug enabl logger debug clear snapshot directori public iter column famili store valid column famili string tabl string throw tabl tabl valid tabl tabl length store interest return tabl column famili store filter interest store set column famili store valid hash set column famili store string column famili store store tabl column famili store store null pass recogn keyspac report continu logger warn string format invalid column famili specifi proceed continu valid add store return valid flush memtabl tabl column famili param tabl param column famili throw public void forc tabl flush final string tabl final string column famili throw execut interrupt column famili store store valid column famili tabl column famili logger debug forc flush keyspac tabl store column famili store forc block flush send notif subscrib param type messag type param messag messag param user object arbitrari object attach notif public void send notif string type string messag object user object notif jmx notif notif type jmx object notif serial number increment messag jmx notif set user data user object send notif jmx notif public int forc repair async final string tabl final boolean sequenti final boolean primari rang final string column famili final collect rang token rang primari rang collect singleton list local primari rang local rang tabl return forc repair async tabl sequenti rang column famili public int forc repair async final string tabl final boolean sequenti final collect rang token rang final string column famili tabl equal tabl return final int cmd repair command increment rang size thread wrap runnabl protect void run throw throw string messag string format start repair command repair rang keyspac cmd rang size tabl logger info messag send notif repair messag int cmd anti entropi servic status ordin list anti entropi servic repair futur futur array list anti entropi servic repair futur rang size rang token rang rang anti entropi servic repair futur futur tri futur forc tabl repair rang tabl sequenti column famili catch illeg argument messag string format repair session fail error send notif repair messag int cmd anti entropi servic status ordin continu futur null continu futur add futur wait session differenc befor start tri futur session differenc await catch interrupt messag interrupt wait differenc repair session futur session repair imprecis logger error messag send notif repair messag int cmd anti entropi servic status ordin anti entropi servic repair futur futur futur tri futur messag string format repair session rang finish futur session futur session rang string send notif repair messag int cmd anti entropi servic status ordin catch execut messag string format repair session rang fail error futur session futur session rang string caus messag send notif repair messag int cmd anti entropi servic status ordin catch messag string format repair session rang fail error futur session futur session rang string messag send notif repair messag int cmd anti entropi servic status ordin send notif repair string format repair command finish cmd int cmd anti entropi servic status ordin start return cmd public int forc repair rang async string token string token final string tabl boolean sequenti final string column famili token pars token partition token factori string token token pars token partition token factori string token logger info start user request repair rang keyspac column famili object pars token pars token tabl column famili return forc repair async tabl sequenti collect singleton rang token pars token pars token column famili trigger proactiv repair tabl column famili param tabl param column famili throw public void forc tabl repair final string tabl boolean sequenti final string column famili throw tabl equal tabl return collect rang token rang local rang tabl int cmd repair command increment logger info start repair command repair rang cmd rang size list anti entropi servic repair futur futur array list anti entropi servic repair futur rang size rang token rang rang anti entropi servic repair futur futur forc tabl repair rang tabl sequenti column famili futur null continu futur add futur wait session differenc befor start tri futur session differenc await catch interrupt logger error interrupt wait differenc repair session futur session repair imprecis boolean fail session fals block repair session complet anti entropi servic repair futur futur futur tri futur catch logger error repair session futur session fail fail session true fail session throw repair command cmd repair session fail log detail els logger info repair command complet success cmd public void forc tabl repair primari rang final string tabl boolean sequenti final string column famili throw tabl equal tabl return anti entropi servic repair futur futur forc tabl repair local primari rang tabl sequenti column famili futur null return tri futur catch logger error repair session futur session fail throw repair session fail log detail public void forc tabl repair rang string token string token final string tabl boolean sequenti final string column famili throw tabl equal tabl return token pars token partition token factori string token token pars token partition token factori string token logger info start user request repair rang keyspac column famili object pars token pars token tabl column famili anti entropi servic repair futur futur forc tabl repair rang token pars token pars token tabl sequenti column famili futur null return tri futur catch logger error repair session futur session fail public anti entropi servic repair futur forc tabl repair final rang token rang final string tabl boolean sequenti final string column famili throw array list string array list string column famili store store valid column famili tabl column famili add store column famili empti logger info column famili repair keyspac tabl return null return anti entropi servic instanc submit repair session rang tabl sequenti array string size public void forc termin repair session anti entropi servic instanc termin session bean interfac method method return predecessor endpoint identifi space inet address predecessor inet address token token token metadata token return token metadata endpoint token metadata predecessor token method return successor endpoint identifi space public inet address successor inet address token token token metadata token return token metadata endpoint token metadata successor token primari rang specifi endpoint param endpoint interest return rang specifi endpoint public rang token primari rang endpoint inet address return token metadata primari rang token metadata token rang endpoint respons tabl param endpoint interest return rang specifi endpoint collect rang token rang endpoint string tabl inet address return tabl open tabl replic strategi address rang rang span ring set token rang sort order rang return rang sort order public list rang token rang list token sort token logger debug enabl logger debug comput rang string util join sort token sort token empti return collect empti list int size sort token size list rang token rang array list rang token size int size rang token rang rang token sort token sort token rang add rang rang token rang rang token sort token size sort token rang add rang return rang method return endpoint respons store specifi key replic param tabl keyspac tabl param column famili param key key find endpoint return endpoint respons key public list inet address natur endpoint string tabl string string key meta data meta data schema instanc tabl definit tabl meta data return natur endpoint tabl partition token meta data key valid string key public list inet address natur endpoint string tabl byte buffer key return natur endpoint tabl partition token key method return endpoint respons store specifi key replic param tabl keyspac tabl param pos posit find endpoint return endpoint respons token public list inet address natur endpoint string tabl ring posit pos return tabl open tabl replic strategi natur endpoint pos method attempt return endpoint respons store specifi key replic param tabl keyspac tabl param key key find endpoint return endpoint respons key public list inet address live natur endpoint string tabl byte buffer key return live natur endpoint tabl partition decor key key public list inet address live natur endpoint string tabl ring posit pos list inet address endpoint tabl open tabl replic strategi natur endpoint pos list inet address live ep array list inet address endpoint size inet address endpoint endpoint failur detector instanc aliv endpoint live ep add endpoint return live ep public void set log level string class qualifi string raw level level level level level raw level org apach log logger logger class qualifi set level level logger info set log level level class class qualifi level doesn raw level log couldn pars raw level return list token rang key togeth estim key count break data node respons piec rough key split public list pair rang token long split string tabl string rang token rang int key split tabl tabl open tabl column famili store cfs column famili store list decor key key key sampl collect singleton cfs rang final long total row count estim key size databas descriptor index interv split count smaller number key sampl avoid huge sampl error final int min sampl split final int max split count key size min sampl split final int split count math max math min max split count int total row count estim key split list token token key token rang key return split token split count privat list pair rang token long split list token token int split count final doubl step doubl token size split count int prev index token prev token token list pair rang token long split list array list expect size split count int split count int index int math step token token token index long row count estim index prev index databas descriptor index interv split add pair creat rang token prev token token row count estim prev index index prev token token return split privat list token key token rang token rang list decor key key list token token list array list expect size key size token add rang left decor key key key token add key token token add rang return token privat list decor key key sampl iter column famili store cfses rang token rang list decor key key array list decor key column famili store cfs cfses iter add key cfs key sampl rang util sort sampl key key rang return key return token node bootstrap node rang public token bootstrap token rang token rang local primari rang list decor key key key sampl column famili store user defin rang token token key size token partition midpoint rang left rang logger debug midpoint assign token token els token key key size token logger debug key sampl size key size assign token token token metadata endpoint token null token metadata member token metadata endpoint token throw runtim chose token token alreadi token metadata endpoint token specifi manual initi token hack prevent give node token fine row key token token instanceof string token token string token string token token replac version valu token metadata normal bootstrap token endpoint map key token throw runtim unabl comput uniqu token node specifi manual initi token return token broadcast leav status updat local token metadata accord privat void start leav gossip instanc add local applic state applic state valu factori leav local token token metadata add leav endpoint util broadcast address pend rang calcul servic instanc updat public void decommiss throw interrupt token metadata member util broadcast address throw unsupport oper local node member token ring token metadata clone left sort token size throw unsupport oper normal node ring decommiss pointless pend rang calcul servic instanc block finish string tabl schema instanc system tabl token metadata pend rang tabl util broadcast address size throw unsupport oper data current move node unabl leav ring logger debug enabl logger debug start leav set mode mode sleep pend rang setup true thread sleep runnabl finish leav runnabl public void run stop server gossip instanc stop messag servic instanc shutdown stage manag shutdown set mode mode true respons kill process unbootstrap finish leav privat void leav ring system tabl set bootstrap state system tabl bootstrap state token metadata remov endpoint util broadcast address pend rang calcul servic instanc updat gossip instanc add local applic state applic state valu factori left local token gossip comput expir time int delay math max gossip interv milli logger info announc left ring delay tri thread sleep delay catch interrupt throw assert error privat void unbootstrap final runnabl finish map string multimap rang token inet address rang stream hash map string multimap rang token inet address final string tabl schema instanc system tabl multimap rang token inet address rang chang rang leav tabl util broadcast address logger debug enabl logger debug rang transfer string util join rang key set rang stream put tabl rang set mode mode stream data node true count latch latch stream rang rang stream wait transfer runnabl signal latch logger debug wait stream ak tri latch await catch interrupt throw runtim logger debug stream ack receiv leav ring finish run public void move string token throw interrupt configur partition token factori valid token move partition token factori string token move node token find token boot accord load param token token boot null find balanc token boot throw ani oper error privat void move token token throw token null throw move undefin null token token metadata sort token token throw target token token alreadi anoth node address current node inet address local address util broadcast address list string tabl process schema instanc system tabl pend rang calcul servic instanc block finish check data move node string tabl tabl process token metadata pend rang tabl local address size throw unsupport oper data current move node unabl leav ring gossip instanc add local applic state applic state valu factori move token set mode mode string format move local address local token token true endpoint snitch snitch databas descriptor endpoint snitch map string multimap inet address rang token rang fetch hash map string multimap inet address rang token map string multimap rang token inet address rang stream tabl hash map string multimap rang token inet address token metadata token meta clone token metadata clone settl system tabl calcul rang current node handl move token string tabl tabl process replic strategi current keyspac aka tabl abstract replic strategi strategi tabl open tabl replic strategi collect current rang keyspac collect rang token current rang rang endpoint tabl local address collect rang node serv move token collect rang token updat rang strategi pend address rang token metadata token local address ring rang endpoint associ determin node ping rang data multimap rang token inet address rang address strategi rang address token metadata calcul part rang request stream node ring pair set rang token set rang token rang tabl calcul stream fetch rang current rang updat rang loop rang fetch determin node ring respons data interest multimap rang token inet address rang fetch prefer endpoint array list multimap creat rang token fetch rang tabl rang token rang rang address key set rang fetch list inet address endpoint snitch sort list proxim local address rang address rang store rang prefer endpoint set rang fetch prefer endpoint put fetch endpoint calcul endpoint stream current rang situat node handl current rang part rang multimap rang token inet address rang endpoint hash multimap creat rang token stream rang tabl left set inet address current endpoint immut set copi strategi calcul natur endpoint stream token metadata set inet address endpoint immut set copi strategi calcul natur endpoint stream token meta clone rang endpoint put stream set differ endpoint current endpoint associ tabl rang endpoint map rang stream tabl put tabl rang endpoint multimap inet address rang token work map rang streamer work map rang fetch prefer endpoint rang fetch put tabl work map logger debug enabl logger debug tabl work map tabl work map rang stream tabl empti rang fetch empti set mode mode string format sleep befor start stream fetch rang true tri thread sleep catch interrupt throw runtim sleep interrupt messag set mode mode fetch rang stream rang true logger debug enabl logger debug move work map rang stream tabl count latch stream latch stream rang rang stream tabl logger debug enabl logger debug move work map rang fetch count latch fetch latch request rang rang fetch tri stream latch await fetch latch await catch interrupt throw runtim interrupt latch wait stream fetch rang finish messag set token token set token everyth settl logger debug enabl logger debug success move token local token status token remov public string remov status remov node null return token remov process return string format remov token wait replic confirm token metadata token remov node string util join replic node forc remov oper complet necessari remov oper block forev due node stream failur remov token call resort measur attempt restor replica public void forc remov complet replic node empti token metadata leav endpoint empti logger warn remov confirm string util join replic node inet address endpoint token metadata leav endpoint token token token metadata token endpoint gossip instanc advertis token remov endpoint token excis token endpoint replic node clear remov node null els throw unsupport oper token forc remov call removetoken remov node die attempt restor replica count node aliv decommiss attempt decommiss fail remov token call fail tri restor replica count final forc remov completeion call forcibl remov node regard replica count param token string token node public void remov token string token string inet address address util broadcast address token local token token metadata token address token token partition token factori string token string inet address endpoint token metadata endpoint token endpoint null throw unsupport oper token endpoint equal address throw unsupport oper remov node token gossip instanc live member endpoint throw unsupport oper node endpoint aliv token decommiss command remov ring leav endpoint dead alreadi remov token metadata leav endpoint logger warn node endpoint alreadi remov continu remov replic node empti throw unsupport oper node alreadi process remov wait complet removetoken forc fail find endpoint becom respons data string tabl schema instanc system tabl replic factor data lost shouldn wait confirm tabl open tabl replic strategi replic factor continu rang chang ownership node respons rang multimap rang token inet address chang rang chang rang leav tabl endpoint failur detector failur detector failur detector instanc inet address chang rang valu failur detector aliv replic node add els logger warn endpoint receiv data replic endpoint remov node endpoint token metadata add leav endpoint endpoint pend rang calcul servic instanc updat gossip handl spoof node state add token node gossip instanc advertis remov endpoint token local token kick stream command restor replica count endpoint address wait replic finish verb handler signal replic node empti tri thread sleep catch interrupt throw assert error excis token endpoint gossip indic token left gossip instanc advertis token remov endpoint token replic node clear remov node null public void confirm replic inet address node replic node empti case node remov coordin restart befor replic finish messag arriv case acknowledg replic node empti replic node remov node els logger info receiv unexpect messag node node remov coordin public boolean client mode return client mode public synchron void request unreclaim space logger info request free disk space system tri thread sleep catch interrupt throw assert error privat boolean unreclaim space column famili store cfs column famili store cfs unreclaim space return true return fals public string oper mode return oper mode string public string drain progress return string format drain column famili remain total shut node write empti memtabl commit log differ drain normal shutdown hook drain wait progress stream complet drain flush columnfamili shutdown hook onli flush durabl public synchron void drain throw interrupt execut executor servic mutat stage stage manag stage stage mutat stage termin logger warn drain node alreadi happen return set mode mode start drain process true stop server option task shutdown gossip instanc stop set mode mode shut messag servic fals messag servic instanc shutdown set mode mode wait stream fals messag servic instanc wait stream set mode mode clear mutat stage fals mutat stage shutdown mutat stage await termin time unit storag proxi instanc verifi hint progress set mode mode flush column famili fals list column famili store cfses array list column famili store string tabl schema instanc system tabl tabl tabl tabl open tabl cfses add tabl column famili store total remain cfses size column famili store cfs cfses cfs forc block flush remain column famili store post flush executor shutdown column famili store post flush executor await termin time unit commit log instanc shutdown block wait miscellan task sstabl commitlog segment delet task shutdown task await termin time unit logger warn miscellan task executor busi minut proceed shutdown set mode mode true home test partition set partition unsaf partition partition partition partition databas descriptor partition databas descriptor set partition partition valu factori version valu version valu factori partition return partition token metadata set token metadata unsaf token metadata tmd token metadata token metadata token metadata tmd return public void truncat string keyspac string column famili throw unavail timeout storag proxi truncat block keyspac column famili public map string float ownership list token sort token array list token token metadata token endpoint map read key set collect sort sort token map token float token map partition describ ownership sort token map string float string map hash map string float map entri token float entri token map entri set string map put entri key string entri valu return string map public map string float effect ownership string keyspac throw configur map string float effect map hash map schema instanc system tabl size throw configur couldn find ani system keyspac infer replic topolog keyspac null replic schema instanc system tabl throw configur system keyspac doesnt topolog keyspac null keyspac schema instanc system tabl list token sort token array list token token metadata token endpoint map read key set collect sort sort token map token float ownership partition describ ownership sort token entri inet address collect rang token rang construct endpoint rang map keyspac entri set token token token metadata token rang key rang token rang rang valu float valu effect token string null effect token string effect put token string valu ownership rang left return effect privat boolean replic list string list list empti return fals int list size meta data ksm schema instanc meta data list meta data ksm schema instanc meta data list ksm strategi class equal ksm strategi class iter element equal ksm strategi option entri set iter ksm strategi option entri set iter return fals return true public list string keyspac list string tableslist array list string schema instanc tabl return collect unmodifi list tableslist public void updat snitch string snitch class boolean dynam integ dynam updat interv integ dynam reset interv doubl dynam bad threshold throw configur endpoint snitch snitch databas descriptor endpoint snitch snitch regist mbean dure construct endpoint snitch snitch util construct snitch class snitch dynam databas descriptor set dynam updat interv dynam updat interv databas descriptor set dynam reset interv dynam reset interv databas descriptor set dynam bad threshold dynam bad threshold snitch dynam endpoint snitch snitch point snitch refer instanc databas descriptor set endpoint snitch snitch string schema instanc tabl tabl open replic strategi snitch snitch snitch instanceof dynam endpoint snitch dynam endpoint snitch snitch unregist bean flush largest memtabl op throughput public void flush largest memtabl column famili store largest null column famili store cfs column famili store long total cfs total memtabl live size total largest null total largest total memtabl live size logger debug total estim memtabl size cfs largest cfs largest null logger info unabl reduc heap usag sinc dirti column famili return logger warn flush largest reliev memori pressur largest forc flush seed data endpoint respons futur param rang stream tabl tabl data rang endpoint includ return latch count privat count latch stream rang final map string multimap rang token inet address rang stream tabl final count latch latch count latch rang stream tabl key set size map entri string multimap rang token inet address entri rang stream tabl entri set multimap rang token inet address rang endpoint entri valu rang endpoint empti latch count continu final string tabl entri key final set map entri rang token inet address pend hash set map entri rang token inet address rang endpoint entri final map entri rang token inet address point entri rang endpoint entri final rang token rang point entri key final inet address endpoint point entri valu final stream callback callback stream callback public void success synchron pend pend remov point entri pend empti latch count public void failur logger warn stream point entri fail success call success latch countdown stage manag stage stage execut runnabl public void run call transfer rang flush potenti lot wast stream transfer rang endpoint tabl open tabl array list rang callback oper type return latch request rang endpoint ring block data fetch readi param rang rang fetch map prefer address rang collect return latch count privat count latch request rang final map string multimap inet address rang token rang final count latch latch count latch rang key set size map entri string multimap inet address rang token entri rang entri set multimap inet address rang token endpoint rang entri valu endpoint rang empti latch count continu final string tabl entri key final set inet address pend hash set inet address endpoint rang key set send messag respect folk stream data final inet address sourc endpoint rang key set collect rang token fetch endpoint rang sourc final stream callback callback stream callback public void success pend remov sourc pend empti latch count public void failur logger warn stream sourc fail success call success latch countdown logger debug enabl logger debug request sourc rang string util join fetch send actual request stream request rang sourc tabl fetch callback oper type return latch calcul pair rang stream fetch rang collect current rang tabl rang move token param current collect rang current token param updat collect rang token chang return pair rang stream fetch current updat rang collect public pair set rang token set rang token calcul stream fetch rang collect rang token current collect rang token updat set rang token stream hash set rang token set rang token fetch hash set rang token rang current boolean intersect fals rang updat intersect ad differ rang fetch ring stream add subtract intersect true break intersect stream add seed rang rang updat boolean intersect fals rang current intersect ad differ rang fetch ring fetch add subtract intersect true break intersect fetch add fetch rang return pair set rang token set rang token stream fetch public void bulk load string directori file dir file directori dir exist dir directori throw illeg argument invalid directori directori tabl loader client client tabl loader client overrid public void init string keyspac tri set partition databas descriptor partition map entri rang token list inet address entri storag servic instanc rang address map keyspac entri set rang token rang entri key inet address endpoint entri valu add rang endpoint rang endpoint catch throw runtim overrid public boolean valid column famili string keyspac string return schema instanc meta data keyspac null tabl loader loader tabl loader dir client output handler log output tri loader stream catch throw runtim public int count return abstract cassandra daemon public void reschedul fail delet tabl delet task reschedul fail task inherit doc public void load tabl string string column famili store load tabl inherit doc public list string sampl key rang renam getter detail list decor key key key sampl column famili store user defin local primari rang list string sampl key array list string key size decor key key key sampl key add key token string return sampl key public void rebuild secondari index string string string idx column famili store rebuild secondari index idx public void reset local schema throw migrat manag reset local schema 