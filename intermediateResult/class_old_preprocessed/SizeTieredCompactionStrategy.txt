licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra compact import java util import java util map entri import org slf logger import org slf logger factori import org apach cassandra column famili store import org apach cassandra sstabl tabl import org apach cassandra sstabl tabl reader import org apach cassandra util pair public class size tier compact strategi extend abstract compact strategi privat static final logger logger logger factori logger size tier compact strategi class protect static final long protect static final string min sstabl size protect long min tabl size protect volatil int estim remain task public size tier compact strategi column famili store cfs map string string option super cfs option estim remain task string option valu option min tabl size null option valu long pars long option valu cfs set compact threshold cfs metadata min compact threshold cfs metadata max compact threshold public abstract compact task background task final int befor cfs compact disabl logger debug compact current disabl return null set tabl reader candid cfs uncompact tabl list list tabl reader bucket bucket creat tabl length pair filter suspect tabl candid min tabl size logger debug compact bucket bucket updat estim compact task bucket list list tabl reader prune bucket array list list tabl reader list tabl reader bucket bucket bucket size cfs minimum compact threshold continu collect sort bucket compar tabl reader public int compar tabl reader tabl reader return descriptor generat descriptor generat prune bucket add bucket list math min bucket size cfs maximum compact threshold prune bucket empti return null list tabl reader smallest bucket collect min prune bucket compar list tabl reader public int compar list tabl reader list tabl reader long avg size avg size return return return privat long avg size list tabl reader sstabl long tabl reader sstabl sstabl sstabl byte disk return sstabl size return compact task cfs smallest bucket befor public abstract compact task maxim task final int befor return cfs tabl empti null compact task cfs filter suspect tabl cfs tabl befor public abstract compact task user defin task collect tabl reader sstabl final int befor return compact task cfs sstabl befor user defin true public int estim remain task return estim remain task privat static list pair tabl reader long creat tabl length pair collect tabl reader collect list pair tabl reader long tabl length pair array list pair tabl reader long collect size tabl reader tabl collect tabl length pair add pair tabl reader long tabl tabl disk length return tabl length pair group file similar size bucket static list list bucket collect pair long file long min tabl size sort list order determinist result dure group list pair long sort file array list pair long file collect sort sort file compar pair long public int compar pair long pair long return compar map long list bucket hash map long list outer pair long pair sort file long size pair bucket similar size file group bucket averag bucket file bucket consid small min tabl size entri long list entri bucket entri set list bucket entri valu long averag size entri key size averag size size averag size size min tabl size averag size min tabl size remov add averag size bucket remov averag size long total size bucket size averag size long averag size total size size bucket size bucket add pair left bucket put averag size bucket continu outer similar bucket put array list bucket array list bucket add pair left bucket put size bucket return array list list bucket valu privat void updat estim compact task list list tabl reader task int list tabl reader bucket task bucket size cfs minimum compact threshold math ceil doubl bucket size cfs maximum compact threshold estim remain task public long min tabl size return min tabl size public long max tabl size return long public boolean key exist expens set extend tabl sstabl ignor return cfs tabl size sstabl ignor size public string string return string format size tier compact strategi cfs minimum compact threshold cfs maximum compact threshold 