packag org apach cassandra net licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java buffer output stream import java data output stream import java import java net socket import java net socket import java util concurr block queue import java util concurr link block queue import java util concurr atom atom long import org apach common lang array util import org slf logger import org slf logger factori import org apach cassandra config databas descriptor import org apach cassandra servic storag servic import org apach cassandra util util public class outbound tcp connect extend thread privat static final logger logger logger factori logger outbound tcp connect class privat static final messag messag util broadcast address storag servic verb array util messag servic version privat volatil boolean stop fals privat static final int retri send thread read activ queue queue empti swap backlog privat volatil block queue entri backlog link block queue entri privat volatil block queue entri activ link block queue entri privat final outbound tcp connect pool pool refer privat data output stream privat socket socket privat volatil long complet privat final atom long drop atom long public outbound tcp connect outbound tcp connect pool pool super pool point pool refer pool public void enqueu messag messag string expir messag tri backlog put entri messag catch interrupt throw assert error void close socket boolean destroy thread activ clear backlog clear stop destroy thread exit loop stop thread enqueu null void soft close socket enqueu null public void run true entri entri activ poll entri null exhaust activ queue switch backlog onc someth process tri entri backlog catch interrupt throw assert error block queue entri tmp backlog backlog activ activ tmp messag entri messag string entri disconnect stop break continu entri timestamp system current time milli databas descriptor rpc timeout drop increment els socket null connect write connect entri els clear queue els gossip messag activ clear public int pend messag return activ size backlog size public long complet messsag return complet public long drop messag return drop privat void write connect entri entri string messag messag entri messag tri write messag complet activ peek null flush catch disconnect instanceof logger debug enabl logger debug error write pool refer point messag import repair acknowledg put queue retri connect instanceof socket entri retri tri backlog put retri entri entri catch interrupt throw assert error els program error silenc logger error error write pool refer point public static void write messag messag string data output stream throw set protocol header byte long repres integ bit indic serial type bit indic compress turn turn default bit indic stream mode turn default bit reserv futur bit indic version number remain bit current int header set serial bit header messag servic serial type ordin set compress bit fals header set version bit header messag version write int messag servic write int header comput total messag length compat earlier byte byte messag messag bodi int total messag length messag header byte write int total write header serial serial messag header messag version write int byte length write byte public static int messag length header header string byte byte return util encod length header serial size byte length privat void disconnect socket null tri socket close catch logger debug enabl logger debug close connect pool refer point null socket null privat boolean connect logger debug enabl logger debug attempt connect pool refer point long start system current time milli system current time milli start databas descriptor rpc timeout tri socket pool refer socket socket set aliv true socket set tcp delay true data output stream buffer output stream socket output stream return true catch socket null logger trace enabl logger trace unabl connect pool refer point tri thread sleep catch interrupt throw assert error return fals privat void expir messag true entri entri backlog peek entri null entri timestamp system current time milli databas descriptor rpc timeout break entri entri backlog poll entri entri send thread switch queue add entri backlog activ queue posit relat entri contend client head backlog lock entri null activ add entri break drop increment messag retri privat static class entri final messag messag final string final long timestamp entri messag messag string messag messag timestamp system current time milli boolean retri return messag servic messag verb privat static class retri entri extend entri retri entri entri super messag boolean retri return fals 