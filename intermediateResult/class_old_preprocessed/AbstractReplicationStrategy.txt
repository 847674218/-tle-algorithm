licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra locat import java lang reflect constructor import java net inet address import java util import googl common collect hash multimap import googl common collect multimap import org slf logger import org slf logger factori import org apach cassandra config configur import org apach cassandra dht rang import org apach cassandra dht ring posit import org apach cassandra dht token import org apach cassandra servic datacent sync write respons handler import org apach cassandra servic datacent write respons handler import org apach cassandra servic write respons handler import org apach cassandra servic write respons handler import org apach cassandra thrift consist level import org apach cassandra util util import org cliffc high scale lib block hash map abstract parent replic strategi public abstract class abstract replic strategi privat static final logger logger logger factori logger abstract replic strategi class public final string tabl public final map string string config option privat final token metadata token metadata public endpoint snitch snitch abstract replic strategi string tabl token metadata token metadata endpoint snitch snitch map string string config option assert tabl null assert snitch null assert token metadata null token metadata token metadata snitch snitch token metadata regist config option config option tabl tabl privat final map token array list inet address cach endpoint block hash map token array list inet address public array list inet address cach endpoint token return cach endpoint public void cach endpoint token array list inet address addr cach endpoint put addr public void clear endpoint cach logger debug clear cach endpoint cach endpoint clear possibl cach endpoint store token note endpoint conceptu set duplic includ return list avoid extra alloc sort proxim param search posit posit natur endpoint request return copi natur endpoint token public array list inet address natur endpoint ring posit search posit token search token search posit token token key token token metadata token token metadata sort token search token array list inet address endpoint cach endpoint key token endpoint null token metadata token metadata clone token metadata clone onli token map key token token metadata token token metadata clone sort token search token endpoint array list inet address calcul natur endpoint search token token metadata clone cach endpoint key token endpoint return array list inet address endpoint calcul natur endpoint token natur endpoint org apach cassandra dht ring posit param search token token natur endpoint request return copi natur endpoint token public abstract list inet address calcul natur endpoint token search token token metadata token metadata public write respons handler write respons handler collect inet address write endpoint consist level consist level runnabl callback consist level consist level block context localnod block return datacent write respons handler creat write endpoint consist level tabl callback els consist level consist level return datacent sync write respons handler creat write endpoint consist level tabl callback return write respons handler creat write endpoint consist level tabl callback calcul base strategi option overwrit ensur call return replic factor public abstract int replic factor pretti ineffici invers rang address fine long don ani critic path fix probabl requir merg tokenmetadata replicationstrategi cach invalid clean public multimap inet address rang token address rang token metadata metadata multimap inet address rang token map hash multimap creat token token metadata sort token rang token rang metadata primari rang token inet address calcul natur endpoint token metadata map put rang return map public multimap rang token inet address rang address token metadata metadata multimap rang token inet address map hash multimap creat token token metadata sort token rang token rang metadata primari rang token inet address calcul natur endpoint token metadata map put rang return map public multimap inet address rang token address rang return address rang token metadata public collect rang token pend address rang token metadata metadata token pend token inet address pend address token metadata temp metadata clone onli token map temp updat normal token pend token pend address return address rang temp pend address public void invalid cach token endpoint valu clear endpoint cach public abstract void valid option throw configur public static abstract replic strategi creat replic strategi string tabl class extend abstract replic strategi strategi class token metadata token metadata endpoint snitch snitch map string string strategi option throw configur abstract replic strategi strategi class paramet type class string class token metadata class endpoint snitch class map class tri constructor extend abstract replic strategi constructor strategi class constructor paramet type strategi constructor instanc tabl token metadata snitch strategi option catch throw runtim throw config strat opt don requir info strategi valid option return strategi public static abstract replic strategi creat replic strategi string tabl string strategi class token metadata token metadata endpoint snitch snitch map string string strategi option throw configur class abstract replic strategi class strategi class return creat replic strategi tabl token metadata snitch strategi option public static class abstract replic strategi class string cls throw configur string class cls cls org apach cassandra locat cls return util class class replic strategi protect void valid replic factor string throw configur tri integ pars int throw configur replic factor negat catch number format throw configur replic factor numer protect void warn unexpect option collect string expect option string key config option key set expect option key logger warn unrecogn strategi option key pass class simpl keyspac tabl 