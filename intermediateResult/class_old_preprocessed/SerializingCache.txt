packag org apach cassandra cach licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java data output stream import java error import java import java util set import googlecod concurrentlinkedhashmap concurr link hash map import googlecod concurrentlinkedhashmap evict listen import googlecod concurrentlinkedhashmap weigher import googlecod concurrentlinkedhashmap weigher import org apach cassandra serial import org apach cassandra util memori input stream import org apach cassandra util memori output stream import org slf logger import org slf logger factori serial cach valu heap public class serial cach implement cach privat static final logger logger logger factori logger serial cach class privat static final int privat final concurr link hash map freeabl memori map privat final serial serial public serial cach long capac boolean memori weigher serial serial serial serial evict listen freeabl memori listen evict listen freeabl memori public void evict freeabl memori mem mem unrefer map concurr link hash map builder freeabl memori weigher memori weigher creat memori weigher weigher freeabl memori singleton maximum weight capac capac concurr level listen listen build privat static weigher freeabl memori creat memori weigher return weigher freeabl memori public int weight freeabl memori valu return int math min valu size integ privat deseri freeabl memori mem tri return serial deseri memori input stream mem catch logger debug fetch memori data failback read disk return null privat freeabl memori serial valu long serial size serial serial size valu serial size integ throw illeg argument unabl alloc serial size byte freeabl memori freeabl memori tri freeabl memori freeabl memori serial size catch memori error return null tri serial serial valu data output stream memori output stream freeabl memori catch throw error return freeabl memori public long capac return map capac public void set capac long capac map set capac capac public boolean empti return map empti public int size return map size public long weight size return map weight size public void clear map clear public object key freeabl memori mem map key mem null return null mem refer return null tri return deseri mem final mem unrefer public void put key valu freeabl memori mem serial valu mem null return memori mind freeabl memori map put key mem null unrefer public boolean put absent key valu freeabl memori mem serial valu mem null return fals memori mind freeabl memori map put absent key mem null valu put useless alloc memori free mem unrefer return null public boolean replac key replac valu valu map fail freeabl memori map key null return fals valu match replac freeabl memori mem serial valu mem null return fals memori mind valu refer guy befor serial refer return fals alreadi freed henc noop tri valu deseri final unrefer boolean success valu equal replac map replac key mem success unrefer eventu clean els mem unrefer return success public void remov key freeabl memori mem map remov key mem null mem unrefer public set key set return map key set public set hot key set int return map descend key set limit public boolean key key return map key key public boolean put copi return true 