licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra compress import java file import java import java util zip import java util zip checksum import org apach cassandra sstabl tabl metadata collector import org apach cassandra util file mark import org apach cassandra util sequenti writer public class compress sequenti writer extend sequenti writer public static sequenti writer open string data file path string index file path boolean skip cach compress paramet paramet collector sstabl metadata collector throw return compress sequenti writer file data file path index file path skip cach paramet sstabl metadata collector hold offset file current chunk written chang onli flush method data buffer compress store file privat long chunk offset index file writer random privat final compress metadata writer metadata writer privat final compressor compressor store compress data privat final compressor wrap array compress hold number alreadi written chunk privat int chunk count privat final checksum checksum privat long origin size compress size privat collector sstabl metadata collector public compress sequenti writer file file string index file path boolean skip cach compress paramet paramet collector sstabl metadata collector throw super file paramet chunk length skip cach compressor paramet sstabl compressor buffer compress size buffer compress compressor wrap array byte compressor initi compress buffer length buffer length index file compress info compon header metadata writer compress metadata writer index file path metadata writer write header paramet sstabl metadata collector sstabl metadata collector overrid public long disk file pointer throw return file pointer overrid public void sync throw throw unsupport oper overrid public void flush throw throw unsupport oper overrid protect void flush data throw seek chunk start compress data buffer int compress length compressor compress buffer valid buffer byte compress origin size valid buffer byte compress size compress length updat checksum checksum updat buffer valid buffer byte write offset newli written chunk index file metadata writer write long chunk offset chunk count assert compress length compress buffer length write data write compress buffer compress length write correspond checksum write int int checksum valu reset checksum object blank state checksum reset chunk written current length checksum int chunk offset compress length overrid public file mark mark return compress file writer mark chunk offset current valid buffer byte chunk count overrid public synchron void reset truncat file mark mark throw assert mark instanceof compress file writer mark compress file writer mark real mark compress file writer mark mark reset posit current real mark unc data offset real mark chunk offset chunk offset current buffer reset buffer offset return valid buffer byte real mark buffer offset return synchron current buffer disk becaus don ani data loss sync intern set marker current offset chunk offset real mark chunk offset compress chunk size byte reserv checksum int chunk size int metadata writer chunk offset real mark chunk index chunk offset compress buffer length chunk size compress buffer byte chunk size seek chunk offset read fulli compress buffer chunk size decompress data chunk store length int valid byte compressor uncompress compress buffer chunk size buffer checksum updat buffer valid byte read int int checksum valu throw corrupt block path chunk offset chunk size checksum reset reset buffer valid buffer byte real mark buffer offset buffer offset current valid buffer byte chunk count real mark chunk index truncat data index file truncat chunk offset metadata writer reset truncat real mark chunk index seek offset compress data chunk store throw ani error privat void seek chunk start throw file pointer chunk offset seek chunk offset overrid public void close throw buffer null return alreadi close super close sstabl metadata collector add compress ratio compress size origin size metadata writer final header current chunk count metadata writer close class hold mark posit file protect static class compress file writer mark implement file mark chunk offset compress file long chunk offset uncompress data offset real data offset long unc data offset int buffer offset int chunk index public compress file writer mark long chunk offset long unc data offset int buffer offset int chunk index chunk offset chunk offset unc data offset unc data offset buffer offset buffer offset chunk index chunk index 