licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java util import org apach cassandra columniter column iter import org apach cassandra columniter column iter factori import org apach cassandra columniter lazi column iter import org apach cassandra filter queri filter import org apach cassandra sstabl tabl reader import org apach cassandra sstabl tabl scanner import org apach cassandra util closeabl iter import org apach cassandra util merg iter public class row iter factori privat static final compar column iter compar column iter public int compar column iter column iter return decor key compar compar key key row iter provid memtabl sstabl provid key filter queryfilt param memtabl memtabl pend flush param sstabl stabl scan param start start key param stop stop key param filter decid column pull param cfs return row iter follow restrict public static closeabl iter row iter final iter memtabl memtabl final collect tabl reader sstabl final row posit start final row posit stop final queri filter filter final column famili store cfs fetch data current memtabl histor memtabl tabl correct order final list closeabl iter column iter iter array list closeabl iter column iter memtabl memtabl memtabl memtabl iter add convert column iter filter memtabl entri iter start stop tabl reader sstabl sstabl final tabl scanner scanner sstabl scanner filter scanner seek start iter add scanner reduc row sourc singl row return merg iter iter merg iter reduc column iter row privat final int befor int system current time milli cfs metadata grace privat final list column iter col iter array list column iter privat decor key key privat column famili return overrid protect void key chang return column famili creat cfs metadata public void reduc column iter current col iter add current key current key return delet current column famili protect row reduc check row row cach skip rest column famili cach cfs raw cach row key cach null cach collat filter collat column return col iter befor els queri filter key filter queri filter key filter path filter filter return cfs filter column famili cach key filter befor row row key return col iter clear key null return column iter specif key memtabl privat static class convert column iter implement closeabl iter column iter privat final queri filter filter privat final iter map entri decor key column famili iter public convert column iter queri filter filter iter map entri decor key column famili iter filter filter iter iter public boolean return iter note page slice reset start queri filter fetch row iter ani filter fetch row befor call prevent guava abstract iter obvious fragil consid refactor code refactor deep storag engin code public column iter final map entri decor key column famili entri iter return lazi column iter entri key column iter factori public column iter creat return filter memtabl column iter entri valu entri key public void remov throw unsupport oper public void close pass 