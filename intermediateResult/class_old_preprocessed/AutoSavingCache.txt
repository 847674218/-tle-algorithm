licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra cach import java import java nio byte buffer import java util import java util concurr atom atom boolean import java util concurr futur import java util concurr schedul futur import java util concurr time unit import org cliffc high scale lib block hash set import org slf logger import org slf logger factori import org apach cassandra config meta data import org apach cassandra config databas descriptor import org apach cassandra compact compact info import org apach cassandra compact compact manag import org apach cassandra compact oper type import org apach cassandra decor key import org apach cassandra dht partition import org apach cassandra util file util import org apach cassandra util sequenti writer import org apach cassandra servic cach servic import org apach cassandra servic storag servic import org apach cassandra util wrap runnabl import org apach cassandra util pair public class auto save cach extend cach key extend instrument cach privat static final logger logger logger factori logger auto save cach class true cach flush current execut onli execut time public static final set cach servic cach type flush progress block hash set cach servic cach type protect volatil schedul futur save task protect final cach servic cach type cach type public auto save cach cach cach cach servic cach type cach type super cach cach type cach type public file cach path string string return databas descriptor serial cach path cach type public writer writer int key save return writer key save public void schedul save int save period final int key save save task null save task cancel fals interrupt progress save save task null save period runnabl runnabl wrap runnabl public void run throw submit write key save save task storag servic option task schedul fix delay runnabl save period save period time unit public set decor key read save string string partition partition file path cach path set decor key key tree set decor key path exist data input stream null tri long start system current time milli logger info string format read save cach path data input stream buffer input stream file input stream path avail int size read int byte byte byte size read fulli byte byte buffer buffer byte buffer wrap byte decor key key tri key partition decor key buffer catch logger info string format unabl read entri save cach skip remain entri key size path absolut path break key add key logger debug enabl logger debug string format complet read key save cach system current time milli start key size path catch logger warn string format error read save cach path absolut path final file util close quiet return key public futur submit write int key save return compact manag instanc submit cach write writer key save public void reduc cach size capac int capac int databas descriptor reduc cach capac weight size logger warn string format reduc capac reduc memori pressur cach type capac capac set capac capac public int estim size save set key int byte key key byte key serial size return byte public class writer extend compact info holder privat final set key privat final compact info info privat final long estim total byte privat long byte written protect writer int key save key save key set size key key set els key hot key set key save approxim keyset chang save estim total byte estim size save key oper type type cach type cach servic cach type type oper type els cach type cach servic cach type type oper type els type oper type info compact info meta data system cach type string null null null type estim total byte public cach servic cach type cach type return cach type public compact info compact info long byte written byte written keyset chang size total byte return info progress byte written math max byte written estim total byte public void save cach throw logger debug delet file cach type delet cach file key size estim total byte logger debug skip save cach empti cach type return long start system current time milli hash map pair string string sequenti writer writer hash map pair string string sequenti writer tri cach key key key pair string string path key path info sequenti writer writer writer path writer null writer temp cach file path writer put path writer key write writer stream byte written key serial size final sequenti writer writer writer valu file util close quiet writer map entri pair string string sequenti writer info writer entri set pair string string path info key sequenti writer writer info valu file tmp file file writer path file cach file cach path path left path cach file delet ignor error didn exist tmp file renam cach file logger error unabl renam tmp file cach file logger info string format save item cach type key size system current time milli start privat sequenti writer temp cach file pair string string path info throw file path cach path path info left path info file tmp file file creat temp file path null path parent file return sequenti writer open tmp file true privat void delet cach file file save cach dir file databas descriptor save cach locat save cach dir exist save cach dir directori file file save cach dir list file file file file cach type string file delet logger warn fail delet file absolut path 