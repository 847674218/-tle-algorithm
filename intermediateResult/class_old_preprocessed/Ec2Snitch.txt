licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra locat import java data input stream import java filter input stream import java import java net http connect import java net inet address import java net import googl common base charset import org slf logger import org slf logger factori import org apach cassandra config configur import org apach cassandra gms applic state import org apach cassandra gms endpoint state import org apach cassandra gms gossip import org apach cassandra servic storag servic import org apach cassandra util util snitch assum region avail zone rack inform avail config node public class snitch extend abstract network topolog snitch protect static logger logger logger factori logger snitch class protect static final string http latest meta data placement avail zone privat static final string privat static final string protect string zone protect string region public snitch throw configur string aw api call split east asia east asia string split split zone split split length hack region substr length region region substr length string datacent suffix snitch properti suffix region region concat datacent suffix logger info snitch region region zone zone string aw api call string url throw configur popul region zone introspect fail metadata http connect conn http connect url open connect tri conn set request method conn respons code throw configur snitch unabl execut call node read inform string conn content int conn content length byte byte data input stream data input stream filter input stream conn content read fulli return string charset final conn disconnect public string rack inet address endpoint endpoint equal util broadcast address return zone endpoint state state gossip instanc endpoint state endpoint endpoint null state null state applic state applic state return return state applic state applic state valu public string datacent inet address endpoint endpoint equal util broadcast address return region endpoint state state gossip instanc endpoint state endpoint endpoint null state null state applic state applic state return return state applic state applic state valu overrid public void gossip start share info gossip wait gossip initi logger info snitch ad applic state region region zone zone gossip instanc add local applic state applic state storag servic instanc valu factori datacent region gossip instanc add local applic state applic state storag servic instanc valu factori rack zone 