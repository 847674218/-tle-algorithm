packag org apach cassandra net licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java import java net inet address import java net socket import org apach cassandra gms gossip import org apach cassandra util fast byte array input stream import org slf logger import org slf logger factori import org apach cassandra stream incom stream reader import org apach cassandra stream stream header public class incom tcp connect extend thread privat static logger logger logger factori logger incom tcp connect class privat static final int privat socket socket public inet address public incom tcp connect socket socket assert socket null socket socket connect stream messag entir lifetim becaus stream bypass input stream implement send file buffer determin type connect overrid public void run data input stream input boolean stream int version tri determin connect type decid buffer input data input stream socket input stream messag servic valid magic input read int int header input read int stream messag servic bit header version messag servic bit header logger debug version version stream version messag servic version int size input read int byte header byte byte size input read fulli header byte stream stream header serial deseri data input stream fast byte array input stream header byte version input els stream connect session fix version anyth wrong version stream connect drop logger error receiv stream protocol version version termin connect version messag servic version connect return buffer input data input stream buffer input stream socket input stream receiv messag set version receiv messag input version whi version messag servic version save endpoint gossip reconnect gossip instanc add save endpoint logger info receiv stream stream connect newer protocol version ignor return gossip instanc set version version logger debug set version version loop messag true prepar read messag messag servic valid magic input read int header input read int assert stream messag servic bit header connect chang type stream version messag servic bit header logger trace version version receiv messag input version catch logger trace eof read socket close connect reset throw catch logger debug error read socket close final close privat inet address receiv messag data input stream input int version throw int total size input read int string input read header header header serial deseri input version int bodi size input read int byte bodi byte bodi size read fulli alloc direct buffer size chunk read cap https issu apach org jira brows int remaind bodi size int offset offset bodi size remaind offset input read fulli bodi offset input read fulli bodi bodi size remaind remaind earlier version send unnecessari byte left buffer long remain total size outbound tcp connect messag length header bodi remain remain input skip remain stream connect continu read messag ignor sender start send correct version messag reconnect version messag version messag servic version messag messag messag header bodi version messag servic instanc receiv messag els logger debug receiv connect newer protocol version ignor messag version return header privat void close reset version sinc set start incom socket null gossip instanc reset version tri socket close catch logger debug enabl logger debug error close socket privat void stream stream header stream header data input stream input throw incom stream reader stream header socket read 