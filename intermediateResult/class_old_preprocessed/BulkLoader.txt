licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra tool import java file import java import java net inet address import java net unknown host import java util import org apach cassandra auth authent import org apach cassandra config databas descriptor import org apach cassandra dht rang import org apach cassandra dht token import org apach cassandra sstabl tabl loader import org apach cassandra stream pend file import org apach cassandra thrift import org apach cassandra util output handler import org apach common cli import org apach thrift protocol binari protocol import org apach thrift protocol protocol import org apach thrift transport frame transport import org apach thrift transport socket import org apach thrift transport transport public class bulk loader privat static final string sstableload privat static final string verbos privat static final string debug privat static final string privat static final string progress privat static final string ignor privat static final string node privat static final string port privat static final string usernam privat static final string password privat static final string throttl public static void main string arg throw loader option option loader option pars arg arg tri output handler handler output handler system output option verbos option debug tabl loader loader tabl loader option directori extern client handler option host option rpc port option user option passwd handler databas descriptor set stream throughput outbound megabit sec option throttl tabl loader loader futur futur loader stream option ignor option progress futur els progress indic indic progress indic futur pend file indic start system println boolean print fals futur indic print progress stream system println wait target rebuild index print true futur assert futur els tri thread sleep catch print indic print progress futur failur system err println stream follow host fail system err println futur fail host system exit system exit stop daemon thread catch system err println messag option debug print stack trace system err system exit return true everyth static class progress indic privat final map inet address collect pend file file host privat long start time privat long progress privat long time public progress indic map inet address collect pend file file host file host hash map inet address collect pend file file host public void start start time system current time milli public boolean print progress boolean true string builder string builder append rprogress long total progress long total size map entri inet address collect pend file entri file host entri set long progress long size int complet collect pend file pend entri valu pend file pend progress progress size size progress size complet total progress progress total size size complet pend size fals append append entri key append append complet append append pend size append append size progress size append long time system current time milli long delta time time time time time long delta progress total progress progress progress total progress append total append total size total progress total size append append sec delta progress delta time append append avg append sec total progress time start time append system print string return privat int sec long byte long time doubl byte doubl byte time return int byte static class extern client extend tabl loader client privat final map string set string cfs hash map string set string privat final output handler output handler privat set inet address host hash set inet address privat int rpc port privat string user privat string passwd public extern client output handler output handler set inet address host int port string user string passwd super output handler output handler host host rpc port port user user passwd passwd public void init string keyspac iter inet address hostit host iter hostit tri queri endpoint rang map schema thrift inet address host hostit cassandra client client creat thrift client host host address rpc port user passwd list token rang token rang client describ ring keyspac list def def client describ keyspac set partition client describ partition token token factori factori partition token factori token rang token rang rang token rang rang token factori string start token factori string token string endpoint add rang endpoint rang inet address def def def set string cfs hash set string def def def def cfs add def cfs put def cfs break catch hostit throw runtim retriev endpoint rang public boolean valid column famili string keyspac string set string cfs cfs keyspac return cfs null cfs privat static cassandra client creat thrift client string host int port string user string passwd throw socket socket socket host port transport tran frame transport socket tran open protocol protocol binari protocol tran cassandra client client cassandra client protocol user null passwd null map string string credenti hash map string string credenti put authent user credenti put authent passwd authent request authent request authent request credenti client login authent request return client static class loader option public final file directori public boolean debug public boolean verbos public boolean progress public int rpc port public string user public string passwd public int throttl public set inet address host hash set inet address public set inet address ignor hash set inet address loader option file directori directori directori public static loader option pars arg string cmd arg command line parser parser gnu parser cmd line option option cmd line option tri command line cmd parser pars option cmd arg fals cmd option print usag option system exit string arg cmd arg arg length system err println sstabl directori argument print usag option system exit arg length system err println mani argument print usag option system exit string dirnam arg file dir file dirnam dir exist error msg unknown directori dirnam option dir directori error msg dirnam directori option loader option opt loader option dir opt debug cmd option opt verbos cmd option opt progress cmd option cmd option opt throttl integ valu cmd option valu cmd option opt rpc port integ valu cmd option valu cmd option opt user cmd option valu cmd option opt passwd cmd option valu cmd option string node cmd option valu split tri string node node opt host add inet address node trim catch unknown host error msg unknown host messag option els system err println initi host specifi print usag option system exit cmd option string node cmd option valu split tri string node node opt ignor add inet address node trim catch unknown host error msg unknown host messag option return opt catch pars error msg messag option return null privat static void error msg string msg cmd line option option system err println msg print usag option system exit privat static cmd line option cmd line option cmd line option option cmd line option option add option null display stack trace option add option verbos output option add option display messag option add option null don display progress option add option don stream comma separ list node option add option initi host tri connect host comma separ initi ring inform option add option rpc port port rpc default option add option throttl throttl speed mbit default unlimit option add option usernam usernam cassandra authent option add option password password cassandra authent return option public static void print usag option option string usag string format option dir path string builder header string builder header append header append bulk load sstabl directori dir path configur cluster header append parent directori dir path keyspac header append instanc load sstabl standard data keyspac keyspac header append file standard data standard index header append directori keyspac standard directori call sstableload keyspac standard header append header append option formatt print usag header string option public static class cmd line option extend option add option argument argument param opt shortcut option param long opt complet option param arg argument param descript descript option return updat option object public option add option string opt string long opt string arg string descript option option option opt long opt true descript option set arg arg return add option option add option argument param opt shortcut option param long opt complet option param descript descript option return updat option object public option add option string opt string long opt string descript return add option option opt long opt fals descript 