licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra index key import java import java nio byte buffer import java util set import java util concurr execut import org apach cassandra config meta data import org apach cassandra config column definit import org apach cassandra config configur import org apach cassandra import org apach cassandra index column secondari index import org apach cassandra index secondari index searcher import org apach cassandra marshal abstract type import org apach cassandra marshal byte type import org apach cassandra marshal local partion type import org apach cassandra dht import org apach cassandra servic storag servic import org apach cassandra util byte buffer util import org slf logger import org slf logger factori implement secondari index column famili column famili row key index valu column base row key public class key index extend column secondari index privat static final logger logger logger factori logger key index class privat column famili store index cfs public key index public void init assert base cfs null column def null column definit column def column def iter meta data index metadata meta data index metadata base cfs metadata column def index compar index cfs column famili store creat column famili store base cfs tabl index metadata local partition column def valid index metadata enabl initi row cach base parent set index column cardin meta data cach base cach base cfs metadata cach base cach meta data cach base cach meta data cach index key cardin index column key store index averag column count tall tabl consid high cardin doubl estim key index cfs estim key doubl averag column count index cfs column averag column count estim key averag column count logger debug turn row cach index cfs column famili index cfs metadata cach base cach index cfs init row cach public static abstract type index compar partition row partition storag servic partition return row partition instanceof order preserv partition row partition instanceof byte order partition byte type instanc local partion type storag servic partition public void delet column decor key valu key byte buffer row key column column column mark delet return int local delet time int system current time milli column famili cfi column famili creat index cfs metadata cfi add tombston row key local delet time column timestamp index cfs appli valu key cfi logger debug enabl logger debug remov index entri clean valu valu key cfi public void insert column decor key valu key byte buffer row key column column column famili cfi column famili creat index cfs metadata column instanceof expir column expir column expir column column cfi add column expir column row key byte buffer util timestamp time live local delet time els cfi add column column row key byte buffer util column timestamp logger debug enabl logger debug appli index row index cfs metadata key valid string valu key key cfi index cfs appli valu key cfi public void updat column decor key valu key byte buffer row key column col insert column valu key row key col public void remov index byte buffer column throw index cfs invalid public void forc block flush throw tri index cfs forc block flush catch execut throw catch interrupt throw public void invalid index cfs invalid public void truncat long truncat index cfs discard tabl truncat public column famili store index cfs return index cfs public secondari index searcher creat secondari index searcher set byte buffer column return key searcher base cfs index manag column public string index return index cfs column famili public void valid option throw configur option public long live size return index cfs memtabl data size public void reload throw index cfs metadata reload secondari index metadata base cfs metadata index cfs reload 