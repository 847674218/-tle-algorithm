packag org apach cassandra hadoop licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java import java net inet address import java net network interfac import java net socket import java net unknown host import java nio byte buffer import java util import googl common collect import org apach thrift transport transport import org slf logger import org slf logger factori import org apach cassandra auth authent import org apach cassandra config configur import org apach cassandra column import org apach cassandra marshal abstract type import org apach cassandra marshal type parser import org apach cassandra dht partition import org apach cassandra thrift import org apach cassandra util byte buffer util import org apach cassandra util util import org apach cassandra util pair import org apach hadoop conf configur import org apach hadoop mapreduc input split import org apach hadoop mapreduc record reader import org apach hadoop mapreduc task attempt context import org apach thrift import org apach thrift transport socket public class column famili record reader extend record reader byte buffer sort map byte buffer column implement org apach hadoop mapr record reader byte buffer sort map byte buffer column privat static final logger logger logger factori logger column famili record reader class public static final int privat column famili split split privat row iter iter privat pair byte buffer sort map byte buffer column current row privat slice predic predic privat boolean empti predic privat int total row count total number row fetch privat int batch size fetch mani batch privat string privat string keyspac privat socket socket privat cassandra client client privat consist level consist level privat int key buffer size privat list index express filter public column famili record reader column famili record reader public column famili record reader int key buffer size super key buffer size key buffer size public void close socket null socket open socket close socket null client null public byte buffer current key return current row left public sort map byte buffer column current valu return current row public float progress iter return progress report slight actual close float progress float iter row read total row count return progress progress static boolean empti predic slice predic predic predic null return true predic set column predic slice rang null return fals predic slice rang null return true byte start predic slice rang start start null start length return fals byte finish predic slice rang finish finish null finish length return fals return true public void initi input split split task attempt context context throw split column famili split split configur conf context configur key rang job rang config helper input key rang conf filter job rang null null job rang row filter predic config helper input slice predic conf boolean widerow config helper input wide conf empti predic empti predic predic total row count int split length batch size config helper rang batch size conf config helper input column famili conf consist level consist level valu config helper read consist level conf keyspac config helper input keyspac conf tri onli connect onc socket null socket open return creat connect thrift string locat locat socket socket locat config helper input rpc port conf transport transport config helper input transport factori conf open transport socket conf binari protocol binari protocol binari protocol transport true true client cassandra client binari protocol log client set keyspac keyspac config helper input keyspac user conf null map string string cred hash map string string cred put authent config helper input keyspac user conf cred put authent config helper input keyspac password conf authent request auth request authent request cred client login auth request catch throw runtim iter widerow wide row iter static row iter logger debug creat iter public boolean key valu throw iter logger debug finish scan iter row read row estim total row count return fals current row iter return true don endpointsnitch sinc tri support hadoop node necessarili cassandra machin adequ singl cluster privat string locat array list inet address local address array list inet address tri enumer network interfac net network interfac network interfac net element local address add collect list net element inet address catch socket throw assert error inet address address local address string locat split locat inet address locat address null tri locat address inet address locat catch unknown host throw assert error address equal locat address return locat return split locat privat abstract class row iter extend abstract iter pair byte buffer sort map byte buffer column protect list key slice row protect int total read protect final abstract type compar protect final abstract type compar protect final partition partition privat row iter tri partition util partition client describ partition keyspac metadata specif metadata order popul compar def def client describ keyspac keyspac list string cfname array list string def cfd def def cfname add cfd int idx cfname index def def def def idx compar type parser pars def compar type compar def subcompar type null null type parser pars def subcompar type catch configur throw runtim unabl load compar catch throw runtim error communic thrift catch throw runtim unabl load keyspac keyspac return total number row read record reader public int row read return total read protect column unthriftifi column super column cosc cosc counter column null return unthriftifi counter cosc counter column cosc counter super column null return unthriftifi super counter cosc counter super column cosc super column null return unthriftifi super cosc super column assert cosc column null return unthriftifi simpl cosc column privat column unthriftifi super super column super column org apach cassandra super column org apach cassandra super column super column compar column column super column column add column unthriftifi simpl column return protect column unthriftifi simpl column column return org apach cassandra column column column valu column timestamp privat column unthriftifi counter counter column column counter column read node system tabl storag servic run access cassandra yaml avoid hadoop access yaml return regular column return org apach cassandra column column byte buffer util byte column valu privat column unthriftifi super counter counter super column super column org apach cassandra super column org apach cassandra super column super column compar counter column column super column column add column unthriftifi counter column return privat class static row iter extend row iter protect int privat void mayb init check anoth batch row null row size return string start token total read request start token split start token els start token partition token factori string partition token iter row key start token equal split token reach split row null return key rang key rang key rang batch size set start token start token set token split token set row filter filter tri row client rang slice column parent predic key rang consist level noth reach row empti row null return remov ghost fetch column empti predic iter key slice row iter key slice column size remov ghost spooki row empti mayb init assum start key row collect add row add mayb init return reset iter batch catch throw runtim protect pair byte buffer sort map byte buffer column comput mayb init row null return data total read key slice row sort map byte buffer column map tree map byte buffer column compar column super column cosc column column column unthriftifi cosc map put column column return pair byte buffer sort map byte buffer column key map privat class wide row iter extend row iter privat peek iter pair byte buffer sort map byte buffer column wide column privat byte buffer column byte buffer util privat byte buffer count key byte buffer util privat void mayb init wide column null wide column return key rang key rang total read string start token split start token key rang key rang batch size set start token start token set token split token set row filter filter els key slice row iter row logger debug start row row key key rang key rang batch size set start key row key set token split token set row filter filter tri row client page slice key rang column consist level int key slice row row row column size logger debug read column row start object row size key rang column wide column iter peek iter wide column iter row wide column wide column peek key set iter equal column wide column wide column row null catch throw runtim protect pair byte buffer sort map byte buffer column comput mayb init row null return data pair byte buffer sort map byte buffer column wide column column valu iter duplic mayb increas row counter return increas row counter onli realli move row param fetch row slice privat void mayb increas row counter pair byte buffer sort map byte buffer column byte buffer current key left current key equal count key total read count key current key privat class wide column iter extend abstract iter pair byte buffer sort map byte buffer column privat final iter key slice row privat iter column super column column public key slice current row public wide column iter list key slice row row row iter row row els column iter empti iter privat void row current row row column current row column iter protect pair byte buffer sort map byte buffer column comput true column column super column cosc column column column unthriftifi cosc immut sort map byte buffer column map immut sort map column column return pair byte buffer sort map byte buffer column creat current row key map row return data row becaus hadoop write key valu copi output expect small perform hit obvious wouldn work wide row sinc column famili input format column famili record reader don support fine public boolean byte buffer key sort map byte buffer column valu throw key valu key clear key put current key duplic key flip valu clear valu put current valu return true return fals public byte buffer creat key return byte buffer wrap byte key buffer size public sort map byte buffer column creat valu return tree map byte buffer column public long pos throw return long iter row read 