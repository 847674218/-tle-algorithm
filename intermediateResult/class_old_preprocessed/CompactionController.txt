licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra compact import java util import googl common collect immut set import org slf logger import org slf logger factori import org apach cassandra config databas descriptor import org apach cassandra import org apach cassandra sstabl tabl ident iter import org apach cassandra sstabl tabl reader import org apach cassandra servic cach servic import org apach cassandra servic storag servic import org apach cassandra util throttl import org apach cassandra util interv tree interv import org apach cassandra util interv tree interv tree manag compact option public class compact control privat static logger logger logger factori logger compact control class public final column famili store cfs privat final boolean deseri requir privat final interv tree tabl reader overlap tree public final int befor public boolean key exist expens public final int merg shard befor privat final throttl throttl throttl cassandra throttl throttl throughput function return instantan throughput target byte millisecond public int target throughput databas descriptor compact throughput sec storag servic instanc bootstrap mode throttl disabl return total throughput int total byte databas descriptor compact throughput sec stream throughput target byte return total byte math max compact manag instanc activ compact public compact control column famili store cfs collect tabl reader sstabl int befor boolean forc deseri cfs befor forc deseri latest version sstabl data tracker build interv tree cfs overlap tabl sstabl cfs compact strategi key exist expens immut set copi sstabl protect compact control column famili store cfs int befor boolean deseri requir interv tree tabl reader overlap tree boolean key exist expens assert cfs null cfs cfs befor befor merg node increment activ memtabl renew befor creation oldest unflush memtabl add minut safe side term thread safeti fine current stop write dure memtabl switch situat merg shard befor int cfs oldest unflush memtabl deseri requir deseri requir overlap tree overlap tree key exist expens key exist expens public string keyspac return cfs tabl public string column famili return cfs column famili return true drop tombston row verison row includ compact set public boolean purg decor key key list tabl reader filter tabl overlap tree search interv key key tabl reader sstabl filter tabl sstabl bloom filter present key key return fals return true privat static boolean latest version iter tabl reader sstabl tabl reader sstabl sstabl sstabl descriptor latest version return fals return true public void invalid cach row decor key key cfs invalid cach row key public void remov delet cach decor key key copi cach serial updat cach row raci updat ignor sinc updat row invalid odd tombston consum memori indefinit problem minim https issu apach org jira brows discuss cach servic instanc row cach put copi return column famili cach row cfs raw cach row key cach row null column famili store remov delet cach row befor return abstract compact row implement write merg row question singl sourc row data current version sstabl don purg aren forc deseri scrub write unchang otherwis deseri purg tombston reseri latest version public abstract compact row compact row list tabl ident iter row long row size tabl ident iter row row row size row data size memori echoedrow onli enabl check key exist sstabl expens simpli serial row row size deseri requir row size databas descriptor memori compact limit key exist expens purg row key return echo row row row size databas descriptor memori compact limit string key string cfs metadata key valid string row key key logger info string format compact larg row byte increment cfs tabl cfs column famili key string row size return lazili compact row row return precompact row row conveni method singl sstabl compact public abstract compact row compact row tabl ident iter row return compact row collect singleton list row public void throttl long current byte throttl throttl current byte 