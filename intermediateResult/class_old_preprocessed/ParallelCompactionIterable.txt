packag org apach cassandra compact licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java import java util array list import java util compar import java util iter import java util list import java util concurr import java util concurr lock condit import googl common collect abstract iter import googl common collect iter import org slf logger import org slf logger factori import org apach cassandra concurr debugg thread pool executor import org apach cassandra concurr thread factori import org apach cassandra config databas descriptor import org apach cassandra import org apach cassandra columniter countabl column iter import org apach cassandra sstabl tabl ident iter import org apach cassandra sstabl tabl reader import org apach cassandra util class run compact advantag multipl core process deseri thread input sstabl perform read deseri row time result column famili ad queue fed merg reduc merg reduc creat merg task thread core executor return async precompact row object main complic handl larger memori row encount deseri row merg written creat pipelin stall intend memori row size preserv correct face occasion public class parallel compact iter extend abstract compact iter privat static logger logger logger factori logger parallel compact iter class privat final int max memori size public parallel compact iter oper type type list compact scanner scanner compact control control throw type scanner control databas descriptor memori compact limit scanner size public parallel compact iter oper type type list compact scanner scanner compact control control int max memori size super control type scanner max memori size max memori size public closeabl iter abstract compact row iter list closeabl iter row sourc array list closeabl iter row scanner size compact scanner scanner scanner sourc add deseri scanner max memori size return unwrapp merg iter sourc row compar reduc control privat static class unwrapp extend abstract iter abstract compact row implement closeabl iter abstract compact row privat final closeabl iter compact row reduc privat final compact control control public unwrapp closeabl iter compact row reduc compact control control reduc reduc control control protect abstract compact row comput reduc return data compact row reduc abstract compact row compact row tri compact row futur null row precompact row key futur catch interrupt throw assert error catch execut throw runtim compact row empti control invalid cach row compact row key tri compact row close catch throw runtim return null els raw cach call remov delet coher queri return howev delet column live longer grace compact free big amount memori long run instanc control invalid cach row compact row key return compact row public void close throw reduc close privat class reduc extend merg iter reduc row compact row privat final list row row array list row privat int row privat final thread pool executor executor debugg thread pool executor util avail processor integ time unit synchron queue runnabl thread factori compact reduc public void reduc row current row add current protect compact row reduc assert row size compact row compact compact row row row clear row long compact scanner scanner scanner scanner current posit byte read control throttl byte read return compact public compact row compact row list row row boolean memori true row row row null memori fals break memori return compact row row key executor submit merg task array list row row list countabl column iter iter array list countabl column iter row size row row iter add row null wrapper deseri column iter row return compact row lazili compact row control iter public void close executor shutdown privat class merg task implement callabl column famili privat final list row row public merg task list row row row row public column famili call throw column famili null row row column famili row null els add array sort column add heap alloc instanc return precompact row remov delet shard row key control privat class deseri column iter implement countabl column iter privat final row row privat iter column iter public deseri column iter row row row row iter row iter public column famili column famili return row public decor key key return row key public int column count return row column count public void reset iter row iter public void close throw public boolean return iter public column return iter public void remov throw unsupport oper privat static class deseri extend abstract iter row implement closeabl iter row privat final link block queue row queue link block queue row privat static final row finish row row null privat condit condit privat final compact scanner scanner public deseri compact scanner ssts final int max memori size scanner ssts runnabl runnabl wrap runnabl protect void run throw throw true condit null condit await scanner queue put finish break tabl ident iter iter tabl ident iter scanner iter data size max memori size logger debug parallel lazi deseri iter path condit simpl condit queue put row notifi tabl ident iter iter condit els logger debug parallel eager deseri iter path queue put row row iter key iter column famili column thread runnabl deseri scanner file start protect row comput row tri queue catch interrupt throw assert error return finish data public void close throw scanner close wrapper notifi condit close privat static class notifi tabl ident iter implement countabl column iter privat final tabl ident iter wrap privat final condit condit public notifi tabl ident iter tabl ident iter wrap condit condit wrap wrap condit condit public column famili column famili return wrap column famili public decor key key return wrap key public int column count return wrap column count public void reset wrap reset public void close throw wrap close condit signal public boolean return wrap public column return wrap public void remov throw unsupport oper privat static class row row null wrapper null public final row row public final notifi tabl ident iter wrapper public static final compar row compar compar row public int compar row row return key compar key privat row row row row row wrapper null public row notifi tabl ident iter wrapper wrapper wrapper row null public decor key key return row null wrapper key row key privat static class compact row public final decor key key futur row null onc public final futur column famili futur public final lazili compact row row privat compact row decor key key futur column famili futur key key futur futur row null privat compact row lazili compact row row row row futur null key null 