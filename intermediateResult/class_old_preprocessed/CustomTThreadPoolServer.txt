licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra thrift import java net socket timeout import java util concurr executor servic import java util concurr atom atom integ import org slf logger import org slf logger factori import org apach thrift import org apach thrift processor import org apach thrift protocol protocol import org apach thrift server server import org apach thrift server thread pool server import org apach thrift transport transport import org apach thrift transport transport slight modifi version apach thrift thread pool server pass executor control actual behaviour task run newer version thrift obsolet public class custom thread pool server extend server privat static final logger logger factori logger custom thread pool server class executor servic handl client connect privat executor servic executor servic flag stop server privat volatil boolean stop server option privat thread pool server arg arg track limit number connect client privat final atom integ activ client atom integ public custom thread pool server thread pool server arg arg executor servic executor servic super arg executor servic executor servic arg arg public void serv tri server transport listen catch transport ttx error error occur dure listen ttx return stop fals stop block max client activ client arg max worker thread tri thread sleep catch interrupt throw assert error tri transport client server transport accept activ client increment worker process worker process client executor servic execut catch transport ttx ttx caus instanceof socket timeout thrift suck continu stop warn transport error occur dure accept messag ttx activ client arg max worker thread warn maximum number client arg max worker thread reach executor servic shutdown thrift default shutdown wait worker process thread complet becaus client hold shutdown hostag simpli send anoth messag stop call sinc process block indefinit tri read meessag header fix updat thrift set socket timeout client connect toler unintent timeout stop set requir deep chang code generat simpli set thread daemon custom clean thread pool ignor shutdown good rememb goal shutdown necessarili client request receiv answer redirect client differ coordin updat ack success generat hint ani respons replica quick stop accept client connect shutdown continu wait worker process thread accomplish messag servic shutdown method care public void stop stop true server transport interrupt privat class worker process implement runnabl client servic privat transport client default constructor param client transport process privat worker process transport client client client loop process client forev public void run processor processor null transport input transport null transport output transport null protocol input protocol null protocol output protocol null tri processor processor factori processor client input transport input transport factori transport client output transport output transport factori transport client input protocol input protocol factori protocol input transport output protocol output protocol factori protocol output transport check stop suppos shut necessari grace shutdown suffici sinc process arbitrarili long wait client input comment serv stop processor process input protocol output protocol input protocol input protocol factori protocol input transport output protocol output protocol factori protocol output transport catch transport ttx assum client die continu silent log debug debug frame larg error debug thrift transport error occur dure process messag ttx catch error thrift error occur dure process messag catch error error occur dure process messag final activ client decrement input transport null input transport close output transport null output transport close 