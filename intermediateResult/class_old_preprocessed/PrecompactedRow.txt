packag org apach cassandra compact licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java data output import java error import java import java secur messag digest import java util list import org slf logger import org slf logger factori import org apach cassandra column famili import org apach cassandra column famili store import org apach cassandra column index import org apach cassandra counter column import org apach cassandra decor key import org apach cassandra sstabl tabl ident iter import org apach cassandra util data output buffer import org apach cassandra util heap alloc precompact row merg row constructor memori public class precompact row extend abstract compact row privat static logger logger logger factori logger precompact row class privat final column famili compact caller respons call remov delet remov shard befor call constructor public precompact row decor key key column famili super key compact public static column famili remov delet shard decor key key compact control control column famili assert key null assert control null assert null avoid call purg actual veri expens hundr overlap sstabl essenti method ugli refactor remov delet shard control purg key control account boolean purg null irrelev data control befor purg control purg key onli tombston purg true otherwis collect column shadow delet remov delet integ column famili compact column famili store remov delet purg null purg control befor integ compact null compact metadata default valid commut purg null purg control purg key purg counter column merg remov shard key compact control befor control merg shard befor return compact public static column famili remov delet shard decor key key boolean purg compact control control column famili comment preced method column famili compact column famili store remov delet purg control befor integ purg compact null compact metadata default valid commut counter column merg remov shard key compact control befor control merg shard befor return compact public precompact row compact control control list tabl ident iter row row key remov delet shard row key control merg row privat static column famili merg list tabl ident iter row assert row empti column famili null tabl ident iter row row column famili tri row column famili column catch throw error null els add array sort column add heap alloc instanc return public long write data output throw assert compact null data output buffer buffer data output buffer data output buffer header buffer data output buffer column index serial compact header buffer column famili serial serial tabl compact buffer int data size header buffer length buffer length write long data size write header buffer data header buffer length write buffer data buffer length return data size public void updat messag digest digest assert compact null data output buffer buffer data output buffer tri column famili serial serial info compact buffer buffer write int compact column count digest updat buffer data buffer length catch throw runtim compact updat digest digest public boolean empti return compact null public int column count return compact null compact column count public long max timestamp return compact max timestamp return full column famili repres compact row provid method abstract compact row becaus fit row memori don sens implement public column famili full column famili throw return compact public void close 