packag org apach cassandra commitlog licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java import java util array list import java util concurr import org apach cassandra config databas descriptor import org apach cassandra util wrap runnabl class batch commit log executor servic extend abstract commit log executor servic privat final block queue cheater futur task queue privat final thread append thread privat volatil boolean run true public batch commit log executor servic databas descriptor concurr writer public batch commit log executor servic int queue size queue link block queue cheater futur task queue size runnabl runnabl wrap runnabl public void run throw throw run process sync batch complet task count append thread thread runnabl append thread start public long pend task return queue size privat final array list cheater futur task incomplet task array list cheater futur task privat final array list task valu array list generifi privat boolean process sync batch throw cheater futur task task queue poll time unit task null return fals task raw callabl instanceof commit log log record adder task run return true attempt bunch log record adder op befor sync littl clunki sinc block peek method break task extra task incomplet task clear task valu clear long system nano time long databas descriptor commit log sync batch window doesn worth bother futur ize sinc commitlog throw probabl screw incomplet task add task task valu add task raw callabl call queue empti queue peek raw callabl instanceof commit log log record adder system nano time cheater futur task task queue remov incomplet task add task task valu add task raw callabl call sync set task valu thread call proceed tri commit log instanc sync catch throw runtim int incomplet task size incomplet task set task valu return true overrid protect runnabl futur task runnabl runnabl valu return task executor callabl runnabl valu overrid protect runnabl futur task callabl callabl return cheater futur task callabl public void execut runnabl command tri queue put cheater futur task command catch interrupt throw runtim public void add commit log log record adder adder tri submit callabl adder catch interrupt throw runtim catch execut throw runtim public void shutdown thread wrap runnabl public void run throw throw interrupt queue empti thread sleep run fals append thread join commitlog shutdown start public void await termin throw interrupt append thread join privat static class cheater futur task extend futur task privat final callabl raw callabl public cheater futur task callabl callabl super callabl raw callabl callabl public callabl raw callabl return raw callabl overrid public void set super set 