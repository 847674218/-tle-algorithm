packag org apach cassandra hadoop licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens import java import java net inet address import java nio byte buffer import java util array list import java util collect import java util list import java util random import java util sort map import java util concurr callabl import java util concurr executor servic import java util concurr executor import java util concurr futur import googl common collect immut list import googl common collect list import org apach common lang string util import org apach thrift applic import org slf logger import org slf logger factori import org apach cassandra column import org apach cassandra dht partition import org apach cassandra dht rang import org apach cassandra dht token import org apach cassandra thrift import org apach hadoop conf configur import org apach hadoop mapr job conf import org apach hadoop mapr report import org apach hadoop mapreduc import org apach thrift hadoop input format map reduc cassandra row column famili minimum set predic descript column extract row hadoop job configur config helper class provid simpl config helper set column famili config helper set slice predic configur number row input split config helper set input split size big possibl bigger input split read cassandra multipl slice rang queri call overhead slice rang high larger split size larg run memori default split size row public class column famili input format extend input format byte buffer sort map byte buffer column implement org apach hadoop mapr input format byte buffer sort map byte buffer column privat static final logger logger logger factori logger column famili input format class public static final string mapr task simpl fact becaus hadoop write key valu wherea choos default max key size instanci onli onc overrid job conf set public static final string cassandra hadoop max key size public static final int privat string keyspac privat string privat partition partition privat static void valid configur configur conf config helper input keyspac conf null config helper input column famili conf null throw unsupport oper set keyspac columnfamili set column famili config helper input slice predic conf null throw unsupport oper set predic set predic config helper input initi address conf null throw unsupport oper set initi output address cassandra node config helper input partition conf null throw unsupport oper set cassandra partition class public list input split split job context context throw configur conf context configur valid configur conf cannon rang node hold replica list token rang master rang node rang map conf keyspac config helper input keyspac context configur config helper input column famili context configur partition config helper input partition context configur logger debug partition partition cannon rang split piec fetch split parallel executor servic executor executor cach thread pool list input split split array list input split tri list futur list input split splitfutur array list futur list input split key rang job key rang config helper input key rang conf rang token job rang null job key rang null job key rang start token null assert partition preserv order config helper set input key rang onli order preserv parition assert job key rang start key null onli start token support assert job key rang key null onli token support job rang rang token partition token factori string job key rang start token partition token factori string job key rang token partition token rang rang master rang node job rang null rang pick live owner comput bite size split splitfutur add executor submit split callabl rang conf els rang token dht rang rang token partition token factori string rang start token partition token factori string rang token partition dht rang intersect job rang rang token intersect dht rang intersect job rang rang start token partition token factori string intersect left rang token partition token factori string intersect rang pick live owner comput bite size split splitfutur add executor submit split callabl rang conf wait result futur list input split futur input split splitfutur tri split add futur input split catch throw input split final executor shutdown assert split size collect shuffl split random system nano time return split token rang split accord suggest size input split hadoop class split callabl implement callabl list input split privat final token rang rang privat final configur conf public split callabl token rang configur conf rang conf conf public list input split call throw array list input split split array list input split list split split split keyspac rang conf assert rang rpc endpoint size rang endpoint size rpc endpoint size match endpoint size turn rang input split string endpoint rang endpoint array string rang endpoint size hadoop hostnam int endpoint index string endpoint rang rpc endpoint string endpoint address endpoint endpoint address null endpoint address equal endpoint address rang endpoint endpoint index endpoint endpoint index inet address endpoint address host token token factori factori partition token factori split split split token left factori string split start token token factori string split token rang token rang rang token left partition list rang token rang rang wrap rang unwrap immut list rang rang token subrang rang column famili split split column famili split factori string subrang left factori string subrang split row count endpoint logger debug ad split split add split return split privat list split split string keyspac string token rang rang configur conf throw int splitsiz config helper input split size conf int rang rpc endpoint size string host rang rpc endpoint host null host equal host rang endpoint tri cassandra client client config helper creat connect conf host config helper input rpc port conf client set keyspac keyspac tri return client describ split rang start token rang token splitsiz catch applic fallback guess split size talk server describ split method type applic list string split point client describ split rang start token rang token splitsiz return token list split split point splitsiz throw catch logger debug fail connect endpoint host catch throw runtim catch invalid request throw runtim throw fail connect endpoint string util join rang endpoint privat list split token list split list string split token int splitsiz list split split list array list expect size split token size int split token size split add split split token split token splitsiz return split privat list token rang rang map configur conf throw cassandra client client config helper client input address list conf list token rang map tri map client describ ring config helper input keyspac conf catch throw runtim catch invalid request throw runtim return map public record reader byte buffer sort map byte buffer column creat record reader input split input split task attempt context task attempt context throw interrupt return column famili record reader hadoop public org apach hadoop mapr input split split job conf job conf int num split throw task attempt context tac task attempt context job conf task attempt list org apach hadoop mapreduc input split input split split tac org apach hadoop mapr input split input split org apach hadoop mapr input split input split size int input split size input split column famili split input split return input split public org apach hadoop mapr record reader byte buffer sort map byte buffer column record reader org apach hadoop mapr input split split job conf job conf final report report throw task attempt context tac task attempt context job conf task attempt job conf overrid public void progress report progress column famili record reader record reader column famili record reader job conf int record reader initi org apach hadoop mapreduc input split split tac return record reader 