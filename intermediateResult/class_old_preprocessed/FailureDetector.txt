licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra gms import java import java lang manag manag factori import java net inet address import java net unknown host import java util import java util concurr copi write array list import javax manag bean server import javax manag object import org apach common lang string util import org slf logger import org slf logger factori import org apach cassandra config databas descriptor import org apach cassandra util file util import org apach cassandra util bound stat dequ import org apach cassandra util util failur detector implement paper titl phi accrual failur detector hayashibara check paper failur detector interfac detail public class failur detector implement failur detector failur detector bean public static final string org apach cassandra net type failur detector public static final failur detector instanc failur detector privat static logger logger logger factori logger failur detector class privat static final int sampl size privat static int phi convict threshold privat map inet address arriv window arriv sampl hashtabl inet address arriv window privat list failur detect event listen evnt listen copi write array list failur detect event listen public failur detector phi convict threshold databas descriptor phi convict threshold regist instanc tri bean server mbs manag factori platform bean server mbs regist bean object catch throw runtim public string endpoint state string builder string builder map entri inet address endpoint state entri gossip instanc endpoint state map entri set append entri key append append endpoint state entri valu return string public map string string simpl state map string string node status hash map string string gossip instanc endpoint state map size map entri inet address endpoint state entri gossip instanc endpoint state map entri set entri valu aliv node status put entri key string els node status put entri key string return node status public string endpoint state string address throw unknown host string builder string builder endpoint state endpoint state gossip instanc endpoint state endpoint inet address address append endpoint state endpoint state return string privat void append endpoint state string builder endpoint state endpoint state map entri applic state version valu state endpoint state applic state entri set append append state key append append state valu valu append dump inter arriv time examin necessari public void dump inter arriv time output stream null tri file file file creat temp file failuredetector dat buffer output stream file output stream file true write string byte catch throw error final file util close quiet public void set phi convict threshold int phi phi convict threshold phi public int phi convict threshold return phi convict threshold public boolean aliv inet address equal util broadcast address return true endpoint state state gossip instanc endpoint state endpoint assert null aliv fail screw node bad worth defens minor bug don caus disproportion bad exampl state null logger error unknown endpoint return state null state aliv public void clear inet address arriv window heartbeat window arriv sampl heartbeat window null heartbeat window clear public void report inet address logger trace enabl logger trace report long system current time milli arriv window heartbeat window arriv sampl heartbeat window null heartbeat window arriv window sampl size arriv sampl put heartbeat window heartbeat window add public void interpret inet address arriv window wnd arriv sampl wnd null return long system current time milli doubl phi wnd phi logger trace enabl logger trace phi phi phi convict threshold logger trace notifi listen logger trace interv wnd wnd failur detect event listen listen evnt listen listen convict phi public void forc convict inet address logger debug forc convict failur detect event listen listen evnt listen listen convict phi convict threshold public void remov inet address arriv sampl remov public void regist failur detect event listen failur detect event listen listen evnt listen add listen public void unregist failur detect event listen failur detect event listen listen evnt listen remov listen public string string string builder string builder set inet address ep arriv sampl key set append inet address ep arriv window wnd arriv sampl append append wnd string append system properti line separ append return string public static void main string arg throw throwabl class arriv window privat static logger logger logger factori logger arriv window class privat doubl privat bound stat dequ arriv interv useless provid compat phi convict threshold becaus everyon pretti accustom default user alreadi tune phi convict threshold environ won chang privat final doubl math log event long partit record interv longer rpc timeout sinc host regular experienc connect problem long mark quick adapt privat final doubl databas descriptor rpc timeout arriv window int size arriv interv bound stat dequ size synchron void add doubl valu doubl inter arriv time inter arriv time valu els inter arriv time gossip interv milli inter arriv time arriv interv add inter arriv time els logger debug ignor interv time inter arriv time valu synchron doubl sum return arriv interv sum synchron doubl sum deviat return arriv interv sum deviat synchron doubl return arriv interv synchron doubl varianc return arriv interv varianc doubl stdev return arriv interv stdev void clear arriv interv clear explan math work synchron doubl phi long tnow int size arriv interv size doubl tnow return size public string string return string util join arriv interv iter 