public byte buffer comput shard merger byte buffer context list counter counter record id long merg befor long system current time milli int hlength header length context counter local counter local iter counter counter record record iter id iter counter counter record curr record record iter record iter null context state state context state context hlength list counter merg array list counter long merg total state remain curr record null assert curr record equal local counter counter state counter int counter compar curr record curr record record iter record iter null continu state delta state clock alreadi merg shard wait collect counter equal local creat problemat context prior throw runtim current counter negat clock due restart node dcassandra renew counter true fix state count happen previous bug generat fix logger error string format invalid counter context clock count counter fix state count state count counter string merg add counter merg total state count els howev merg renew isn safe check renew befor merg befor curr record timestamp merg befor merg add counter merg total state count curr record record iter record iter null state move continu iter repair invalid shard state remain counter counter state counter state delta state clock counter equal local creat problemat context prior throw runtim current counter negat clock due restart node dcassandra renew counter true fix state count happen previous bug generat fix logger error string format invalid counter context clock count counter fix state clock state count counter string merg add counter merg total state count state move merg empti return null context state merger context state alloc merg size merg size state reset int int remov total boolean local written fals state remain counter counter state counter counter compar local merger write element local merg total true local written true els merg size counter compar merg long count state count remov total count merger write element counter state clock count true state move local written merger write element local merg total true saniti check assert merg total remov total return merger context 