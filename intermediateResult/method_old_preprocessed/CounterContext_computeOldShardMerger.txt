public byte buffer comput shard merger byte buffer context list node node record id long merg befor long system current time milli int hlength header length context node local node local iter node node record record iter id iter node node record curr record record iter record iter null context state state context state context hlength context state state null list node merg array list node long merg total state remain curr record null assert curr record equal local node node state node int node compar curr record curr record record iter record iter null continu state delta state clock alreadi merg shard wait collect node equal local creat problemat context prior throw runtim current node negat clock due restart node dcassandra renew counter true fix state count happen previous bug generat fix logger error string format invalid counter context clock count node fix state count state count node string merg add node merg total state count els howev merg renew isn safe check renew befor merg befor curr record timestamp merg befor merg add node merg total state count curr record record iter record iter null state move continu iter repair invalid shard state remain node node state node state delta state clock node equal local creat problemat context prior throw runtim current node negat clock due restart node dcassandra renew counter true fix state count happen previous bug generat fix logger error string format invalid counter context clock count node fix state clock state count node string merg add node merg total state count state move merg empti return null context state merger context state alloc merg size merg size state reset int int remov total boolean local written fals state remain node node state node node compar local merger write element local merg total true local written true els merg size node compar merg long count state count remov total count merger write element node state clock count true state move local written merger write element local merg total true saniti check assert merg total remov total return merger context 