public futur mayb switch memtabl memtabl memtabl final boolean write commit log memtabl frozen logger debug memtabl alreadi frozen anoth thread flush return null writelock updat ongo updat memtabl complet tail log start posit log replay recoveri whi tabl switch lock global tabl schedul discard complet segment call order context commitlog posit read flush executor multithread tabl switch lock write lock lock tri memtabl frozen logger debug memtabl alreadi frozen anoth thread flush return null assert memtabl thread safe memtabl final futur replay posit ctx write commit log commit log instanc context futur immedi futur replay posit submit memtabl ani index cfses final list column famili store icc array list column famili store don assum memtabl dirti forc flush bring dure index build column famili store cfs concat index memtabl cfs memtabl thread safe clean frozen freez index becaus concurr flush freez icc add cfs final count latch latch count latch icc size column famili store cfs icc memtabl memtabl cfs data switch memtabl logger info enqueu flush memtabl memtabl flush signal latch flush writer ctx memtabl switch count integ memtabl switch count memtabl switch count memtabl written includ index mark flush commitlog header executor memtabl flush call order wait flush futur anyth latenc sensit return post flush executor submit wrap runnabl public void run throw throw interrupt execut latch await icc empti onli valid memtabl exist secondari index index index manag index cfs flush ani cfs index logger info flush secondari index index index forc block flush write commit log write commit log replay log mark log header discard anyth written befor context valid commit log instanc discard complet segment metadata ctx final tabl switch lock write lock unlock 