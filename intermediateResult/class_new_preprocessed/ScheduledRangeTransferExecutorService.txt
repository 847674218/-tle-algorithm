licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra servic import static org apach cassandra cql queri processor process intern import java nio byte buffer import java util collect import java util date import java util concurr executor import java util concurr schedul executor servic import java util concurr thread factori import java util concurr time unit import java util concurr atom atom integ import org apach cassandra config databas descriptor import org apach cassandra cql untyp result set import org apach cassandra system tabl import org apach cassandra dht token import org apach cassandra util byte buffer util import org slf logger import org slf logger factori public class schedul rang transfer executor servic privat static final logger logger factori logger schedul rang transfer executor servic class privat static final int privat schedul executor servic schedul public void setup databas descriptor num token warn start rang transfer schedul endpoint virtual node enabl return schedul executor singl thread schedul executor rang transfer thread factori schedul schedul fix delay rang transfer time unit info enabl schedul transfer token rang public void tear schedul null warn unabl shutdown schedul enabl return info shut rang transfer schedul schedul shutdown class rang transfer implement runnabl privat static final logger logger factori logger rang transfer class public void run untyp result set res process intern system system tabl res size debug queu rang transfer return readi return untyp result set row row res iter date request row timestamp request byte buffer token byte row byte token byte token token storag servic partition token factori byte array token byte info initi transfer schedul token request string tri storag servic instanc reloc token collect singleton token catch error error remov token final debug remov queu entri transfer token process intern string format system token byte system tabl byte buffer util byte hex token byte privat boolean readi int target token databas descriptor num token int high mark int math ceil target token target token int actual token storag servic instanc token size actual token high mark warn paus token count stabil target actual target token actual token return fals return true class rang transfer thread factori implement thread factori privat atom integ count atom integ public thread thread runnabl thread rang xfer thread thread rang xfer thread set string format schedul rang xfer count increment return rang xfer thread 