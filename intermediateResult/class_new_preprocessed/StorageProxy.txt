licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra servic import java data output stream import java import java lang manag manag factori import java net inet address import java nio byte buffer import java util import java util concurr import java util concurr atom atom integ import java util concurr atom atom long import javax manag bean server import javax manag object import googl common base function import googl common collect import org apach common lang string util import org slf logger import org slf logger factori import org apach cassandra concurr stage import org apach cassandra concurr stage manag import org apach cassandra config meta data import org apach cassandra config databas descriptor import org apach cassandra config schema import org apach cassandra import org apach cassandra tabl import org apach cassandra filter column slice import org apach cassandra filter disk atom filter import org apach cassandra filter queri path import org apach cassandra filter slice queri filter import org apach cassandra marshal type import org apach cassandra dht abstract bound import org apach cassandra dht bound import org apach cassandra dht ring posit import org apach cassandra dht token import org apach cassandra import org apach cassandra gms failur detector import org apach cassandra gms gossip import org apach cassandra util fast byte array output stream import org apach cassandra locat abstract replic strategi import org apach cassandra locat endpoint snitch import org apach cassandra locat token metadata import org apach cassandra metric client request metric import org apach cassandra net import org apach cassandra trace trace import org apach cassandra util byte buffer util import org apach cassandra util util import org apach cassandra util pair public class storag proxi implement storag proxi bean public static final string org apach cassandra type storag proxi privat static final logger logger logger factori logger storag proxi class privat static final boolean true set fals test messagingservic path singl node public static final string privat static final write perform standard write perform privat static final write perform counter write perform privat static final write perform counter write coordin perform public static final storag proxi instanc storag proxi privat static volatil int max hint progress util avail processor privat static final atom integ total hint progress atom integ privat static final map inet address atom integ hint progress map maker concurr level comput map function inet address atom integ public atom integ appli inet address inet address return atom integ privat static final atom long total hint atom long privat static final client request metric read metric client request metric read privat static final client request metric rang metric client request metric rang slice privat static final client request metric write metric client request metric write privat storag proxi static bean server mbs manag factori platform bean server tri mbs regist bean storag proxi object catch throw runtim standard write perform write perform public void appli mutat mutat iter inet address target abstract write respons handler respons handler string local data center consist level consist level throw overload assert mutat instanceof row mutat send hint endpoint row mutat mutat target respons handler local data center consist level execut counter write place direct coordin node replica counter mutat verb handler replica othewis write execut stage case verb handler alreadi run stage execut stage otherwis risk deadlock henc differ perform counter write perform write perform public void appli mutat mutat iter inet address target abstract write respons handler respons handler string local data center consist level consist level throw logger trace enabl logger trace insert write local replic mutat string true runnabl runnabl counter write task mutat target respons handler local data center consist level runnabl run counter write coordin perform write perform public void appli mutat mutat iter inet address target abstract write respons handler respons handler string local data center consist level consist level throw logger trace enabl logger trace insert write local replic mutat string true runnabl runnabl counter write task mutat target respons handler local data center consist level stage manag stage stage execut runnabl method mutat appli replica method care possibl replica hint data replica param mutat mutat appli replica param consist level consist level oper public static void mutat collect extend mutat mutat consist level consist level throw unavail overload write timeout trace trace determin replica mutat logger trace mutat consist level mutat consist level final string local data center databas descriptor endpoint snitch datacent util broadcast address long start time system nano time list abstract write respons handler respons handler array list abstract write respons handler mutat size mutat mutat null tri mutat mutat mutat mutat mutat mutat instanceof counter mutat respons handler add mutat counter counter mutat mutat local data center els write type mutat size write type write type respons handler add perform write mutat consist level local data center standard write perform null wait write throw timeout necessari abstract write respons handler respons handler respons handler respons handler catch write timeout write metric timeout mark client request metric write timeout logger debug enabl list string mstring array list string mutat size mutat mutat mutat mstring add mutat string true logger debug write timeout string mstring trace trace write timeout throw catch unavail write metric unavail mark client request metric write unavail trace trace unavail throw catch overload client request metric write unavail trace trace overload throw catch assert mutat null throw runtim error write key byte buffer util byte hex mutat key final write metric add nano system nano time start time mutat add addit step befor write batch befor write batch avail check row replica write entir batch batchlog elsewher cluster remov batchlog entri write hint batch row necessari param mutat row mutat appli replica param consist level consist level oper public static void mutat atom collect row mutat mutat consist level consist level throw unavail overload write timeout trace trace determin replica atom batch long start time system nano time logger trace mutat consist level mutat consist level list write respons handler wrapper wrapper array list write respons handler wrapper mutat size string local data center databas descriptor endpoint snitch datacent util broadcast address tri add handler mutat includ check avail doesn initi ani write row mutat mutat mutat write respons handler wrapper wrapper wrap respons handler mutat consist level write type exit earli fulfil time wrapper handler assur suffici live node wrapper add wrapper write batchlog collect inet address batchlog endpoint batchlog endpoint local data center batch random sync write batchlog mutat batchlog endpoint batch actual perform write wait complet sync write batch mutat wrapper local data center consist level remov batchlog entri asynchron async remov batchlog batchlog endpoint batch catch unavail write metric unavail mark client request metric write unavail trace trace unavail throw catch write timeout write metric timeout mark client request metric write timeout trace trace write timeout throw final write metric add nano system nano time start time privat static void sync write batchlog collect row mutat mutat collect inet address endpoint uuid throw write timeout row mutat batchlog manag batchlog mutat mutat uuid abstract write respons handler handler write respons handler endpoint collect inet address empti list consist level tabl open tabl null write type updat batchlog endpoint handler handler privat static void async remov batchlog collect inet address endpoint uuid row mutat row mutat tabl type instanc decompos uuid delet queri path system tabl util timestamp micro abstract write respons handler handler write respons handler endpoint collect inet address empti list consist level tabl open tabl null write type updat batchlog endpoint handler privat static void updat batchlog row mutat collect inet address endpoint abstract write respons handler handler endpoint util broadcast address assert endpoint size insert local handler els send messag creat messag endpoint true handler privat static void sync write batch mutat list write respons handler wrapper wrapper string local data center consist level consist level throw write timeout overload write respons handler wrapper wrapper wrapper iter inet address endpoint iter concat wrapper handler natur endpoint wrapper handler pend endpoint send hint endpoint wrapper mutat endpoint wrapper handler local data center consist level write respons handler wrapper wrapper wrapper wrapper handler perform write mutat write perform gather list write endpoint appli local mutat write endpoint deletag actual write perform wait respons base consist level param mutat mutat appli param consist level consist level write oper param perform write perform charg appliy mutat list write endpoint standard write perform standard write counter write perform counter write param callback option callback run write success public static abstract write respons handler perform write mutat mutat consist level consist level string local data center write perform perform runnabl callback write type write type throw unavail overload string tabl mutat tabl abstract replic strategi tabl open tabl replic strategi token storag servic partition token mutat key list inet address natur endpoint storag servic instanc natur endpoint tabl collect inet address pend endpoint storag servic instanc token metadata pend endpoint tabl abstract write respons handler respons handler write respons handler natur endpoint pend endpoint consist level callback write type exit earli fulfil time respons handler assur suffici live node perform appli mutat iter concat natur endpoint pend endpoint respons handler local data center consist level return respons handler abov doe initi write doe perfrom avail check privat static write respons handler wrapper wrap respons handler row mutat mutat consist level consist level write type write type abstract replic strategi tabl open mutat tabl replic strategi string tabl mutat tabl token storag servic partition token mutat key list inet address natur endpoint storag servic instanc natur endpoint tabl collect inet address pend endpoint storag servic instanc token metadata pend endpoint tabl abstract write respons handler respons handler write respons handler natur endpoint pend endpoint consist level null write type return write respons handler wrapper respons handler mutat atom batch mutat decoupl avail check write cach consist level endpoint privat static class write respons handler wrapper final abstract write respons handler handler final row mutat mutat write respons handler wrapper abstract write respons handler handler row mutat mutat handler handler mutat mutat replica pick manual replica aliv accord failur detector replica local datacent choos min number qualifi candiat abov local node onli replica onli singl node cluster privat static collect inet address batchlog endpoint string local data center throw unavail includ everi node includ localhost token metadata topolog topolog storag servic instanc token metadata clone onli token map topolog collect inet address local member topolog datacent endpoint local data center special case singl node datacent local member size return local member singl node cluster don count local node local member remov util broadcast address includ onli aliv node list inet address candid array list inet address local member size inet address member local member failur detector instanc aliv member candid add member candid empti throw unavail consist level candid size endpoint snitch snitch databas descriptor endpoint snitch snitch sort proxim util broadcast address candid candid candid list return candid send mutat target write local correspond write hint node avail note hint hint handoff consist level wait hint notifi handler handler respons hint wait hint respons count consist fire hint wait complet fire hint wait complet throw timeout hint written enqueu public static void send hint endpoint final row mutat iter inet address target abstract write respons handler respons handler string local data center consist level consist level throw overload multimap hold messag address meant specif datacent map string multimap messag inet address messag hash map string multimap messag inet address inet address destin target avoid ming due excess hint check live node sinc generat hint overload simpli dead dead idea max hint progress hint flight probabl due small number node caus problem avoid shut write complet healthi node ani node hint progress consid healthi total hint progress max hint progress hint progress destin hint destin throw overload mani flight hint total hint progress failur detector instanc aliv destin destin equal util broadcast address insert local respons handler els belong differ server logger trace enabl logger trace insert write key byte buffer util byte hex key destin string databas descriptor endpoint snitch datacent destin multimap messag inet address messag messag messag null messag hash multimap creat messag put messag messag put creat messag destin els hint destin continu schedul local hint submit hint destin respons handler consist level send messag local data center messag respons handler public static futur void submit hint final row mutat mutat final inet address target final abstract write respons handler respons handler final consist level consist level local write time handl local mutat runnabl assert target equal util broadcast address target hint runnabl runnabl hint runnabl target public void run throw throw logger debug ad hint target write hint mutat mutat target notifi handler onli respons handler null consist level consist level respons handler respons null return submit hint runnabl privat static futur void submit hint hint runnabl runnabl total hint progress increment hint progress runnabl target increment return futur void stage manag stage stage submit runnabl public static void write hint mutat row mutat mutat inet address target throw host storag servic instanc token metadata host target host null messag servic instanc version target messag servic logger warn unabl store hint host node target string return assert host null host target host address row mutat hint mutat row mutat hint mutat host hint mutat appli total hint increment datacent send messag node relay write replica privat static void send messag string local data center map string multimap messag inet address messag abstract write respons handler handler map entri string multimap messag inet address entri messag entri set boolean local entri key equal local data center map entri messag collect inet address messag entri valu map entri set messag messag messag key collect inet address target messag valu singl messag object unhint write clean ani previous loop iter messag messag header remov row mutat send messag messag target local handler privat static void send messag messag messag collect inet address target boolean local abstract write respons handler handler tri send messag intern messag target local handler catch throw runtim privat static void send messag intern messag messag collect inet address target boolean local abstract write respons handler handler throw iter inet address iter target iter inet address target iter direct write local cassandra version local messag servic instanc version target messag servic loop loop code clunki avoid creat iter sinc alreadi perfect good messag servic instanc send messag target handler iter target iter messag servic instanc send messag target handler return add destin messag entri fast byte array output stream bos fast byte array output stream data output stream dos data output stream bos dos write int target size iter inet address destin iter compact endpoint serial helper serial destin dos string messag servic instanc add callback handler messag destin messag timeout dos write logger trace ad messag destin messag messag paramet row mutat bos byte array send combin messag header string messag servic instanc send messag target handler logger trace send messag target privat static void insert local final row mutat final abstract write respons handler respons handler logger trace enabl logger trace insert write local string true runnabl runnabl droppabl runnabl messag servic verb public void run throw throw appli respons handler respons null stage manag stage stage execut runnabl handl counter mutat coordin host counter mutat appli replica call leader mutat befor replic endpoint achiev case coordin host replica proceed appli updat local replic throug appli counter mutat coordin coordin replica counter mutat chosen replica proceed appli counter mutat leader receiv wait acknowledg implement note check fulfil coordin host replica quicker respons becaus write respons handler don easi send error alway gather write latenc coordin node gather point similar case standard write public static abstract write respons handler mutat counter counter mutat string local data center throw unavail overload inet address endpoint find suitabl endpoint tabl key local data center consist endpoint equal util broadcast address return appli counter mutat coordin local data center els exit fulfil leader replica string tabl tabl abstract replic strategi tabl open tabl replic strategi token storag servic partition token key list inet address natur endpoint storag servic instanc natur endpoint tabl collect inet address pend endpoint storag servic instanc token metadata pend endpoint tabl write respons handler natur endpoint pend endpoint consist null write type assur suffici live node actual updat chosen leader replica abstract write respons handler respons handler write respons handler endpoint write type logger trace enabl logger trace counter updat key byte buffer util byte hex key endpoint messag servic instanc send mutat messag endpoint respons handler return respons handler find suitabl replica leader counter updat pick random replica local snitch replica aliv local track latenc counter write sens contrarili standard write sinc read involv trust dynam snitch entir solut unclear mix latenc read latenc bit involv privat static inet address find suitabl endpoint string tabl byte buffer key string local data center consist level throw unavail tabl tabl tabl open tabl endpoint snitch snitch databas descriptor endpoint snitch list inet address endpoint storag servic instanc live natur endpoint tabl key endpoint empti comput consist level throw unavail block tabl list inet address local endpoint array list inet address inet address endpoint endpoint snitch datacent endpoint equal local data center local endpoint add endpoint local endpoint empti endpoint local pick closest endpoint accord snitch snitch sort proxim util broadcast address endpoint return endpoint els return local endpoint util thread local random int local endpoint size call replica mutat replica becom leader mutat public static abstract write respons handler appli counter mutat leader counter mutat string local data center runnabl callback throw unavail overload return perform write consist local data center counter write perform callback write type appli counter mutat leader differ stage execut write appli counter mutat leader assum stage alreadi public static abstract write respons handler appli counter mutat coordin counter mutat string local data center throw unavail overload return perform write consist local data center counter write coordin perform null write type privat static runnabl counter write task final mutat mutat final iter inet address target final abstract write respons handler respons handler final string local data center final consist level consist level return local mutat runnabl public void run throw throw assert mutat instanceof counter mutat final counter mutat counter mutat mutat appli mutat appli respons handler respons null send replica ani final set inet address remot set differ immut set copi target immut set util broadcast address replic write remot empti replic anoth stage becaus involv read replic mutat avoid block stage stage manag stage stage execut droppabl runnabl messag servic verb public void run throw throw overload send mutat replica send hint endpoint replic mutat remot respons handler local data center consist level privat static boolean system tabl queri list read command cmds read command cmd cmds cmd tabl equal tabl return fals return true perform actual read row storag servic fetch specif set column column famili public static list row read list read command command consist level consist level throw unavail bootstrap read timeout storag servic instanc bootstrap mode system tabl queri command read metric unavail mark client request metric read unavail throw bootstrap long start time system nano time list row row null tri row fetch row command consist level catch unavail read metric unavail mark client request metric read unavail throw catch read timeout read metric timeout mark client request metric read timeout throw final read metric add nano system nano time start time return row function execut local remot read block result replica locat sort respons time accord snitch send data request closest replica digest request replica read repair enabl closest replica number requir satisfi consist level wait respons replica digest ani match data return data els carri read repair data node privat static list row fetch row list read command initi command consist level consist level throw unavail read timeout list row row array list row initi command size list read command command retri collect empti list list read command command command retri empti initi command command retri read callback read respons row read callback read callback command size command retri empti logger debug retri command command retri size send read request int command size read command command command tabl tabl tabl open command keyspac assert command digest queri logger trace command consist level command consist level list inet address endpoint live sort endpoint tabl command key meta data cfm schema instanc meta data command keyspac command column famili endpoint consist level filter queri tabl endpoint cfm read repair decis row digest resolv resolv row digest resolv command tabl command key read callback read respons row handler read callback resolv consist level command endpoint handler assur suffici live node assert endpoint empti read callback handler data request messag data point node actual data inet address data point endpoint data point equal util broadcast address logger trace read data local stage manag stage stage execut local read runnabl command handler els logger trace read data data point messag servic instanc send command creat messag data point handler endpoint size continu send endpoint digest request read command digest command command copi digest command set digest queri true messag messag null inet address digest point endpoint list endpoint size digest point equal util broadcast address logger trace read digest local stage manag stage stage execut local read runnabl digest command handler els logger trace read digest digest point lazi construct digest messag object sinc necessari local digest read digest read messag null messag digest command creat messag messag servic instanc send messag digest point handler read result pass ani digest mismatch list read command repair command null list read callback read respons row repair respons handler null int command size read callback read respons row handler read callback read command command command tri row row handler row null command mayb trim row row add row catch read timeout logger debug enabl logger debug read timeout string throw catch digest mismatch logger debug digest mismatch string full data read resolv correct respons repair node row data resolv resolv row data resolv command tabl command key command filter read callback read respons row repair handler handler resolv resolv repair command null repair command array list read command repair respons handler array list read callback read respons row repair command add command repair respons handler add repair handler inet address endpoint handler endpoint messag read command messag command creat messag messag servic instanc send messag endpoint repair handler command retri collect command retri clear read result digest mismatch retri repair respons handler null int repair command size read command command repair command read callback read respons row handler repair respons handler row row tri row handler catch digest mismatch throw assert error full data request node digest row data resolv resolv row data resolv handler resolv tri wait repair write acknowledg minim impact ani replica write case sync row read multipl time quick success util wait futur resolv repair result databas descriptor write rpc timeout catch timeout int block consist level block tabl open command keyspac throw read timeout consist level block block true retri ani potenti short read read command retri command command mayb generat retri command resolv row retri command null logger debug issu retri read command command retri collect command retri array list read command command retri add retri command continu row null command mayb trim row row add row command retri empti return row static class local read runnabl extend droppabl runnabl privat final read command command privat final read callback read respons row handler privat final long start system current time milli local read runnabl read command command read callback read respons row handler super messag servic verb command command handler handler protect void run throw throw logger trace local read runnabl read command tabl tabl tabl open command tabl row command row tabl read respons result read verb handler respons command messag servic instanc add latenc util broadcast address system current time milli start handler respons result static class local rang slice runnabl extend droppabl runnabl privat final rang slice command command privat final read callback rang slice repli iter row handler privat final long start system current time milli local rang slice runnabl rang slice command command read callback rang slice repli iter row handler super messag servic verb command command handler handler protect void run throw throw execut interrupt logger trace local read runnabl read command rang slice repli result rang slice repli rang slice verb handler execut local command messag servic instanc add latenc util broadcast address system current time milli start handler respons result privat static list inet address live sort endpoint tabl tabl byte buffer key return live sort endpoint tabl storag servic instanc partition decor key key privat static list inet address live sort endpoint tabl tabl ring posit pos list inet address live endpoint storag servic instanc live natur endpoint tabl pos databas descriptor endpoint snitch sort proxim util broadcast address live endpoint return live endpoint privat static list inet address intersect list inet address list inet address note don guava set intersect reason retain ineffici larg practic replica rang veri small case retain fact effici ultim list convert everyth set don sens sort proxim retain maintain sort result set wouldn list inet address inter array list inet address inter retain return inter public static list row rang slice rang slice command command consist level consist level throw unavail read timeout trace trace determin replica queri logger trace command consist level command string consist level long start time system nano time tabl tabl tabl open command keyspac list row row scan result tri disk atom filter command predic command predic int cql row count row array list row list abstract bound row posit rang restrict rang command rang int abstract bound row posit rang null list inet address endpoint null list inet address filter endpoint null rang size abstract bound row posit rang rang null rang rang list inet address live endpoint endpoint null live sort endpoint tabl rang endpoint list inet address filter endpoint filter endpoint null consist level filter queri tabl live endpoint filter endpoint restrict rang broken queri rang vnode token rang doesn replic factor account intersect live endpoint consecut rang meet requir merg rang rang slice command rang size rang rang endpoint live sort endpoint tabl rang filter endpoint consist level filter queri tabl endpoint current rang min token stop merg becaus rang slice don deal wrap rang note slight effici rang slice destin node unwrap rang necessari deal howev start send wrap rang break wire compat easier bother rang minimum break list inet address merg intersect live endpoint endpoint check endpoint merg possibl consist level suffici live node tabl merg break list inet address filter merg consist level filter queri tabl merg estim merg win databas descriptor endpoint snitch worth merg rang queri filter merg filter endpoint filter endpoint break merg rang rang rang rang live endpoint merg filter endpoint filter merg rang slice command node cmd rang slice command command keyspac command column famili command super column command predic rang command row filter command max result command count row command page collect repli resolv accord consist level rang slice respons resolv resolv rang slice respons resolv node cmd keyspac read callback rang slice repli iter row handler read callback resolv consist level node cmd filter endpoint handler assur suffici live node resolv set sourc filter endpoint filter endpoint size filter endpoint equal util broadcast address logger trace read data local stage manag stage stage execut local rang slice runnabl node cmd handler els messag rang slice command messag node cmd creat messag inet address endpoint filter endpoint messag servic instanc send messag endpoint handler logger trace read node cmd endpoint tri row row handler row add row node cmd count row cql row count row live count command predic logger trace rang slice read row key util wait futur resolv repair result databas descriptor write rpc timeout catch timeout logger debug rang slice timeout string actual respons point int block consist level block tabl throw read timeout consist level block block true catch digest mismatch throw assert error digest rang slice great otherwis move rang int count node cmd count row cql row count row size count node cmd max result break page alreadi row reset column filter predic start iter row column row empti command page onli page slice filter doesn sens otherwis assert command predic instanceof slice queri filter command predic slice queri filter command predic updat slice column slice final rang metric add nano system nano time start time return trim command row privat static list row trim rang slice command command list row row count row caller trim result command count row return row els return row size command max result row list command max result row initi request respons session live node check everybodi migrat determin schema chang propag cluster disagr assum ani node fail respond public static map string list string describ schema version final string version schema instanc version string final map inet address version concurr hash map inet address final set inet address live host gossip instanc live member final count latch latch count latch live host size async callback async callback public void respons messag messag record respons remot node logger trace receiv schema check respons messag host address version put messag messag payload latch count public boolean latenc snitch return fals empti messag act request schema check verb handler messag messag messag messag servic verb inet address endpoint live host messag servic instanc send messag endpoint tri wait long possibl timeout possibl latch await databas descriptor rpc timeout time unit catch interrupt throw assert error latch shouldn interrupt logger trace version version map version host version map string list string result hash map string list string iter inet address host iter concat gossip instanc live member gossip instanc unreach member inet address host host version version host string string version version null version string list string host result string version host null host array list string result put string version host host add host host address result map readi return client rest debug log result null logger debug host agreement didn respons everybodi string util join result map entri string list string entri result entri set check version disagr log host don agre entri key equal entri key equal version continu string host entri valu logger debug disagre host entri key result size logger debug schema agreement return result comput rang queri sort order node replica destin mani rang restrict scan specif rang els duplic result static extend ring posit list abstract bound restrict rang final abstract bound queri rang special case bound exact minimum token queri rang instanceof bound queri rang left equal queri rang queri rang left minimum storag servic partition logger trace restrict singl token match queri queri rang return collect singleton list queri rang token metadata token metadata storag servic instanc token metadata list abstract bound rang array list abstract bound divid queri rang piec delimit ring minimum token iter token ring iter token metadata ring iter token metadata sort token queri rang left token true abstract bound remaind queri rang ring iter remaind rang bound token key split token remaind token split provid token remaind key split token upper bound key instanc remaind foo bar node token split remaind foo bar sinc mix token key time rang upper bound key includ key token includ sinc node split valu abstract choic token upper bound token ring iter upper bound upper bound token upper bound queri rang left class remaind left equal upper bound remaind upper bound split break pair abstract bound abstract bound split remaind split upper bound split null continu rang add split left remaind split rang add remaind logger debug enabl logger trace restrict rang queri queri rang rang return rang public long read oper return read metric latenc count public long total read latenc micro return read metric total latenc count public doubl read latenc micro return read metric latenc public long total read latenc histogram micro return read metric total latenc histogram bucket fals public long read latenc histogram micro return read metric latenc histogram bucket true public long rang oper return rang metric latenc count public long total rang latenc micro return rang metric total latenc count public doubl rang latenc micro return rang metric latenc public long total rang latenc histogram micro return rang metric total latenc histogram bucket fals public long rang latenc histogram micro return rang metric latenc histogram bucket true public long write oper return write metric latenc count public long total write latenc micro return write metric total latenc count public doubl write latenc micro return write metric latenc public long total write latenc histogram micro return write metric total latenc histogram bucket fals public long write latenc histogram micro return write metric latenc histogram bucket true public boolean hint handoff enabl return databas descriptor hint handoff enabl public void set hint handoff enabl boolean databas descriptor set hint handoff enabl public int max hint window return databas descriptor max hint window public void set max hint window int databas descriptor set max hint window public static boolean hint inet address databas descriptor hint handoff enabl return fals boolean hint window expir gossip instanc endpoint downtim databas descriptor max hint window hint window expir logger trace hint gossip instanc endpoint downtim return hint window expir perform truncat operatoin effect delet data column famili cfname param keyspac param cfname throw unavail host ring throw timeout throw public static void truncat block string keyspac string cfname throw unavail timeout logger debug start block truncat oper keyspac keyspac cfname ani host logger info perform truncat host sinc truncat oper aggress typic onli invok admin simplic requir node perform oper int live member gossip instanc live member size throw unavail consist level live member gossip instanc unreach member size live member set inet address endpoint gossip instanc live member int block endpoint size final truncat respons handler respons handler truncat respons handler block send truncat call track respons callback logger trace start send truncat messag host endpoint final truncat truncat truncat keyspac cfname messag truncat messag truncat creat messag inet address endpoint endpoint messag servic instanc send messag endpoint respons handler wait logger trace truncat messag wait respons block respons handler gossip ani node current return true gossip node privat static boolean ani host return gossip instanc unreach member empti public interfac write perform public void appli mutat mutat iter inet address target abstract write respons handler respons handler string local data center consist level consist level throw overload runnabl abort doesn start run befor time privat static abstract class droppabl runnabl implement runnabl privat final long construct time system current time milli privat final messag servic verb verb public droppabl runnabl messag servic verb verb verb verb public final void run system current time milli construct time databas descriptor timeout verb messag servic instanc increment drop messag verb return tri run throw catch throw runtim abstract protect void run throw throw droppabl runnabl abort rerun mutat stage mark hint progress hint backpressur mechan function privat static abstract class local mutat runnabl implement runnabl privat final long construct time system current time milli public final void run system current time milli construct time databas descriptor timeout messag servic verb messag servic instanc increment drop messag messag servic verb hint runnabl runnabl hint runnabl util broadcast address protect void run throw throw local mutat runnabl run throw submit hint runnabl return tri run throw catch throw runtim abstract protect void run throw throw hint runnabl decreas total hint progress target hint finish caller respons increment initi privat abstract static class hint runnabl implement runnabl public final inet address target protect hint runnabl inet address target target target public void run tri run throw catch throw runtim final total hint progress decrement hint progress target decrement abstract protect void run throw throw public long total hint return total hint public int max hint progress return max hint progress public void set max hint progress int max hint progress public int hint progress return total hint progress public void verifi hint progress hint progress logger warn hint written befor shutdown suppos happen run repair file bug report public long rpc timeout return databas descriptor rpc timeout public void set rpc timeout long timeout milli databas descriptor set rpc timeout timeout milli public long read rpc timeout return databas descriptor read rpc timeout public void set read rpc timeout long timeout milli databas descriptor set read rpc timeout timeout milli public long write rpc timeout return databas descriptor write rpc timeout public void set write rpc timeout long timeout milli databas descriptor set write rpc timeout timeout milli public long rang rpc timeout return databas descriptor rang rpc timeout public void set rang rpc timeout long timeout milli databas descriptor set rang rpc timeout timeout milli public long truncat rpc timeout return databas descriptor truncat rpc timeout public void set truncat rpc timeout long timeout milli databas descriptor set truncat rpc timeout timeout milli 