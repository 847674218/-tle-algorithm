licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java file import java import java lang manag manag factori import java nio byte buffer import java util import java util concurr import java util concurr atom atom integ import java util concurr atom atom long import java util regex pattern import javax manag import googl common collect abstract iter import googl common collect immut set import googl common collect iter import googl common collect set import googl common util concurr futur import org apach cassandra filter disk atom filter import org apach cassandra trace trace state import org apach cassandra trace trace import org cliffc high scale lib block hash map import org slf logger import org slf logger factori import org apach cassandra cach row cach entri import org apach cassandra cach row cach key import org apach cassandra cach row cach sentinel import org apach cassandra concurr enabl thread pool executor import org apach cassandra concurr thread factori import org apach cassandra concurr stage manag import org apach cassandra config import org apach cassandra columniter disk atom iter import org apach cassandra commitlog commit log import org apach cassandra commitlog replay posit import org apach cassandra compact abstract compact strategi import org apach cassandra compact compact manag import org apach cassandra compact level compact strategi import org apach cassandra compact oper type import org apach cassandra filter extend filter import org apach cassandra filter queri filter import org apach cassandra filter queri path import org apach cassandra index secondari index import org apach cassandra index secondari index manag import org apach cassandra marshal abstract type import org apach cassandra dht import org apach cassandra configur import org apach cassandra compress compress paramet import org apach cassandra sstabl import org apach cassandra sstabl descriptor import org apach cassandra util file util import org apach cassandra metric column famili metric import org apach cassandra servic cach servic import org apach cassandra servic storag servic import org apach cassandra thrift index express import org apach cassandra trace trace import org apach cassandra util import static org apach cassandra config meta data cach public class column famili store implement column famili store bean privat static final logger logger logger factori logger column famili store class public static final executor servic post flush executor enabl thread pool executor memtabl post flusher static block flush queue fill don put schedul task storag servic option task schedul fix delay meter flusher time unit public final tabl tabl public final string column famili public final meta data metadata public final partition partition privat final string mbean privat volatil boolean valid true memtabl tabl disk column famili privat final data tracker data generat index tabl privat final atom integ file index generat atom integ public final secondari index manag index manag privat static final int public final concurr map byte buffer byte buffer intern block hash map byte buffer byte buffer local held copi chang config dure runtim privat volatil default integ min compact threshold privat volatil default integ max compact threshold privat volatil abstract compact strategi compact strategi public final directori directori ratio memori memtabl size serial size volatil doubl live ratio op count time comput live ratio privat final atom long live ratio comput atom long public final column famili metric metric public void reload metadata object mutat direct member jibe set onli updat runtim modifi set modifi min compact threshold modifi column famili store cfs concat index cfs min compact threshold default integ metadata min compact threshold max compact threshold modifi column famili store cfs concat index cfs max compact threshold default integ metadata max compact threshold mayb reload compact strategi index manag reload compar chang chang memtabl becaus alias previous compar memtabl thread safe initi compar metadata compar switch memtabl true true privat void mayb reload compact strategi check reload metadata compact strategi class equal compact strategi class metadata compact strategi option equal compact strategi option return avoid lock compact manag instanc compact lock lock tri compact strategi shutdown compact strategi metadata creat compact strategi instanc final compact manag instanc compact lock unlock public void set compact strategi class string compact strategi class tri metadata compact strategi class meta data creat compact strategi compact strategi class mayb reload compact strategi catch configur throw illeg argument messag public string compact strategi class return metadata compact strategi class public map string string compress paramet return metadata compress paramet thrift option public void set compress paramet map string string opt tri metadata compress paramet compress paramet creat opt catch configur throw illeg argument messag public void set crc check chanc doubl crc check chanc tri tabl reader sstabl tabl tabl sstabl compress sstabl compress metadata paramet set crc check chanc crc check chanc catch configur throw illeg argument messag privat column famili store tabl tabl string column famili partition partition int generat meta data metadata directori directori boolean load tabl assert metadata null null metadata tabl column famili tabl tabl column famili column famili metadata metadata min compact threshold default integ metadata min compact threshold max compact threshold default integ metadata max compact threshold partition partition directori directori index manag secondari index manag metric column famili metric file index generat set generat cach cach metadata cach logger debug enabl logger debug start column famili scan sstabl correspond load data data tracker load tabl directori tabl lister sstabl file directori sstabl lister skip temporari true collect tabl reader sstabl tabl reader batch open sstabl file list entri set metadata partition metadata default valid commut filter compact sstabl remov compact set integ compact tabl hash set integ tabl reader sstabl sstabl compact tabl add sstabl ancestor set tabl reader live tabl hash set tabl reader tabl reader sstabl sstabl compact tabl sstabl descriptor generat logger info alreadi compact remov sstabl sstabl mark compact mark compact delet sstabl releas refer amount delet sstabl els live tabl add sstabl data add initi tabl live tabl els data add initi tabl sstabl cach cach cach cach cach servic instanc key cach load save compact strategi creat prepar compact strategi metadata creat compact strategi instanc creat privat column famili store secondari column index column definit info metadata column metadata valu info index type null index manag add index column info regist mbean string type partition instanceof local partition index column famili column famili mbean org apach cassandra type type keyspac tabl columnfamili column famili tri bean server mbs manag factori platform bean server object obj object mbean mbs regist bean obj catch throw runtim call drop renam perform mbean housekeep invalid oper public void invalid tri valid fals unregist bean data unrefer tabl index manag invalid catch shouldn block anyth logger warn fail unregist mbean mbean remov everi tabl directori data tracker view param directori unread directori possibl tabl necessarili void mayb remov unread tabl file directori data remov unread tabl directori void unregist bean throw malform object instanc bean registr bean server mbs manag factori platform bean server object obj object mbean mbs regist obj mbs unregist bean obj unregist metric metric releas public long min row size return metric min row size valu public long max row size return metric max row size valu public long row size return metric row size valu public int column return data column public static column famili store creat column famili store tabl tabl string column famili boolean load tabl return creat column famili store tabl column famili storag servic partition schema instanc meta data tabl column famili load tabl public static column famili store creat column famili store tabl tabl string column famili partition partition meta data metadata return creat column famili store tabl column famili partition metadata true privat static synchron column famili store creat column famili store tabl tabl string column famili partition partition meta data metadata boolean load tabl max generat number prevent generat conflict directori directori directori creat tabl column famili directori tabl lister lister directori sstabl lister includ backup true list integ generat array list integ map entri descriptor set compon entri lister list entri set descriptor desc entri key generat add desc generat desc compat throw runtim string format open incompat tabl current version file descriptor version desc collect sort generat int valu generat size generat generat size return column famili store tabl column famili partition valu metadata directori load tabl remov unnecessari file directori startup includ temp file orphan length file compact sstabl file recogn ignor public static void scrub data directori string tabl string column famili logger debug remov compact tabl file http wiki apach org cassandra memtabl tabl column famili directori directori directori creat tabl column famili map entri descriptor set compon sstabl file directori sstabl lister list entri set descriptor desc sstabl file key set compon compon sstabl file valu compon compon desc temporari tabl delet desc compon continu file data file file desc filenam compon compon compon data file length everyth order move continu file compon orphan logger warn remov orphan desc compon compon compon compon file util delet confirm desc filenam compon cleanup incomplet save cach pattern tmp cach file pattern pattern compil tabl column famili key| row cach tmp file dir file databas descriptor save cach locat dir exist assert dir directori file file dir list file tmp cach file pattern matcher file match file delet logger warn delet file absolut path clean ani index leftov meta data cfm schema instanc meta data tabl column famili cfm null secondari index aren store column definit def cfm column metadata valu scrub data directori tabl cfm index column famili def call sstabl load sinc row cach merg row version public void init row cach row cach enabl return long start system current time milli int cach row read cach servic instanc row cach load save cach row read logger info string format complet load key row cach system current time milli start cach row read tabl column famili code storag servic load tabl string string info param keyspac param column famili public static synchron void load tabl string string exist check open method tabl tabl tabl open tabl column famili store load tabl inherit doc public synchron void load tabl logger info load tabl tabl column famili set descriptor current descriptor hash set descriptor tabl reader sstabl data view sstabl current descriptor add sstabl descriptor set tabl reader tabl hash set tabl reader directori tabl lister lister directori sstabl lister skip temporari true map entri descriptor set compon entri lister list entri set descriptor descriptor entri key current descriptor descriptor continu initi tabl skip descriptor temporari process written continu descriptor compat throw runtim string format open incompat tabl current version file descriptor version descriptor descriptor descriptor descriptor descriptor version descriptor directori descriptor ksname descriptor cfname file index generat increment fals logger info renam tabl descriptor descriptor tabl writer renam descriptor descriptor entri valu tabl reader reader tri reader tabl reader open descriptor entri valu metadata partition catch tabl reader log open entri key continu tabl add reader tabl empti logger info tabl tabl column famili return logger info load tabl build secondari index tabl column famili tabl tabl reader acquir refer tabl data add tabl tabl tri index manag mayb build secondari index tabl index manag index final tabl reader releas refer tabl logger info load load tabl tabl column famili public static void rebuild secondari index string string string idx column famili store cfs tabl open column famili store set string index hash set string array list idx collect tabl reader sstabl cfs tabl tri cfs index manag set index remov index tabl reader acquir refer sstabl logger info string format user request secondari index build index cfs index manag mayb build secondari index sstabl index cfs index manag set index built index final tabl reader releas refer sstabl return column famili public string column famili return column famili public string temp tabl path file directori return temp tabl path directori descriptor version privat string temp tabl path file directori descriptor version version descriptor desc descriptor version directori tabl column famili file index generat increment true return desc filenam compon switch flush current memtabl dirti forc switch flag forc switch memtabl clean case don flush point public futur switch memtabl final boolean write commit log boolean forc switch writelock updat ongo updat memtabl complet tail log start posit log replay recoveri whi tabl switch lock global tabl schedul discard complet segment call order context commitlog posit read flush executor multithread tabl switch lock write lock lock tri final futur replay posit ctx write commit log commit log instanc context futur immedi futur replay posit submit memtabl ani index cfses final list column famili store icc array list column famili store don assum memtabl dirti forc flush bring dure index build column famili store cfs concat index forc switch cfs memtabl thread safe clean icc add cfs final count latch latch count latch icc size column famili store cfs icc memtabl memtabl cfs data switch memtabl forc switch possibl clean memtabl case sinc switch alreadi remov memtabl pend flush memtabl clean cfs replac flush memtabl null latch count els logger info enqueu flush memtabl memtabl flush signal latch ctx metric memtabl switch count count long metric memtabl switch count clear metric memtabl switch count memtabl written includ index mark flush commitlog header executor memtabl flush call order wait flush futur anyth latenc sensit return post flush executor submit wrap runnabl public void run throw throw interrupt execut latch await icc empti onli valid memtabl exist secondari index index index manag index cfs flush ani cfs index logger info flush secondari index index index forc block flush write commit log write commit log replay log mark log header discard anyth written befor context valid commit log instanc discard complet segment metadata ctx final tabl switch lock write lock unlock public futur forc flush dure index build ari index memtabl dirti parent flush largest memtabl flush ari index boolean clean true column famili store cfs concat index clean cfs memtabl thread safe clean clean logger debug forc flush request everyth clean column famili return futur immedi check futur null return switch memtabl true fals public void forc block flush throw execut interrupt forc flush public void mayb updat row cach decor key key column famili column famili row cach enabl return row cach key cach key row cach key metadata key alway invalid copi cach valu cach servic instanc row cach put copi invalid cach row cach key return invalid normal cach valu sentinel read retri includ updat row cach entri cach row cach servic instanc row cach intern cach key cach row null cach row instanceof row cach sentinel invalid cach row cach key els column famili written commit log becaus period commit log concurr column famili shouldn modifi super column super column clone ad cach add copi doe column famili cach row add copi column famili heap alloc instanc insert updat column famili key caller respons acquir tabl flusher lock param lock lock param key key updat insert param column famili column famili chang public void appli decor key key column famili column famili secondari index manag updat index long start system nano time memtabl memtabl thread safe put key column famili index mayb updat row cach key column famili metric write latenc add nano system nano time start recomput live ratio doubl number op sinc calcul true long live ratio comput long oper metric write latenc latenc count oper break live ratio comput compar set oper logger debug comput live ratio op oper updat live ratio public static column famili remov delet column famili int befor mayb reset delet time befor return column count mark delet null public static column famili remov delet column famili int befor return remov delet befor secondari index manag null updat complic becaus preserv delet column supercolumn columnfamili delet preserv content object tombston repair replica delet public static column famili remov delet column famili int befor secondari index manag updat index null return null remov delet column onli befor index return remov delet befor privat static void remov delet column onli column famili int befor secondari index manag updat index super remov delet super befor els remov delet standard befor index public static void remov delet column onli column famili int befor remov delet column onli befor secondari index manag null updat privat static void remov delet standard column famili int befor secondari index manag updat index iter column iter iter iter column iter remov column column gcabl column shadow tombston local delet time befor delet info delet iter remov index remov privat static void remov delet super column famili int befor assum delet delet add clone remov origin improv compact possibl remov delet tombston onc befor pass stuff ad doesn wrong algorithm forev iter column iter iter iter super column super column iter iter column iter column iter iter column column iter remov subcolumn subcolumn gcabl supercolumn shadow column newer subcolumn shadow supercolumn column local delet time befor delet info delet column timestamp delet info delet column iter remov mayb reset delet time befor column empti mark delet iter remov param sstabl return sstabl key rang overlap sstabl includ sstabl overlap public set tabl reader overlap tabl collect tabl reader sstabl logger debug check sstabl overlap sstabl normal compact won empti sstabl list creat skeleton compact control stream pass empti list sstabl empti return immut set data tracker tabl interv tree tree data view interv tree set tabl reader result null tabl reader sstabl sstabl set tabl reader overlap immut set copi tree search interv row posit tabl reader creat sstabl sstabl assert overlap sstabl result result null overlap set union result overlap immut copi result set differ result immut set copi sstabl return result overlap tabl acquir refer befor return public set tabl reader refer overlap tabl collect tabl reader sstabl true set tabl reader overlap overlap tabl sstabl tabl reader acquir refer overlap return overlap call binari memtabl flush memori data add file bootstrap inform cach column famili store read becaus column famili store memori store disk find key invok dure recoveri mode memtabl flush invok param filenam filenam flush disk public void add tabl tabl reader sstabl assert sstabl column famili equal column famili add tabl array list sstabl public void add tabl collect tabl reader sstabl data add tabl sstabl compact manag instanc submit background calcul expect file size tabl compact oper type code deal index sstabl calcul expect file size check token rang elimin otherwis add file size worst case file size compact list file param sstabl tabl calcul expect compact file size param oper oper type return expect file size tabl compact public long expect compact file size iter tabl reader sstabl oper type oper oper oper type index return tabl total byte sstabl cleanup size estim onli count byte key local node long expect file size collect rang token rang storag servic instanc local rang tabl tabl reader sstabl sstabl list pair long long posit sstabl posit rang rang pair long long posit posit expect file size posit posit left return expect file size find maximum size file list public tabl reader max size file iter tabl reader sstabl long max size tabl reader max file null tabl reader sstabl sstabl sstabl disk length max size max size sstabl disk length max file sstabl return max file public void forc cleanup counter shot renew renew throw execut interrupt compact manag instanc perform cleanup column famili store renew public void scrub throw execut interrupt snapshot flush pre scrub system current time milli compact manag instanc perform scrub column famili store public void sstabl rewrit throw execut interrupt compact manag instanc perform tabl rewrit column famili store public void mark compact collect tabl reader sstabl oper type compact type assert sstabl empti data mark compact sstabl compact type public void replac compact tabl collect tabl reader sstabl iter tabl reader replac oper type compact type data replac compact tabl sstabl replac compact type void replac flush memtabl memtabl tabl reader sstabl data replac flush memtabl sstabl sstabl null compact manag instanc submit background public boolean valid return valid public long memtabl column count return metric memtabl column count valu public long memtabl data size return metric memtabl data size valu public long total memtabl live size return memtabl data size index manag total live size public int memtabl switch count return int metric memtabl switch count count privat memtabl memtabl thread safe return data memtabl packag protect access compact manag public data tracker data tracker return data public collect tabl reader tabl return data tabl public set tabl reader uncompact tabl return data uncompact tabl public long tabl read histogram return metric tabl read bucket true public long tabl read histogram return metric sstabl read bucket fals public long read count return metric read latenc latenc count public doubl read latenc micro return metric read latenc latenc public long lifetim read latenc histogram micro return metric read latenc total latenc histogram bucket fals public long read latenc histogram micro return metric read latenc latenc histogram bucket true public long total read latenc micro return metric read latenc total latenc count public int pend task return metric pend task valu public long write count return metric write latenc latenc count public long total write latenc micro return metric write latenc total latenc count public doubl write latenc micro return metric write latenc latenc public long lifetim write latenc histogram micro return metric write latenc total latenc histogram bucket fals public long write latenc histogram micro return metric write latenc latenc histogram bucket true public column famili column famili decor key key queri path path byte buffer start byte buffer finish boolean revers int limit return column famili queri filter slice filter key path start finish revers limit list column start column specifi order onli latest version column return return null data tombston otherwis column famili public column famili column famili queri filter filter return column famili filter befor public int befor return int system current time milli metadata grace fetch row filter key cach read disk cach param column famili read row param filter column queri note cach entir row row uncach race cach onli winner read entir row return entir row filter key present cach cach column specifi filter otherwis privat column famili cach queri filter filter assert row cach enabl string format row cach enabl column famili column famili row cach key key row cach key filter key attempt sentinel read cach sequenc write invalid sentinel return potenti obsolet data won cach row cach entri cach cach servic instanc row cach key cach null cach instanceof row cach sentinel read tri cach valu normal cach read trace trace row cach race return top level column filter integ fals trace trace row cach hit return column famili cach trace trace row cach row cach sentinel sentinel row cach sentinel boolean sentinel success cach servic instanc row cach put absent key sentinel tri column famili data top level column queri filter ident filter filter key queri path column famili integ true sentinel success data null cach servic instanc row cach replac key sentinel data return data final sentinel success data null cach servic instanc row cach remov key column famili column famili queri filter filter int befor assert column famili equal filter column famili filter column famili column famili result null long start system nano time tri row cach enabl schema instanc tabl column famili null logger trace tabl column famili return null column famili cach cach filter cach null logger trace cach row empti return null result filter column famili cach filter befor els column famili top level column filter befor fals null return null necessari becaus collat supercolumn togeth don check subcolumn relev prune post facto result super remov delet befor remov delet befor final metric read latenc add nano system nano time start return result filter cach row modifi filter modifi throw tombston longer relev return column famili won thread safe column famili filter column famili column famili cach queri filter filter int befor column famili cach clone shallow array sort column factori filter filter revers disk atom iter filter memtabl column iter cach null filter collat disk atom collect singleton list befor necessari becaus collat supercolumn togeth don check subcolumn relev prune post facto return super remov delet befor remov delet befor current view acquir refer sstabl bit tricki becaus ensur time current view time acquir refer set sstabl hasn chang otherwis view sstabl delet meantim method refer sstabl return view acquir releas appropri privat data tracker view mark current view referenc true data tracker view current view data view tabl reader acquir refer current view sstabl return current view current sstabl acquir refer caller charg releas refer sstabl mark current view referenc abov public collect tabl reader mark current tabl referenc return mark current view referenc sstabl return view fragment sstabl memtabl merg param key accord interv tree public view fragment mark referenc decor key key assert key minimum data tracker view view list tabl reader sstabl true view data view sstabl view interv tree search key tabl reader acquir refer sstabl break retri view return view fragment sstabl iter concat collect singleton view memtabl view memtabl pend flush return view fragment sstabl memtabl merg row param start param stop inclus accord interv tree public view fragment mark referenc row posit start row posit stop data tracker view view list tabl reader sstabl true view data view start minimum stop minimum confus becaus interv tree deal compar won special case howev max call interv tree empti socheck view interv tree empti sstabl collect empti list break row posit stop tree stop minimum view interv tree max stop sstabl view interv tree search interv row posit tabl reader creat start stop tree tabl reader acquir refer sstabl break retri view return view fragment sstabl iter concat collect singleton view memtabl view memtabl pend flush public list string tabl key string key decor key decor key partition token byte buffer wrap key byte byte buffer wrap key byte view fragment view mark referenc tri list string file array list string tabl reader sstr view sstabl check key actual exist sstabl updat cach stat sstr posit tabl reader oper fals null file add sstr filenam return file final tabl reader releas refer view sstabl public column famili top level column queri filter filter int befor boolean cach trace trace execut singl partit queri column famili collat control control collat control cach cach servic instanc row cach put copi filter befor column famili column control top level column metric updat tabl iter control sstabl iter return column public static abstract class abstract scan iter extend abstract iter row implement closeabl iter row public boolean filter return true iter rang row column memtabl sstabl param super column option super column slice subcolumn null slice top level column param rang bound includ start key rang doe param column filter descript column interest row public abstract scan iter sequenti iter byte buffer super column final abstract bound row posit rang disk atom filter column filter assert rang instanceof rang rang rang wrap rang minimum rang final row posit start rang left final row posit stop rang queri filter filter queri filter null queri path column famili super column null column filter final view fragment view mark referenc start stop trace trace execut seq scan sstabl view sstabl size rang string metadata key valid tri final closeabl iter row iter row iter factori iter view memtabl view sstabl start stop filter final int befor int system current time milli metadata grace return abstract scan iter protect row comput pull row iter iter return data row current iter decor key key current key stop minimum stop compar key return data skip outsid assign rang rang key return comput logger trace scan key necessari becaus collat supercolumn togeth don check subcolumn relev prune post facto return current null current super row current key remov delet current befor current public void close throw tabl reader releas refer view sstabl iter close catch runtim case iter throw otherwis iteror close method releas refer tabl reader releas refer view sstabl throw public list row rang slice byte buffer super column final abstract bound row posit rang int max result disk atom filter column filter list index express row filter return rang slice super column rang max result column filter row filter fals fals public list row rang slice byte buffer super column final abstract bound row posit rang int max result disk atom filter column filter list index express row filter boolean count row boolean page return filter sequenti iter super column rang column filter extend filter creat column filter row filter max result count row page public list row search list index express claus abstract bound row posit rang int max result disk atom filter data filter return search claus rang max result data filter fals public list row search list index express claus abstract bound row posit rang int max result disk atom filter data filter boolean count row trace trace execut index scan rang string metadata key valid return index manag search claus rang max result data filter count row public list row filter abstract scan iter row iter extend filter filter logger trace filter row match row iter filter list row row array list row int column count int total match tri row iter row size filter max row column count filter max column raw column request addit column express necessari row raw row row iter total column famili data raw row row iter filter disk atom filter extra filter filter extra filter data extra filter null queri path path queri path column famili column famili filter cfs column famili queri filter raw row key path extra filter null data add heap alloc instanc filter satisfi data null continu logger trace satisfi filter express data cut resultset request necessari data filter prune data row add row raw row key data match data null column count filter count data updat filter avoid queri column slice necessari handl page filter updat filter column count return row final tri row iter close trace trace scan row match total match catch throw runtim public abstract type compar return metadata compar public void snapshot flush string snapshot column famili store cfs concat index data tracker view current view cfs mark current view referenc tri tabl reader tabl current view sstabl file snapshot directori directori snapshot directori tabl descriptor snapshot tabl creat link snapshot directori path hard link logger debug enabl logger debug snapshot tabl keyspac data file tabl filenam creat snapshot directori cfs compact strategi instanceof level compact strategi cfs directori snapshot level manifest snapshot final tabl reader releas refer current view sstabl public list tabl reader snapshot tabl reader string tag throw map descriptor set compon snapshot directori sstabl lister snapshot tag list list tabl reader reader array list tabl reader snapshot size map entri descriptor set compon entri snapshot entri set reader add tabl reader open entri key entri valu metadata partition return reader snap shot columnfamili store param snapshot associ snapshot public void snapshot string snapshot tri forc block flush catch execut throw runtim catch interrupt throw assert error snapshot flush snapshot public boolean snapshot exist string snapshot return directori snapshot exist snapshot public long snapshot creation time string snapshot return directori snapshot creation time snapshot public void clear snapshot string snapshot directori clear snapshot snapshot public boolean unreclaim space return live disk space total disk space public long total disk space return metric total disk space count public long live disk space return metric live disk space count public int live tabl count return metric live tabl count valu return cach row param key alreadi present cach unlik cach read cach row present call count cach statist note caus deseri serial cach row row present cach row public column famili raw cach row decor key key row cach enabl metadata null return null secondari index row cach entri cach cach servic instanc row cach intern row cach key metadata key return cach null cach instanceof row cach sentinel null column famili cach return true param key row cach public boolean cach row decor key key return cach servic instanc row cach capac cach servic instanc row cach key row cach key metadata key public void invalid cach row row cach key key cach servic instanc row cach remov key public void invalid cach row decor key key schema instanc tabl column famili null return secondari index invalid cach row row cach key key public void forc major compact throw interrupt execut compact manag instanc perform maxim public static iter column famili store list iter column famili store store array list iter column famili store schema instanc tabl size tabl tabl tabl store add tabl column famili store return iter concat store public static list column famili store user defin list column famili store cfses array list column famili store tabl tabl set differ immut set copi tabl schema system keyspac cfses add tabl column famili store return cfses public iter decor key key sampl rang token rang collect tabl reader sstabl tabl iter decor key sampl iter sstabl size int tabl reader sstabl sstabl sampl sstabl key sampl rang return iter concat sampl test effort clear histor current memtabl thread safeti wipe sstabl clean leav actual data file present disk test easili call load tabl public void clear unsaf column famili store cfs concat index cfs data init truncat delet entir column famili data expens tombston creation return futur delet oper call futur column famili delet public futur truncat throw execut interrupt goal truncat delet everyth written befor truncat invok delet anyth isn part snapshot creat accomplish flush manual snapshot record timestamp action ani sstabl creat timestamp greater time mark delet bonus complic sinc store replay posit sstabl metadata truncat sstabl replay ani segment restart befor discard normal reason post truncat creat dummi sstabl onli replay posit compact manag submit truncat logger debug truncat column famili databas descriptor auto snapshot flush truncat befor forc segment forc block flush sleep littl truncat ani sstabl part flush forc otherwis tie won delet tri long starttim system current time milli system current time milli starttim thread sleep catch interrupt throw assert error els nuke memtabl data write disk tabl switch lock write lock lock tri column famili store cfs concat index memtabl cfs memtabl thread safe clean cfs data renew memtabl final tabl switch lock write lock unlock long truncat system current time milli databas descriptor auto snapshot snapshot tabl timestamp snapshot column famili return compact manag instanc submit truncat truncat public long bloom filter fals posit return metric bloom filter fals posit valu public long bloom filter fals posit return metric bloom filter fals posit valu public doubl bloom filter fals ratio return metric bloom filter fals ratio valu public doubl bloom filter fals ratio return metric bloom filter fals ratio valu public long bloom filter disk space return metric bloom filter disk space valu overrid public string string return keyspac tabl column famili column famili public void disabl auto compact min compact threshold set max compact threshold set public void enabl auto compact min compact threshold reset max compact threshold reset getter setter default set min compact threshold set max compact threshold memsiz memop set memtim public abstract compact strategi compact strategi return compact strategi public void set compact threshold int min threshold int max threshold valid compact threshold min threshold max threshold min compact threshold set min threshold max compact threshold set max threshold call part compact strategi constructor avoid circular depend check null compact strategi null compact manag instanc submit background public int minimum compact threshold return min compact threshold valu public void set minimum compact threshold int min compact threshold valid compact threshold min compact threshold max compact threshold valu min compact threshold set min compact threshold public int maximum compact threshold return max compact threshold valu public void set maximum compact threshold int max compact threshold valid compact threshold min compact threshold valu max compact threshold max compact threshold set max compact threshold privat void valid compact threshold int min threshold int max threshold min threshold max threshold max threshold throw runtim string format min compact threshold larger max compact threshold min max min threshold max threshold public boolean compact disabl return minimum compact threshold maximum compact threshold set public long estim key return data estim key public long estim row size histogram return metric estim row size histogram valu public long estim column count histogram return metric estim column count histogram valu public doubl compress ratio return metric compress ratio valu true secondari index data public boolean index return partition instanceof local partition privat byte buffer intern byte buffer byte buffer intern intern intern null intern byte buffer util clone byte buffer concurr intern put absent intern intern concurr null intern concurr return intern public byte buffer intern copi byte buffer alloc alloc intern size return alloc clone return intern public byte buffer mayb intern byte buffer intern size return null return intern public tabl writer creat compact writer long estim row file locat collect tabl reader sstabl replay posit replay posit replay posit sstabl tabl metadata collector sstabl metadata collector tabl metadata creat collector replay posit max timestamp precompact sstabl add generat live ancestor tabl reader sstabl sstabl sstabl metadata collector updat min timestamp sstabl min timestamp sstabl metadata collector updat max timestamp sstabl max timestamp sstabl metadata collector add ancestor sstabl descriptor generat integ sstabl ancestor file sstabl descriptor generat filenam compon exist sstabl metadata collector add ancestor return tabl writer temp tabl path locat estim row metadata partition sstabl metadata collector public iter column famili store concat index return iter concat index manag index cfs collect singleton public set memtabl memtabl pend flush return data memtabl pend flush public list string built index return index manag built index public int unlevel tabl return compact strategi instanceof level compact strategi level compact strategi compact strategi level size public int tabl count level return compact strategi instanceof level compact strategi level compact strategi compact strategi level size null public static class view fragment public final list tabl reader sstabl public final iter memtabl memtabl public view fragment list tabl reader sstabl iter memtabl memtabl sstabl sstabl memtabl memtabl return creation time oldest memtabl fulli flush public long oldest unflush memtabl data tracker view view data view long oldest view memtabl creation time memtabl memtabl view memtabl pend flush oldest math min oldest memtabl creation time return oldest public boolean empti data tracker view view data view return view sstabl empti view memtabl oper view memtabl pend flush empti privat boolean row cach enabl return metadata cach cach metadata cach cach cach servic instanc row cach capac discard tabl creat befor timestamp caller respons obtain compact lock param truncat timestamp truncat tabl befor timestamp mark compact return replay posit truncat data public replay posit discard tabl long truncat list tabl reader truncat tabl array list tabl reader tabl reader sstabl tabl sstabl sinc truncat truncat tabl add sstabl truncat tabl empti return replay posit mark compact truncat tabl oper type return replay posit replay posit truncat tabl public doubl droppabl tombston ratio return data tracker droppabl tombston ratio 