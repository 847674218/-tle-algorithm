licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java data input stream import java import java lang manag manag factori import java net inet address import java net unknown host import java nio byte buffer import java util import java util concurr import java util concurr atom atom integ import javax manag bean server import javax manag object import googl common annot visibl test import googl common collect immut sort set import googl common util concurr rate limit import org slf logger import org slf logger factori import org apach cassandra concurr enabl thread pool executor import org apach cassandra concurr thread factori import org apach cassandra config databas descriptor import org apach cassandra compact compact manag import org apach cassandra filter import org apach cassandra marshal abstract type import org apach cassandra marshal composit type import org apach cassandra marshal int type import org apach cassandra marshal type import org apach cassandra dht partition import org apach cassandra dht rang import org apach cassandra dht token import org apach cassandra gms applic state import org apach cassandra gms failur detector import org apach cassandra gms gossip import org apach cassandra sstabl descriptor import org apach cassandra sstabl tabl import org apach cassandra net async callback import org apach cassandra net messag import org apach cassandra net messag servic import org apach cassandra servic import org apach cassandra thrift import org apach cassandra util byte buffer util import org apach cassandra util util import org apach cassandra util gen import org apach cassandra util wrap runnabl import org cliffc high scale lib block hash set hint schema hint target uuid hint timeuuid messag version int mutat blob target hint messag version node cluster treat uuid partit key hint logic row physic composit column mutat replay associ metadata failur detector signal node page hint mutat send time wait hint handoff throttl delay deliv hint expos run manual cue public class hint hand manag implement hint hand manag bean public static final string org apach cassandra type hint handoff manag public static final hint hand manag instanc hint hand manag privat static final logger logger logger factori logger hint hand manag class privat static final int privat static final int node anybodi privat volatil boolean hint hand paus fals static final composit type compar composit type instanc array abstract type list type instanc int type instanc privat final block hash set inet address queu deliveri block hash set inet address privat final thread pool executor executor enabl thread pool executor databas descriptor max hint thread integ time unit link block queue runnabl thread factori hint handoff thread intern public void start bean server mbs manag factori platform bean server tri mbs regist bean object catch throw runtim logger debug creat instanc regist bean runnabl runnabl runnabl public void run schedul deliveri storag servic option task schedul fix delay runnabl time unit privat static void delet hint byte buffer token byte byte buffer column long timestamp throw row mutat row mutat tabl token byte delet queri path system tabl null column timestamp appli unsaf don bother commitlog sinc flush deliveri public void delet hint endpoint final string hostnam tri inet address endpoint inet address hostnam delet hint endpoint endpoint catch unknown host logger warn unabl find hostnam hostnam ipaddr node print stack trace throw runtim public void delet hint endpoint final inet address endpoint storag servic instanc token metadata member endpoint return host storag servic instanc token metadata host endpoint byte buffer host byte byte buffer wrap gen decompos host final row mutat row mutat tabl host byte delet queri path system tabl system current time milli execut asynchron avoid block caller process gossip runnabl runnabl runnabl public void run tri logger info delet ani store hint endpoint appli compact catch logger warn delet hint endpoint storag servic option task execut runnabl visibl test protect futur compact throw execut interrupt final column famili store hint store tabl open tabl column famili store system tabl hint store forc block flush array list descriptor descriptor array list descriptor tabl sstabl hint store tabl descriptor add sstabl descriptor return compact manag instanc submit user defin hint store descriptor int system current time milli privat static boolean page finish column famili hint column famili byte buffer start column hint start column column process previous iter onli return hint column famili null hint column famili sort column size hint column famili column start column null privat int wait schema agreement inet address endpoint throw timeout gossip gossip gossip instanc int wait wait schema gossip gossip endpoint state endpoint endpoint applic state applic state null tri thread sleep catch interrupt throw assert error wait wait storag servic throw timeout didin receiv gossip schema endpoint storag servic wait wait correct schema version usual def version check local schema uuid store system tabl check gossip serv canari warn introduc bug caus diverg gossip endpoint state endpoint endpoint applic state applic state valu equal gossip endpoint state endpoint util broadcast address applic state applic state valu tri thread sleep catch interrupt throw assert error wait wait storag servic throw timeout reach schema agreement endpoint storag servic logger debug schema match local schema endpoint return wait privat void deliv hint endpoint inet address endpoint throw digest mismatch invalid request interrupt tri deliv hint endpoint intern endpoint final queu deliveri remov endpoint privat void deliv hint endpoint intern inet address endpoint throw digest mismatch invalid request interrupt column famili store hint store tabl open tabl column famili store system tabl hint store empti return noth don confus user log handoff check hint deliveri paus hint hand paus logger debug hint deliveri process paus abort return logger debug check remot schema befor deliv hint endpoint tri wait schema agreement endpoint catch timeout return failur detector instanc aliv endpoint logger debug endpoint die befor hint deliveri abort endpoint return key endpoint handoff column deseri mutat send endpoint delet subcolumn write success forc flush major compact clean delet find hint node token host gossip instanc host endpoint logger info start hint handoff host host endpoint final byte buffer host byte byte buffer wrap gen decompos host decor key epkey storag servic partition decor key host byte final atom integ row replay atom integ byte buffer start column byte buffer util int page size read column mutat page veri larg hint store column int averag column size int hint store row size hint store column page size math min databas descriptor memori compact limit averag column size page size math max page size page size doe actual page behavior start column logger debug averag hint row column size page size averag column size page size rate limit byte doubl disabl set cassandra yaml int throttl databas descriptor hint handoff throttl rate limit rate limit rate limit creat throttl doubl throttl true check hint deliveri paus dure process hint hand paus logger debug hint deliveri process paus abort break queri filter filter queri filter slice filter epkey queri path system tabl start column byte buffer util fals page size column famili hint page column famili store remov delet hint store column famili filter int system current time milli page finish hint page start column byte buffer util equal start column start find anyth onli mayb tombston break els restart queri column read empti row everyth deliv success timeout start column byte buffer util continu final column hint hint page sort column skip tombston iter quick possibl request page millisecond local delet timestamp generat column page case hint column sinc delet includ resultset sinc gcgs relev tombston hint live continu hint hand paus logger debug hint deliveri process paus abort break start column hint byte buffer compon compar split hint int version int type instanc compos compon data input stream data input stream byte buffer util input stream hint valu row mutat tri row mutat serial deseri version catch unknown column famili logger debug skip deliveri hint delet columnfamili delet hint host byte hint hint max timestamp continu messag row mutat messag creat messag rate limit acquir messag serial size messag servic current version wrap runnabl callback wrap runnabl public void run throw throw row replay increment delet hint host byte hint hint max timestamp async callback respons handler write respons handler endpoint write type callback messag servic instanc send messag endpoint respons handler check node aliv continu deliveri process failur detector instanc aliv endpoint logger debug endpoint die dure hint deliveri abort endpoint return row replay tri compact catch throw runtim logger info string format finish hint handoff row endpoint row replay endpoint hint hand paus logger info hint deliveri process paus deliv hint attempt deliveri ani node hint necessari sinc generat hint node offici fail privat void schedul deliveri logger debug enabl logger debug start schedul deliveri column famili store hint store tabl open tabl column famili store system tabl partition storag servic partition row posit min pos minimum token min key bound rang row posit rang rang row posit min pos min pos disk atom filter filter queri filter immut sort set byte buffer list row row hint store rang slice null rang integ filter null row row row host gen row key key inet address target storag servic instanc token metadata endpoint host host token sinc remov case read tombston target null schedul hint deliveri target logger debug enabl logger debug finish schedul deliveri method deliv hint endpoint learn endpoint deliv data event driven mechan public void schedul hint deliveri final inet address deliv hint host differ thread queu deliveri queu deliveri add return logger debug schedul deliveri hint runnabl wrap runnabl public void run throw throw deliv hint endpoint executor execut public void schedul hint deliveri string throw unknown host schedul hint deliveri inet address public void paus hint deliveri boolean hint hand paus public list string list endpoint pend hint token token factori token factori storag servic partition token factori extract key string report link list string result link list string row row hint slice row null ignor remov row result add token factori string row key token return result public map string integ count pend hint token token factori token factori storag servic partition token factori map string integ result hash map string integ row row hint slice integ row null ignor remov row continu int count row column count count result put token factori string row key token count return result privat list row hint slice int column count column parent hint column parent parent column parent system tabl count column slice queri filter predic slice queri filter byte buffer util byte buffer util fals column count key partition partition storag servic partition row posit min pos partition minimum token min key bound rang row posit rang rang row posit min pos min pos bunch row list row row tri row storag proxi rang slice rang slice command tabl parent predic rang null consist level catch logger info hint pend hint time throw runtim return row 