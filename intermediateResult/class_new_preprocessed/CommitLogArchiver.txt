licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra commitlog import java file import java import java input stream import java text pars import java text simpl date format import java util map import java util properti import java util concurr import org apach cassandra concurr enabl thread pool executor import org apach cassandra config databas descriptor import org apach cassandra util file util import org apach cassandra util util import org apach cassandra util wrap runnabl import org slf logger import org slf logger factori import googl common base string public class commit log archiv privat static final logger logger logger factori logger commit log archiv class public final map string futur archiv pend concurr hash map string futur public final executor servic executor enabl thread pool executor commitlog archiv privat final string archiv command privat final string restor command privat final string restor directori public final long restor point time public commit log archiv properti commitlog command properti input stream stream null tri stream class class loader resourc stream commitlog archiv properti stream null logger debug commitlog archiv properti archiv pitr disabl archiv command null restor command null restor directori null restor point time long els commitlog command load stream archiv command commitlog command properti archiv command restor command commitlog command properti restor command restor directori commitlog command properti restor directori string target time commitlog command properti restor point time tri restor point time string null empti target time long simpl date format yyyi pars target time time catch pars throw runtim unabl pars restor target time catch throw runtim unabl load commitlog archiv properti final file util close quiet stream public void mayb archiv final string path final string string null empti archiv command return archiv pend put executor submit wrap runnabl protect void run throw throw string command archiv command replac command command replac path path exec command public boolean mayb wait archiv string futur archiv pend remov null return true archiv disabl tri catch interrupt throw assert error catch execut caus instanceof logger info archiv file fail earlier cassandra ignor segment return fals throw runtim return true public void mayb restor archiv string null empti restor directori return string dir restor directori split file file file dir list file file null throw runtim unabl list director dir file file file file file file databas descriptor commit log locat commit log descriptor commit log segment file string command restor command replac file path command command replac file path tri exec command catch throw runtim privat void exec string command throw process builder process builder command split redirect error stream true util exec 