licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra sstabl import java import java nio charset charset import java util import java util concurr copi write array set import googl common base predic import googl common collect collect import googl common collect order import googl common collect set import googl common file import org slf logger import org slf logger factori import org apach cassandra config meta data import org apach cassandra decor key import org apach cassandra row index entri import org apach cassandra dht partition import org apach cassandra write error import org apach cassandra util file util import org apach cassandra util random access reader import org apach cassandra util byte buffer util import org apach cassandra util heap alloc import org apach cassandra util pair class built top sequenc file store data disk sort fashion howev sort upto applic class expect key hand sort order separ index file maintain tabl key offset tabl everi index interv key read memori tabl open final bloom filter file key tabl public abstract class tabl static final logger logger logger factori logger tabl class replac compon object public static final string compon type repr public static final string compon type repr public static final string compon type repr public static final string compon type repr public static final string compon type repr public static final string compon type repr public static final string tmp public static final int public static final compar tabl reader max timestamp compar compar tabl reader public int compar tabl reader tabl reader long max timestamp long max timestamp return public final descriptor descriptor protect final set compon compon public final meta data metadata public final partition partition public final boolean compress public decor key public decor key protect tabl descriptor descriptor meta data metadata partition partition descriptor hash set compon metadata partition protect tabl descriptor descriptor set compon compon meta data metadata partition partition case metadata shouldn null null creat function tabl full schema definit tabl loader abil assert descriptor null assert compon null assert partition null descriptor descriptor set compon data compon hash set compon compon compon compon compon assert compon type compon type compress data compon compon compon copi write array set compon data compon metadata metadata partition partition public static final compar tabl reader sstabl compar compar tabl reader public int compar tabl reader tabl reader return compar public static final order tabl reader sstabl order order sstabl compar refer queue manag delet file compact tabl refer exist guarante run file becaus semant write marker compact filenam file compact marker exist startup file remov method remov tabl mark temporari return true file delet public static boolean delet descriptor desc set compon compon remov compon exist compon compon file util delet confirm desc filenam compon compon compon compon compon equal compon compon equal compon compon equal compon continu file util delet confirm desc filenam compon remov compon exist note newli creat sstabl marker don leav older marker file util delet desc filenam compon file util delet desc filenam compon logger debug delet desc return true param key occupi onli part larger buffer alloc buffer onli larg necessari public static decor key minim key decor key key return key key posit key key remain decor key key token heap alloc instanc clone key key key public string filenam return descriptor filenam public string index filenam return descriptor filenam public string column famili return descriptor cfname public string tabl return descriptor ksname return descriptor compon pair compon unknown type return compon public static pair descriptor compon tri compon filenam file dir string return compon filenam dir discov exist compon descriptor slow onli intend outsid critic path static set compon compon final descriptor desc tri tri return read desc catch file set compon compon discov compon desc compon empti return compon sstabl doesn exist compon compon compon add compon append desc compon return compon catch throw error privat static set compon discov compon descriptor desc set compon type type set differ compon collect singleton compon type set compon compon set hash set expect size type size compon type compon type type compon compon compon compon type file desc filenam compon exist compon add compon return compon return estim number key index file long estim row index random access reader ifil throw collect size key megabyt data final int int math min ifil length int key ifil file pointer key byte buffer util skip short length ifil row index entri serial skip ifil descriptor version key assert key ifil file pointer ifil length unexpect empti index file ifil long estim row ifil length ifil file pointer key ifil seek return estim row public static long total byte iter tabl reader sstabl long sum tabl reader sstabl sstabl sum sstabl disk length return sum public long byte disk long byte compon compon compon byte file descriptor filenam compon length return byte overrid public string string return class simpl path filenam read list compon compon return set compon protect static set compon read descriptor descriptor throw file toc file file descriptor filenam compon list string compon file read line toc file charset default charset set compon compon set hash set expect size compon size string compon compon compon compon compon compon type represent compon compon file descriptor filenam compon exist logger error compon descriptor filenam compon els compon add compon return compon append compon compon protect static void append descriptor descriptor collect compon compon file toc file file descriptor filenam compon print writer null tri print writer file writer toc file true compon compon compon println compon catch throw write error toc file final file util close quiet regist custom compon custom compact strategi ad compon time don remov method part public intend custom compact strategi param compon collect compon ad public synchron void add compon collect compon compon collect compon compon add collect filter compon predic predic compon append descriptor compon add compon add compon add 