licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra util import org apach cassandra type size import org apach cassandra serial import java data input import java data output import java import java util histogram construct stream data algorithm follow paper yael ben haim elad tom tov stream parallel decis tree algorithm http jmlr csail mit paper volum ben haim ben haim pdf public class stream histogram public static final stream histogram serial serial stream histogram serial tree map hold bin histogram privat final tree map doubl long bin maximum bin size histogram privat final int max bin size creat histogram max bin size max bin size param max bin size maximum number bin histogram public stream histogram int max bin size max bin size max bin size bin tree map doubl long privat stream histogram int max bin size map doubl long bin max bin size max bin size bin tree map doubl long bin add point histogram param public void updat doubl updat add point valu histogram param param public void updat doubl long long bin null increment counter bin put els bin put bin size exceed maximum bin size trim max size bin size max bin size find point smallest differ iter doubl key bin key set iter doubl key doubl key doubl smallest diff doubl key key doubl diff diff smallest diff smallest diff diff merg long bin remov long bin remov bin put merg histogram histogram param histogram merg public void merg stream histogram null return map entri doubl long entri map entri set updat entri key entri valu calcul estim number point interv inf param upper bound interv calcul sum return estim number point interv inf public doubl sum doubl doubl sum find point pnext satisfi pnext map entri doubl long pnext bin higher entri pnext null greater ani key histogram count return long valu bin valu sum valu els map entri doubl long bin floor entri null return calcul estim count point doubl weight key pnext key key doubl valu pnext valu valu weight sum valu weight sum valu long valu bin head map key fals valu sum valu return sum public map doubl long map return collect unmodifi map bin public static class stream histogram serial implement serial stream histogram public void serial stream histogram histogram data output dos throw dos write int histogram max bin size map doubl long entri histogram map dos write int entri size map entri doubl long entri entri entri set dos write doubl entri key dos write long entri valu public stream histogram deseri data input dis throw int max bin size dis read int int size dis read int map doubl long tmp hash map doubl long size int size tmp put dis read doubl dis read long return stream histogram max bin size tmp public long serial size stream histogram histogram type size type size throw unsupport oper 