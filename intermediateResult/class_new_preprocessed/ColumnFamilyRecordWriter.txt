licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra hadoop import java import java net inet address import java nio byte buffer import java util import java util concurr array block queue import java util concurr block queue import java util concurr time unit import org apach cassandra client ring cach import org apach cassandra dht rang import org apach cassandra dht token import org apach cassandra thrift import org apach cassandra util util import org apach cassandra util pair import org apach hadoop conf configur import org apach hadoop mapreduc record writer import org apach hadoop mapreduc task attempt context import org apach thrift import org apach thrift transport socket code column famili record writer code map output key valu pair cassandra column famili appli mutat valu associ key turn respons endpoint furthermor writer group mutat endpoint respons row affect mutat execut parallel direct respons endpoint column famili output format output format final class column famili record writer extend record writer byte buffer list mutat implement org apach hadoop mapr record writer byte buffer list mutat configur writer associ privat final configur conf ring cach describ token rang node ring respons group mutat endpoint target target endpoint essenti act primari replica row affect mutat privat final ring cach ring cach number mutat buffer endpoint privat final int queue size handl client rang run threadpool privat final map rang rang client client privat final long batch threshold privat final consist level consist level privat progress progress construct obtain map writer collect mutat ring cach keyspac param context task attempt context throw column famili record writer task attempt context context throw context configur progress progress context column famili record writer configur conf progress progress throw conf progress progress column famili record writer configur conf throw conf conf ring cach ring cach conf queue size conf int column famili output format util avail processor client hash map rang rang client batch threshold conf long column famili output format consist level consist level valu config helper write consist level conf key associ valid valu mutat creat column famili column event valu column null mark link delet similar entir valu key null entir key mark link delet param keybuff key write param valu valu write throw overrid public void write byte buffer keybuff list mutat valu throw rang token rang ring cach rang keybuff client rang creat rang client client client rang client null haven key rang creat client client rang client ring cach endpoint rang client start client put rang client mutat amut valu client put pair creat keybuff amut progress progress close code record writer code futur oper befor flush batch mutat param context context task throw overrid public void close task attempt context context throw interrupt close fill deprec record writer interfac stream deprec public void close org apach hadoop mapr report report throw close privat void close throw close client befor throw anyth client null rang client client client valu tri client close catch client client null throw client client run threadpool connect list endpoint rang mutat key rang client queue public class rang client extend thread list endpoint rang privat final list inet address endpoint privat final string column famili config helper output column famili conf bound queue incom mutat rang privat final block queue pair byte buffer mutat queue array block queue pair byte buffer mutat queue size privat volatil boolean run true caller someth wrong record ani unrecover write throw caller stack call put put call client close privat volatil privat cassandra client thrift client privat socket thrift socket construct link rang client endpoint param endpoint possibl endpoint execut mutat public rang client list inet address endpoint super client endpoint endpoint endpoint enqueu valu cassandra public void put pair byte buffer mutat valu throw true null throw tri queue offer valu time unit break catch interrupt throw assert error public void close throw stop run loop result close intern call time join finish run fals interrupt tri join catch interrupt throw assert error null throw privat void close intern thrift socket null thrift socket close thrift socket null thrift client null loop collect mutat queue send cassandra public void run outer run queue empti pair byte buffer mutat mutat tri mutat queue catch interrupt check loop condit interrupt continu map byte buffer map string list mutat batch hash map byte buffer map string list mutat mutat null map string list mutat batch batch mutat left batch null batch collect singleton map column famili list mutat array list mutat batch put mutat left batch batch column famili add mutat batch size batch threshold break mutat queue poll iter inet address iter endpoint iter true send mutat endpoint time harmless tri thrift client batch mutat batch consist level break catch close intern iter break outer attempt connect differ endpoint tri inet address address iter thrift socket socket address host config helper output rpc port conf thrift client column famili output format creat authent client thrift socket conf catch close intern someth unexpect wrong endpoint tri anoth auth invalid request fatal instanceof iter break outer overrid public string string return client endpoint string 