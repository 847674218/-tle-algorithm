licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra locat import java net inet address import java util import java util map entri import org slf logger import org slf logger factori import org apach cassandra tabl import org apach cassandra configur import org apach cassandra dht token import org apach cassandra locat token metadata topolog import org apach cassandra util util import googl common collect multimap replic strategi properti file give intend replic factor datacent sum total datacent replic factor valu equal keyspac replic factor exampl keyspac replic factor datacent replic factor replica datacent anoth anoth total class cach endpoint invalid cach chang number token public class network topolog strategi extend abstract replic strategi privat final endpoint snitch snitch privat final map string integ datacent privat static final logger logger logger factori logger network topolog strategi class public network topolog strategi string tabl token metadata token metadata endpoint snitch snitch map string string config option throw configur super tabl token metadata snitch config option snitch snitch map string integ datacent hash map string integ config option null entri string string entri config option entri set string entri key equal ignor case replic factor throw configur replic factor option simpl strategi network topolog strategi integ replica integ valu entri valu datacent put replica datacent collect unmodifi map datacent logger debug configur datacent replica util string datacent calcul endpoint pass token track progress rack suppress warn serial public list inet address calcul natur endpoint token search token token metadata token metadata set inet address replica hash set inet address replica map string set inet address replica hash map string set inet address datacent size map entri string integ datacent entri set put key hash set inet address valu topolog topolog token metadata topolog endpoint check exhaust member multimap string inet address endpoint topolog datacent endpoint rack check exhaust rack map string multimap string inet address rack topolog datacent rack assert endpoint empti rack empti awar ani cluster member track rack alreadi place replica map string set string rack hash map string set string datacent size map entri string integ datacent entri set put key hash set string track endpoint skip uniqu rack relax rack uniqu append current result don wind iter map string set inet address skip endpoint hash map string set inet address datacent size map entri string integ datacent entri set put key link hash set inet address iter token token iter token metadata ring iter token metadata sort token search token fals token iter suffici replica replica endpoint token token iter inet address token metadata endpoint string snitch datacent alreadi replica datacent key suffici replica replica endpoint continu skip check rack rack size rack key set size replica add replica add els string rack snitch rack rack rack rack skip endpoint add els replica add replica add rack add rack run distinct rack add host skip alreadi rack size rack key set size iter inet address skip skip endpoint iter skip suffici replica replica endpoint inet address skip skip replica add skip replica add skip return array list inet address replica privat boolean suffici replica string map string set inet address replica multimap string inet address endpoint return replica size math min endpoint size replic factor privat boolean suffici replica map string set inet address replica multimap string inet address endpoint string datacent key set suffici replica replica endpoint return fals return true public int replic factor int total int rep factor datacent valu total rep factor return total public int replic factor string integ replica datacent return replica null replica public set string datacent return datacent key set public void valid option throw configur entri string string config option entri set valid replic factor valu 