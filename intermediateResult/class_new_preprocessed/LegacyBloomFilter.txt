licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra util import java import java nio byte buffer import java util bit set import org slf logger import org slf logger factori public class legaci bloom filter implement filter privat static final int privat static final logger logger logger factori logger legaci bloom filter class public static final legaci bloom filter serial serial legaci bloom filter serial privat bit set filter privat final int hash count legaci bloom filter int hash bit set filter hash count hash filter filter privat static bit set bucket long num element int bucket long num bit num element bucket return bit set int math min integ num bit return legaci bloom filter lowest practic fals posit probabl number element public static legaci bloom filter filter long num element int target bucket elem int max bucket element math max bloom calcul max bucket element num element int bucket element math min target bucket elem max bucket element bucket element target bucket elem logger warn string format provid optim legaci bloom filter element bucket element num element bucket element target bucket elem bloom calcul bloom specif spec bloom calcul comput bloom spec bucket element return legaci bloom filter spec bucket num element spec bucket element return smallest legaci bloom filter provid fals posit probabl rate number element assert probabl satisfi filter public static legaci bloom filter filter long num element doubl max fals pos probabl assert max fals pos probabl invalid probabl int bucket element bloom calcul max bucket element num element bloom calcul bloom specif spec bloom calcul comput bloom spec bucket element max fals pos probabl return legaci bloom filter spec bucket num element spec bucket element public void clear filter clear int bucket return filter size public boolean present byte buffer key int bucket index hash bucket key filter bucket index return fals return true param key valu hash fill filter general purpos public void add byte buffer key int bucket index hash bucket key filter set bucket index public string string return filter string int empti bucket int int bucket filter return return legaci bloom filter alway return posit match test public static legaci bloom filter alway match bloom filter bit set set bit set set set return legaci bloom filter set public int hash bucket byte buffer key return legaci bloom filter hash bucket key hash count bucket murmur faster base approach provid good collis resist combinatori generat approach describ http www eec harvard kirsch pub bbbf esa pdf doe prove work actual test obvious faster perform iter murmur static int hash bucket byte buffer int hash count int max int result int hash count int hash murmur hash hash posit remain int hash murmur hash hash posit remain hash int hash count result math ab hash hash max return result public bit set bit set return filter public void close throw noth 