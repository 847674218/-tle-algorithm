licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra cql oper import java nio byte buffer import java util array list import java util hash map import java util list import java util map import org apach cassandra cql column identifi import org apach cassandra cql column builder import org apach cassandra cql column specif import org apach cassandra cql term import org apach cassandra cql updat paramet import org apach cassandra column famili import org apach cassandra column import org apach cassandra marshal abstract type import org apach cassandra marshal collect type import org apach cassandra marshal map type import org apach cassandra marshal marshal import org apach cassandra invalid request import org apach cassandra util pair public class map oper implement oper enum kind privat final map term term valu privat final term discard key privat final kind kind privat map oper map term term valu kind kind valu valu discard key null kind kind privat map oper term discard key valu null discard key discard key kind kind public void execut column famili column builder builder abstract type valid updat paramet param list pair byte buffer column list throw invalid request valid instanceof map type throw invalid request map oper onli support map type column valid switch kind case fallthrough purpos remov previous map befor set add atom param tombston overwrit builder copi build builder copi build rang case put builder collect type valid param break case discard builder collect type valid param break default throw assert error unsupport map oper kind public static void set prepar column famili column builder builder map type valid term valu updat paramet param throw invalid request valu bind marker throw invalid request appli oper column valid type add atom param tombston overwrit builder copi build builder copi build rang put prepar builder valid valu param public static void put prepar column famili column builder builder map type valid term valu updat paramet param throw invalid request valu bind marker throw invalid request appli oper column valid type tri map valid compos param variabl valu bind index map entri entri entri set byte buffer builder copi add valid compar decompos entri key build byte buffer valu valid valu compar decompos entri valu add column param column valu catch marshal throw invalid request messag privat void put column famili column builder builder collect type valid updat paramet param throw invalid request map entri term term entri valu entri set byte buffer builder copi add entri key byte buffer valid compar param variabl build byte buffer valu entri valu byte buffer valid valu compar param variabl add column param column valu privat void discard column famili column builder builder collect type valid updat paramet param throw invalid request byte buffer builder add discard key byte buffer valid compar param variabl build add column param tombston public void add bound column specif column column specif bound throw invalid request column type instanceof map type throw invalid request string format invalid oper map type column map type map type column type map entri term term entri valu entri set term key entri key term valu entri valu key bind marker bound key bind index key spec column valu bind marker bound valu bind index valu spec column public static column specif key spec column specif column map type type return column specif column column column identifi key column true type key public static column specif valu spec column specif column map type type return column specif column column column identifi valu column true type valu public list term valu list term array list term valu size map entri term term entri valu entri set add entri key add entri valu return public boolean requir read abstract type valid return kind kind kind kind public type type return type util method public static oper set map term term valu return map oper valu kind public static oper put map term term valu return map oper valu kind public static oper put final term key final term valu return put hash map term term put key valu public static oper discard key term discard key return map oper discard key 