licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java net inet address import java util array list import java util collect import java util hash map import java util list import java util map import googl common collect iter import org slf logger import org slf logger factori import org apach cassandra config meta data import org apach cassandra config databas descriptor import org apach cassandra config read repair decis import org apach cassandra invalid request import org apach cassandra unavail import org apach cassandra locat abstract replic strategi import org apach cassandra locat network topolog strategi import org apach cassandra transport protocol public enum consist level privat static final logger logger logger factori logger consist level class binari protocol public final int code privat static final consist level code idx static int max code consist level consist level valu max code math max max code code code idx consist level max code consist level consist level valu code idx code null throw illeg state duplic code code idx code privat consist level int code code code public static consist level code int code code code code idx length throw protocol string format unknown code consist level code return code idx code privat int local quorum tabl tabl string return network topolog strategi tabl replic strategi replic factor public int block tabl tabl switch case return case return case return case return case return tabl replic strategi replic factor case return tabl replic strategi replic factor case return local quorum tabl databas descriptor local data center case network topolog strategi strategi network topolog strategi tabl replic strategi int string strategi datacent local quorum tabl return default throw unsupport oper invalid consist level string privat boolean local inet address endpoint return databas descriptor local data center equal databas descriptor endpoint snitch datacent endpoint privat int count local endpoint iter inet address live endpoint int count inet address endpoint live endpoint local endpoint count return count privat map string integ count endpoint tabl tabl iter inet address live endpoint network topolog strategi strategi network topolog strategi tabl replic strategi map string integ endpoint hash map string integ string strategi datacent endpoint put inet address endpoint live endpoint string databas descriptor endpoint snitch datacent endpoint endpoint put endpoint return endpoint public list inet address filter queri tabl tabl list inet address live endpoint return filter queri tabl live endpoint read repair decis public list inet address filter queri tabl tabl list inet address live endpoint read repair decis read repair endpoint expect restrict live replica sort snitch prefer move local replica front read repair sinc replica data read sinc block collect sort live endpoint databas descriptor local compar switch read repair case return live endpoint list math min live endpoint size block tabl case return live endpoint case list inet address local array list inet address list inet address array list inet address inet address add live endpoint local add local add add els add add check blockfor localep int block block tabl local size block local add list math min block local size size return local default throw assert error public boolean suffici live node tabl tabl iter inet address live endpoint switch case local hint accept local node alway live return true case return count local endpoint live endpoint block tabl case map entri string integ entri count endpoint tabl live endpoint entri set entri valu local quorum tabl entri key return fals return true default return iter size live endpoint block tabl public void assur suffici live node tabl tabl iter inet address live endpoint throw unavail int block block tabl switch case local hint accept local node alway live break case int local live count local endpoint live endpoint local live block logger debug enabl string builder builder string builder local replica inet address endpoint live endpoint local endpoint builder append endpoint append builder append insuffici satisfi requir append block append live node append databas descriptor local data center append logger debug builder string throw unavail block local live break case map entri string integ entri count endpoint tabl live endpoint entri set int block local quorum tabl entri key int live entri valu live block throw unavail block live break default int live iter size live endpoint live block logger debug live node satisfi consist level requir iter string live endpoint block throw unavail block live break public void valid read string tabl throw invalid request switch case throw invalid request consist level onli support write case requir network topolog strategi tabl break case throw invalid request consist level onli support write public void valid write string tabl throw invalid request switch case case requir network topolog strategi tabl break public void valid counter write meta data metadata throw invalid request consist level throw invalid request consist level support counter columnfamili metadata els metadata replic write consist level throw invalid request achiev replic write columnfamili metadata privat void requir network topolog strategi string tabl throw invalid request abstract replic strategi strategi tabl open tabl replic strategi strategi instanceof network topolog strategi throw invalid request string format consist level compat replic strategi strategi class 