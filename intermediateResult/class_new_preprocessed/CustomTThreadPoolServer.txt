licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra thrift import java net inet socket address import java net socket address import java net socket timeout import java util concurr executor servic import java util concurr synchron queue import java util concurr thread pool executor import java util concurr time unit import java util concurr atom atom integ import org slf logger import org slf logger factori import org apach cassandra concurr thread factori import org apach cassandra config databas descriptor import org apach cassandra config encrypt option client encrypt option import org apach thrift import org apach thrift processor import org apach thrift protocol protocol import org apach thrift server server import org apach thrift server thread pool server import org apach thrift transport transport factori import org apach thrift transport server socket import org apach thrift transport server transport import org apach thrift transport transport import org apach thrift transport transport import org apach thrift transport transport factori transport paramet slight modifi version apach thrift thread pool server pass executor control actual behaviour task run newer version thrift obsolet public class custom thread pool server extend server privat static final logger logger logger factori logger custom thread pool server class executor servic handl client connect privat final executor servic executor servic flag stop server privat volatil boolean stop server option privat final thread pool server arg arg track limit number connect client privat final atom integ activ client atom integ public custom thread pool server thread pool server arg arg executor servic executor servic super arg executor servic executor servic arg arg public void serv tri server transport listen catch transport ttx logger error error occur dure listen ttx return stop fals stop block max client activ client arg max worker thread tri thread sleep catch interrupt throw assert error tri transport client server transport accept activ client increment worker process worker process client executor servic execut catch transport ttx ttx caus instanceof socket timeout thrift suck continu stop logger warn transport error occur dure accept messag ttx activ client arg max worker thread logger warn maximum number client arg max worker thread reach executor servic shutdown thrift default shutdown wait worker process thread complet becaus client hold shutdown hostag simpli send anoth messag stop call sinc process block indefinit tri read meessag header fix updat thrift set socket timeout client connect toler unintent timeout stop set requir deep chang code generat simpli set thread daemon custom clean thread pool ignor shutdown good rememb goal shutdown necessarili client request receiv answer redirect client differ coordin updat ack success generat hint ani respons replica quick stop accept client connect shutdown continu wait worker process thread accomplish messag servic shutdown method care public void stop stop true server transport interrupt privat class worker process implement runnabl client servic privat transport client default constructor param client transport process privat worker process transport client client client loop process client forev public void run processor processor null transport input transport null transport output transport null protocol input protocol null protocol output protocol null socket address socket null tri socket custom socket client socket remot socket address thrift session manag instanc set current socket socket processor processor factori processor client input transport input transport factori transport client output transport output transport factori transport client input protocol input protocol factori protocol input transport output protocol output protocol factori protocol output transport check stop suppos shut necessari grace shutdown suffici sinc process arbitrarili long wait client input comment serv stop processor process input protocol output protocol input protocol input protocol factori protocol input transport output protocol output protocol factori protocol output transport catch transport ttx assum client die continu silent log debug debug frame larg error logger debug thrift transport error occur dure process messag ttx catch logger error thrift error occur dure process messag catch logger error error occur dure process messag final activ client decrement socket null thrift session manag instanc connect complet socket input transport null input transport close output transport null output transport close public static class factori implement server factori public server build server arg arg final inet socket address addr arg addr server transport server transport tri final client encrypt option client enc databas descriptor client encrypt option client enc enabl logger info enabl encrypt thrift connect client server transport paramet param transport paramet client enc protocol client enc cipher suit param set key store client enc keystor client enc keystor password param requir client auth client enc requir client auth server socket ssl server transport factori server socket addr port addr address param server transport custom server socket ssl server server socket arg aliv arg send buffer size arg recv buffer size els server transport custom server socket addr arg aliv arg send buffer size arg recv buffer size catch transport throw runtim string format unabl creat thrift socket addr address addr port thread pool server invoc connect basi thread pool server arg server arg thread pool server arg server transport min worker thread databas descriptor rpc min thread max worker thread databas descriptor rpc max thread input transport factori arg transport factori output transport factori arg transport factori input protocol factori arg protocol factori output protocol factori arg protocol factori processor arg processor executor servic executor servic thread pool executor server arg min worker thread server arg max worker thread time unit synchron queue runnabl thread factori thrift return custom thread pool server server arg executor servic 