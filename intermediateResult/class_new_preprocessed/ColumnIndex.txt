licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java data output import java import java nio byte buffer import java util import org apach cassandra config databas descriptor import org apach cassandra sstabl index helper import org apach cassandra util alway present filter import org apach cassandra util filter import org apach cassandra util filter factori public class column index public final list index helper index info column index public final filter bloom filter privat static final column index column index collect index helper index info empti list alway present filter privat column index int estim column count array list index helper index info filter factori filter estim column count fals privat column index list index helper index info column index filter bloom filter column index column index bloom filter bloom filter creat index column famili base size column write column disk public static class builder privat final column index result privat final long index offset privat long start posit privat long posit privat long block size privat disk atom column privat disk atom column privat disk atom block close privat final data output output privat final rang tombston tracker tombston tracker privat final disk atom serial atom serial privat int atom count public builder column famili byte buffer key int estim column count data output output index offset row header size key delet info result column index estim column count output output atom serial disk serial tombston tracker rang tombston tracker compar return number byte row serial column privat static long row header size byte buffer key delet info del info type size type size type size fix constant size chang nativeconstst int keysiz key remain return type size sizeof short keysiz keysiz row key type size sizeof row data size delet time serial serial size del info top level delet type size type size sizeof column count public rang tombston tracker tombston tracker return tombston tracker public int written atom count return atom count tombston tracker written atom serial index memori structur requir compon bloom filter index block size index info list param column famili creat index return inform index bloom filter block size index info list public column index build column famili throw iter rang tombston rang iter delet info rang iter rang tombston tombston rang iter rang iter null compar byte buffer compar compar column tombston null compar compar tombston min add tombston tombston rang iter rang iter null add tombston null add tombston tombston rang iter rang iter null return build public column index build iter disk atom column throw disk atom column add return build public void add disk atom column throw atom count column instanceof column result bloom filter add column column null column column start posit posit column min optim read posit tombston tracker write open marker column output atom serial block size don count repeat tombston marker block size avoid situat wouldn ani problem becaus block fill marker long size column serial size tabl posit size block size size hit column index size index index block size databas descriptor column index size index helper index info index info index helper index info column column index offset start posit posit start posit result column index add index info column null block close column output null atom serial serial tabl column output deal remov unneed tombston tombston tracker updat column column column public column index build column column null return column index column fallen index boundari alreadi index explicit result column index empti block close column index helper index info index info index helper index info column column index offset start posit posit start posit result column index add index info alway comput index block onli write assert result column index size return result 