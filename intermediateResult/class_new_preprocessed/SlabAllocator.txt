licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra util import java nio byte buffer import java util concurr atom atom integ import java util concurr atom atom refer import googl common base precondit import org slf logger import org slf logger factori slab alloc bump pointer alloc alloc larg default region dole thread request slice array purpos class combat heap fragment long live object ensur alloc similar lifetim onli larg region contigu memori ensur larg block freed time otherwis variabl length byte array alloc interleav heap generat progress fragment stop world compact collect occur public class slab alloc extend alloc privat static final logger logger logger factori logger slab alloc class privat final static int privat final static int bigger don region privat final atom refer region current region atom refer region privat volatil int region count public byte buffer alloc int size assert size size return byte buffer util satisfi larg alloc direct sinc don caus fragment bad fill region quick size return byte buffer alloc size true region region region tri alloc region byte buffer clone region alloc size clone null return clone space current region compar set region null current region current region alloc privat region region true tri region region region current region region null return region current region alloc race alloc uniniti region cheap alloc region region current region compar set null region won race actual expens alloc step region init region count logger trace region alloc region count return region someon els won race fine tri grab iter loop region memori alloc slice serv purpos provid step initi alloc race region harmless encapsul alloc offset privat static class region actual data privat byte buffer data privat static final int offset alloc sentinel valu impli region uniniti privat atom integ free offset atom integ total number alloc satisfi buffer privat atom integ alloc count atom integ size region byte privat final int size creat uniniti region note memori alloc cheap param size byte privat region int size size size actual claim memori region onli call thread construct region thread safe thread call alloc block alloc complet public void init assert free offset data byte buffer alloc size assert data remain data capac mark readi boolean init free offset compar set alway succeed abov sinc onli thread call init precondit check state init multipl thread tri init region tri alloc code size code byte region return success alloc null indic space public byte buffer alloc int size true int offset free offset offset region doesn data alloc sinc current region alloc spin loop shouldn spin long thread yield continu offset size data capac capac remain return null tri atom claim region free offset compar set offset offset size alloc alloc count increment return byte buffer data duplic posit offset limit offset size race lost alloc tri overrid public string string return region system ident hash code alloc alloc count wast data capac free offset 