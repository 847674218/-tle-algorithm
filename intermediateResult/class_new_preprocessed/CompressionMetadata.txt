licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra compress import java import java util import googl common annot visibl test import googl common primit long import org apach cassandra configur import org apach cassandra type size import org apach cassandra read error import org apach cassandra write error import org apach cassandra version serial import org apach cassandra sstabl compon import org apach cassandra sstabl corrupt tabl import org apach cassandra sstabl descriptor import org apach cassandra util file util import org apach cassandra util memori import org apach cassandra util pair hold metadata compress file public class compress metadata public final long data length public final long compress file length privat final memori chunk offset public final string index file path public final compress paramet paramet creat metadata compress file includ uncompress data length chunk size list chunk offset compress data expens oper don creat sstabl param data file path path compress file return metadata compress file public static compress metadata creat string data file path descriptor desc descriptor filenam data file path return compress metadata desc filenam compon file data file path length visibl test compress metadata string index file path long compress length index file path index file path data input stream stream tri stream data input stream file input stream index file path catch file throw runtim tri string compressor stream read int option count stream read int map string string option hash map string string int option count string key stream read string valu stream read option put key valu int chunk length stream read int tri paramet compress paramet compressor chunk length option catch configur throw runtim creat compress paramet store paramet data length stream read long compress file length compress length chunk offset read chunk offset stream catch throw corrupt tabl index file path final file util close quiet stream public compressor compressor return paramet sstabl compressor public int chunk length return paramet chunk length read offset individu chunk input param input sourc data return collect chunk offset privat memori read chunk offset data input input tri int chunk count input read int memori offset memori alloc chunk count int chunk count tri offset set long input read long catch string msg string format corrupt index file read expect chunk index file path chunk count throw corrupt tabl msg index file path return offset catch throw read error index file path chunk compress data offset length correspond posit param posit posit file return pair chunk offset length public chunk chunk long posit posit chunk int idx int posit paramet chunk length idx chunk offset size throw corrupt tabl index file path long chunk offset chunk offset long idx long chunk offset idx chunk offset size compress file length chunk offset long idx return chunk chunk offset int chunk offset chunk offset byte reserv checksum param section collect section uncompress file return array chunk correspond section uncompress file sort chunk offset public chunk chunk section collect pair long long section sort set elimin duplic sort chunk offset sort set chunk offset tree set chunk compar chunk public int compar chunk chunk return long compar offset offset pair long long section section int start index int section left paramet chunk length int index int section paramet chunk length int start index index long offset long chunk offset chunk offset long offset long chunk offset offset chunk offset size compress file length chunk offset long offset offset add chunk chunk offset int chunk offset chunk offset byte reserv checksum return offset array chunk offset size public void close chunk offset free public static class writer extend random access file place uncompress data length index file privat long data length offset path file privat final string file path privat writer string path throw file super path file path path public static writer open string path tri return writer path catch file throw runtim public void write header compress paramet paramet tri write paramet sstabl compressor class simpl write int paramet option size map entri string string entri paramet option entri set write entri key write entri valu store length chunk write int paramet chunk length store posit reserv place uncompress data length chunk count data length offset file pointer write long write int catch throw write error file path public void final header long data length int chunk assert data length offset write header wasn call long current posit tri current posit file pointer catch throw read error file path tri seek data length posit seek data length offset write uncompress data length chunk count write long data length write int chunk seek previous posit seek current posit catch throw write error file path chunk offset index param chunk index index chunk return offset chunk compress file public long chunk offset int chunk index data length offset throw illeg state write header wasn call tri long posit file pointer seek posit chunk seek data length offset size reserv uncompress data length size reserv chunk count chunk index tri return read long final origin posit seek posit catch throw read error file path reset writer chunk offset written code chunk index public void reset truncat int chunk index tri seek data length offset size reserv uncompress data length size reserv chunk count chunk index channel truncat file pointer catch throw write error file path hold offset length file chunk public static class chunk public static final version serial chunk serial chunk serial public final long offset public final int length public chunk long offset int length offset offset length length public boolean equal object return true null class class return fals chunk chunk chunk return length chunk length offset chunk offset public int hash code int result int offset offset result result length return result public string string return string format chunk offset length offset length static class chunk serial implement version serial chunk public void serial chunk chunk data output int version throw write long chunk offset write int chunk length public chunk deseri data input int version throw return chunk read long read int public long serial size chunk chunk int version long size type size sizeof chunk offset size type size sizeof chunk length return size 