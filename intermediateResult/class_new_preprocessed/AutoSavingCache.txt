licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra cach import java import java nio byte buffer import java util import java util concurr futur import java util concurr schedul futur import java util concurr time unit import org cliffc high scale lib block hash set import org slf logger import org slf logger factori import org apach cassandra config meta data import org apach cassandra config databas descriptor import org apach cassandra tabl import org apach cassandra compact compact info import org apach cassandra compact compact manag import org apach cassandra compact oper type import org apach cassandra column famili store import org apach cassandra write error import org apach cassandra util file util import org apach cassandra util sequenti writer import org apach cassandra servic cach servic import org apach cassandra servic storag servic import org apach cassandra util byte buffer util import org apach cassandra util pair public class auto save cach extend cach key extend instrument cach privat static final logger logger logger factori logger auto save cach class true cach flush current execut onli execut time public static final set cach servic cach type flush progress block hash set cach servic cach type protect volatil schedul futur save task protect final cach servic cach type cach type privat cach serial cach loader privat static final string public auto save cach cach cach cach servic cach type cach type cach serial cacheload super cach type string cach cach type cach type cach loader cacheload public file cach path string string string version return databas descriptor serial cach path cach type version public writer writer int key save return writer key save public void schedul save int save period final int key save save task null save task cancel fals interrupt progress save save task null save period runnabl runnabl runnabl public void run submit write key save save task storag servic option task schedul fix delay runnabl save period save period time unit public int load save column famili store cfs int count long start system current time milli cach format onli save key file path cach path cfs tabl cfs column famili null path exist data input stream null tri logger info string format read save cach path data input stream buffer input stream file input stream path set byte buffer key hash set byte buffer avail key add byte buffer util read length count cach loader load key cfs catch logger warn string format error read save cach key load path absolut path count return count final file util close quiet modern format key valu key cach load pure sequenti path cach path cfs tabl cfs column famili path exist data input stream null tri logger info string format read save cach path data input stream buffer input stream file input stream path list futur pair futur array list futur pair avail futur pair entri cach loader deseri cfs key cach entri return null tabl doesn exist entri null continu futur add entri count futur pair futur futur pair entri futur put entri left entri catch logger warn string format error read save cach path absolut path final file util close quiet logger debug enabl logger debug string format complet read key save cach system current time milli start count path return count public futur submit write int key save return compact manag instanc submit cach write writer key save public void reduc cach size capac int capac int databas descriptor reduc cach capac weight size logger warn string format reduc capac reduc memori pressur cach type capac capac set capac capac public class writer extend compact info holder privat final set key privat final compact info info privat long key written protect writer int key save key save key set size key key set els key hot key set key save oper type type cach type cach servic cach type type oper type els cach type cach servic cach type type oper type els type oper type info compact info meta data tabl cach type string null null null type key size key public cach servic cach type cach type return cach type public compact info compact info keyset chang size total return info progress key written math max key written key size public void save cach logger debug delet file cach type delet cach file key empti logger debug skip save cach empti cach type return long start system current time milli hash map pair string string sequenti writer writer hash map pair string string sequenti writer tri key key pair string string path key path info sequenti writer writer writer path writer null writer temp cach file path writer put path writer tri cach loader serial key writer stream catch throw write error writer path key written final sequenti writer writer writer valu file util close quiet writer map entri pair string string sequenti writer info writer entri set pair string string path info key sequenti writer writer info valu file tmp file file writer path file cach file cach path path left path cach file delet ignor error didn exist tmp file renam cach file logger error unabl renam tmp file cach file logger info string format save item cach type key size system current time milli start privat sequenti writer temp cach file pair string string path info file path cach path path info left path info file tmp file file util creat temp file path null path parent file return sequenti writer open tmp file true privat void delet cach file file save cach dir file databas descriptor save cach locat save cach dir exist save cach dir directori file file save cach dir list file file file file cach type string file delet logger warn fail delet file absolut path file file file file delet logger warn fail delet file absolut path public interfac cach serial extend cach key void serial key data output throw futur pair deseri data input stream column famili store cfs throw deprec void load set byte buffer buffer column famili store cfs 