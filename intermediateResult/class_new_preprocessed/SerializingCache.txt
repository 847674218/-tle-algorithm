licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra cach import java import java util set import org slf logger import org slf logger factori import googlecod concurrentlinkedhashmap concurr link hash map import googlecod concurrentlinkedhashmap evict listen import googlecod concurrentlinkedhashmap weigher import org apach cassandra type size import org apach cassandra serial import org apach cassandra util memori input stream import org apach cassandra util memori output stream import org apach cassandra util vint encod data input stream import org apach cassandra util vint encod data output stream serial cach valu heap public class serial cach implement cach privat static final logger logger logger factori logger serial cach class privat static final type size type size privat static final int privat final concurr link hash map ref count memori map privat final serial serial privat serial cach long capac weigher ref count memori weigher serial serial serial serial evict listen ref count memori listen evict listen ref count memori public void evict ref count memori mem mem unrefer map concurr link hash map builder ref count memori weigher weigher maximum weight capac capac concurr level listen listen build public static serial cach creat long weight capac weigher ref count memori weigher serial serial return serial cach weight capac weigher serial public static serial cach creat long weight capac serial serial return creat weight capac weigher ref count memori public int weight ref count memori valu long size valu size assert size integ serial size return int size serial privat deseri ref count memori mem tri return serial deseri encod data input stream memori input stream mem catch logger debug fetch memori data failback read disk return null privat ref count memori serial valu long serial size serial serial size valu serial size integ throw illeg argument unabl alloc serial size byte ref count memori freeabl memori tri freeabl memori ref count memori serial size catch memori error return null tri serial serial valu encod data output stream memori output stream freeabl memori catch throw runtim return freeabl memori public long capac return map capac public void set capac long capac map set capac capac public boolean empti return map empti public int size return map size public long weight size return map weight size public void clear map clear public object key ref count memori mem map key mem null return null mem refer return null tri return deseri mem final mem unrefer public void put key valu ref count memori mem serial valu mem null return memori mind ref count memori map put key mem null unrefer public boolean put absent key valu ref count memori mem serial valu mem null return fals memori mind ref count memori map put absent key mem null valu put useless alloc memori free mem unrefer return null public boolean replac key replac valu valu map fail ref count memori map key null return fals valu match replac ref count memori mem serial valu mem null return fals memori mind valu refer guy befor serial refer return fals alreadi freed henc noop tri valu deseri final unrefer boolean success valu equal replac map replac key mem success unrefer eventu clean els mem unrefer return success public void remov key ref count memori mem map remov key mem null mem unrefer public set key set return map key set public set hot key set int return map descend key set limit public boolean key key return map key key public boolean put copi return true 