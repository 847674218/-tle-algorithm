licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra dht import java data input import java data output import java import java net inet address import java util import java util concurr time unit import java util concurr lock condit import org slf logger import org slf logger factori import org apach cassandra config schema import org apach cassandra configur import org apach cassandra config databas descriptor import org apach cassandra tabl import org apach cassandra locat abstract replic strategi import org apach cassandra locat token metadata import org apach cassandra net async callback import org apach cassandra net verb handler import org apach cassandra net messag servic import org apach cassandra servic storag servic import org apach cassandra stream oper type import org apach cassandra util util import org apach cassandra util simpl condit import org apach cassandra type size import org apach cassandra gms failur detector import org apach cassandra version serial import org apach cassandra net public class boot strapper privat static final logger logger logger factori logger boot strapper class endpoint bootstrap protect final inet address address token node bootstrap protect final collect token token protect final token metadata token metadata privat static final long default bootstrap timeout public boot strapper inet address address collect token token token metadata tmd assert address null assert token null token empti address address token token token metadata tmd public void bootstrap logger debug enabl logger debug bootstrap process rang streamer streamer rang streamer token metadata address oper type streamer add sourc filter rang streamer failur detector sourc filter failur detector instanc string tabl schema instanc system tabl abstract replic strategi strategi tabl open tabl replic strategi streamer add rang tabl strategi pend address rang token metadata token address streamer fetch storag servic instanc finish bootstrap initialtoken specifi split comma otherwis num token pick token assum load load node els choos num token token random public static collect token bootstrap token final token metadata metadata map inet address doubl load throw configur collect string initi token databas descriptor initi token user specifi token initi token size logger debug token manual specifi initi token list token token array list token string token string initi token token token storag servic partition token factori string token string metadata endpoint token null throw configur bootstrap exist token token string decommiss removetoken node token add token return token int num token databas descriptor num token num token throw configur num token num token return collect singleton balanc token metadata load return random token metadata num token public static collect token random token token metadata metadata int num token set token token hash set token num token token size num token token token storag servic partition random token metadata endpoint token null token add token return token deprec public static token balanc token token metadata metadata map inet address doubl load inet address max endpoint bootstrap sourc metadata load token bootstrap token max endpoint logger info token assum load max endpoint return deprec static inet address bootstrap sourc final token metadata metadata final map inet address doubl load sort number node alreadi bootstrap sourc node rang load list inet address endpoint array list inet address load size inet address endpoint load key set metadata member endpoint failur detector instanc aliv endpoint continu endpoint add endpoint endpoint empti throw runtim node unabl bootstrap intend start singl node cluster broadcast address listen address list seed otherwis determin whi seed contact knowledg rest cluster usual solv give node seed list collect sort endpoint compar inet address public int compar inet address inet address int metadata pend rang chang int metadata pend rang chang return target prioriti doubl load load doubl load load load load return return load load inet address max endpoint endpoint endpoint size assert max endpoint equal util broadcast address metadata pend rang chang max endpoint throw runtim everi node bootstrap sourc pleas specifi initi token manual wait exist bootstrap oper finish return max endpoint deprec static token bootstrap token inet address max endpoint messag messag messag messag servic verb int retri long timeout math max databas descriptor rpc timeout retri bootstrap token callback btc bootstrap token callback messag servic instanc send messag max endpoint btc timeout token token btc token timeout token null return token retri throw runtim bootstrap fail obtain token max endpoint deprec public static class bootstrap token verb handler implement verb handler public void verb messag messag string storag servic storag servic instanc string token string storag servic partition token factori string bootstrap token messag string respons messag string messag servic verb token string string serial instanc messag servic instanc send repli respons messag deprec privat static class bootstrap token callback implement async callback string privat volatil token token privat final condit condit simpl condit public token token long timeout boolean success tri success condit await timeout time unit catch interrupt throw runtim return success token null public void respons messag string msg token storag servic partition token factori string msg payload condit signal public boolean latenc snitch return fals public static class string serial implement version serial string public static final string serial instanc string serial public void serial string data output int version throw write public string deseri data input int version throw return read public long serial size string int version return type size sizeof 