licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra compact import java data output import java import java secur messag digest import java util iter import java util list import googl common base predic import googl common collect iter import org slf logger import org slf logger factori import org apach cassandra import org apach cassandra columniter countabl column iter import org apach cassandra columniter disk atom iter import org apach cassandra index secondari index manag import org apach cassandra marshal abstract type import org apach cassandra sstabl column stat import org apach cassandra sstabl tabl import org apach cassandra util data output buffer import org apach cassandra util merg iter import org apach cassandra util stream histogram lazili compact row onli comput row bloom filter column index memori construct time doe read column time row compact merg doe memori time bloom filter index column pre compact row write updat call pass pre compact row write merg column updat hash column row deseri time public class lazili compact row extend abstract compact row implement iter disk atom privat static logger logger logger factori logger lazili compact row class privat final list extend countabl column iter row privat final compact control control privat final boolean purg privat column famili empti column famili privat reduc reduc privat final column stat column stat privat long column serial size privat boolean close privat column index builder index builder privat column index column index privat final secondari index manag updat index public lazili compact row compact control control list extend countabl column iter row super row key row row control control index control cfs index manag updat key fals long max del timestamp long disk atom iter row row column famili row column famili max del timestamp math max max del timestamp delet info max timestamp empti column famili null empti column famili els empti column famili delet purg control purg key max del timestamp tri index write null catch throw runtim reach reduc dure iter column count size max column timestamp howev column iter call column index reduc null column stat column stat reduc null reduc column reduc null long reduc min timestamp reduc null max del timestamp math max max del timestamp reduc max timestamp reduc null stream histogram tabl reduc tombston column serial size reduc null reduc serial size reduc null privat void index write data output throw index builder column index builder empti column famili key key estim column count column index index builder build public long write data output throw assert close data output buffer clock data output buffer delet info serial serial tabl empti column famili delet info clock long data size clock length column serial size logger debug enabl logger debug string format clock column size clock length column serial size assert data size write long data size write clock data clock length write int index builder written atom count rebuild column index useless becaus rang tombston marker depend index abl remov phase compact avoid index write long pass column size reduc null reduc serial size assert pass column size column serial size origin calcul column size column serial size pass column size close return data size public void updat messag digest digest assert close special case row size actual skip byte blind updat everyth wouldn correct data output buffer data output buffer tri delet info serial serial tabl empti column famili delet info write int column stat column count digest updat data length catch throw assert error iter disk atom iter iter iter iter updat digest digest close public boolean empti boolean irrelev purg column famili store remov delet empti column famili control befor null empti column famili mark delet tombston relev return irrelev column stat column count public int estim column count int countabl column iter row row row column count return public abstract type compar return empti column famili compar public iter disk atom iter countabl column iter row row row reset reduc reduc iter disk atom iter merg iter row compar disk atom compar reduc return iter filter iter predic null public column stat column stat return column stat public void close disk atom iter row row tri row close catch throw runtim close true public delet info delet info return empti column famili delet info return column index row public column index index return column index privat class reduc extend merg iter reduc disk atom disk atom column reduc togeth onli column leverag conflict resolut code column famili empti column famili clone shallow tombston refer reconcil column dure reduc rang tombston tombston long serial size int column count int column long min timestamp long long max timestamp long stream histogram tombston stream histogram tabl public void reduc disk atom current current instanceof rang tombston tombston rang tombston current els column column column current add column column column column column index remov column protect disk atom reduc tombston null rang tombston tombston tombston null data abl control befor return null els serial size serial size tabl return els column famili purg precompact row remov delet shard key purg control purg null purg iter clear return null column reduc purg iter clear precompact row remov delet shard onli check top level delet time rang tombston column index tombston tracker note doesn work super column index builder tombston tracker delet reduc return null serial size reduc serial size tabl column min timestamp math min min timestamp reduc min timestamp max timestamp math max max timestamp reduc max timestamp int delet time reduc local delet time delet time integ tombston updat delet time return reduc 