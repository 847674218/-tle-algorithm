licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java nio byte buffer import java util collect import java util iter import java util sort map import java util sort set import java util tree map import googl common base function import org apach cassandra filter column slice import org apach cassandra index secondari index manag import org apach cassandra marshal abstract type import org apach cassandra util alloc public class tree map sort column extend abstract thread unsaf sort column implement sort column privat final tree map byte buffer column map public static final sort column factori factori factori public sort column creat abstract type compar boolean insert revers return tree map sort column compar public sort column sort sort map byte buffer column sort map boolean insert revers return tree map sort column sort map public static sort column factori factori return factori public abstract type compar return abstract type map compar privat tree map sort column abstract type compar map tree map byte buffer column compar privat tree map sort column sort map byte buffer column column map tree map byte buffer column column public sort column factori factori return factori public sort column clone return tree map sort column map public boolean insert revers return fals public void add column column column alloc alloc add column column alloc secondari index manag null updat find column resolv els add column public long add column column column alloc alloc secondari index manag updat index byte buffer column slight unusu structur natur shown thread safe sort column tree map lack put absent split put check follow save extra conflict case normal super column exchang put super column case column column map put column column null return column data size column instanceof super column assert column instanceof super column long previous size column data size sinc column accumul result usual faster add place map copi content map entri super column column put column super column column alloc map put column return column data size previous size els calcul reconcil col exist col col column reconcil column column reconcil column alloc map put reconcil column memtabl updat onli care oldcolumn reconciledcolumn compact updat index matter order merg reconcil column column index updat column reconcil column els index updat column reconcil column return reconcil column data size column data size public long add size delta sort column alloc alloc function column column transform secondari index manag updat index delet delet info column column sort column add column transform appli column alloc index don memtabl don bother comput size return long column column resolv befor ad public void add sort column alloc alloc function column column transform add size delta alloc transform secondari index manag null updat public boolean replac column column column column column equal column throw illeg argument suppos put column column column equal column coher implement optim common case column present column previous map put column column previous null map remov column return fals previous equal column map put column previous return fals return true public column column byte buffer return map public void remov column byte buffer map remov public void clear map clear public int size return map size public collect column sort column return map valu public collect column revers sort column return map descend map valu public sort set byte buffer column return map navig key set public iter column iter return map valu iter public iter column iter column slice slice return column slice navig map iter map slice public iter column revers iter column slice slice return column slice navig map iter map descend map slice 