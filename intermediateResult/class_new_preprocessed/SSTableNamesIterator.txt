licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra columniter import java import java nio byte buffer import java util import org apach cassandra config meta data import org apach cassandra column famili import org apach cassandra column famili serial import org apach cassandra decor key import org apach cassandra delet info import org apach cassandra column import org apach cassandra row index entri import org apach cassandra disk atom import org apach cassandra marshal abstract type import org apach cassandra sstabl corrupt tabl import org apach cassandra sstabl index helper import org apach cassandra sstabl tabl reader import org apach cassandra util file data input import org apach cassandra util file mark import org apach cassandra util file util import org apach cassandra util byte buffer util import org apach cassandra util filter public class tabl iter extend simpl abstract column iter implement tabl column iter privat column famili privat final tabl reader sstabl privat file data input file close privat iter disk atom iter public final sort set byte buffer column public final decor key key public tabl iter tabl reader sstabl decor key key sort set byte buffer column assert column null sstabl sstabl column column key key row index entri index entri sstabl posit key tabl reader oper index entri null return tri read sstabl null index entri catch sstabl mark suspect throw corrupt tabl sstabl filenam final file close null file util close quiet file close public tabl iter tabl reader sstabl file data input file decor key key sort set byte buffer column row index entri index entri assert column null sstabl sstabl column column key key tri read sstabl file index entri catch sstabl mark suspect throw corrupt tabl sstabl filenam privat file data input creat file data input long posit file close sstabl file data input posit return file close public tabl reader stabl return sstabl privat void read tabl reader sstabl file data input file row index entri index entri throw filter list index helper index info index list entri index index promot read row start index entri index file null file creat file data input index entri posit els file seek index entri posit decor key key disk tabl reader decod key sstabl partition sstabl descriptor byte buffer util read short length file assert key disk equal key string format key disk key file path tabl reader read row size file sstabl descriptor sstabl descriptor version promot index index entri index index entri bloom filter null index list index entri column index els assert file null index helper defreez bloom filter file sstabl descriptor version filter type index list index helper deseri index file index entri index stop earli bloom filter column actual exist stop befor initi abov case relev tombston column famili serial serial column famili serial tri column famili creat sstabl metadata delet delet info serial deseri tabl file sstabl descriptor version catch throw serial fail deseri sstabl column famili sstabl metadata file els column famili creat sstabl metadata delet index entri delet info list disk atom result array list disk atom list byte buffer filter column array list byte buffer column size byte buffer column null present filter column add filter column empti return index list empti read simpl column file column filter column result els long base posit sstabl descriptor version promot index base posit index entri posit els assert file null file read int column count base posit file file pointer read index column sstabl metadata file column filter column index list base posit result creat iter view column read iter result iter privat void read simpl column file data input file sort set byte buffer column list byte buffer filter column list disk atom result throw disk atom serial atom serial disk serial int column file read int int int column disk atom column atom serial deseri tabl file sstabl descriptor version column instanceof column column column result add column filter column size break els result add column privat void read index column meta data metadata file data input file sort set byte buffer column list byte buffer filter column list index helper index info index list long base posit list disk atom result throw column rang read abstract type compar metadata compar list index helper index info rang array list index helper index info int index idx byte buffer filter column int index index helper index index list compar fals index idx index index index list size continu index helper index info index info index list index check index block doe column haven insert block compar compar index info index index idx continu rang add index info index idx index rang empti return index helper index info index info rang long posit seek base posit index info offset promot index seek data file happen point file null file creat file data input posit seek disk atom serial atom serial disk serial file seek posit seek file mark mark file mark onli complet deseri column interest file byte mark mark index info width disk atom column atom serial deseri tabl file sstabl descriptor version check origin set filter list effici column instanceof column column column result add column public decor key key return key public column famili column famili return protect disk atom comput iter null iter return data return iter 