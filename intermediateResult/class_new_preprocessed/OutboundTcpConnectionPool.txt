licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra net import java import java net inet address import java net inet socket address import java net socket import java nio channel socket channel import org apach cassandra concurr stage import org apach cassandra config config import org apach cassandra config databas descriptor import org apach cassandra locat endpoint snitch import org apach cassandra metric connect metric import org apach cassandra secur factori import org apach cassandra util util public class outbound tcp connect pool privat final endpoint snitch snitch databas descriptor endpoint snitch pointer real address privat final inet address public final outbound tcp connect cmd con public final outbound tcp connect ack con pointer reset address privat inet address reset endpoint privat connect metric metric outbound tcp connect pool inet address remot remot cmd con outbound tcp connect cmd con start ack con outbound tcp connect ack con start metric connect metric return appropri connect base messag type return null connect establish outbound tcp connect connect messag msg stage stage msg stage return stage stage stage stage stage stage ack con cmd con void reset outbound tcp connect conn outbound tcp connect cmd con ack con conn close socket fals public void reset newer version int version outbound tcp connect conn outbound tcp connect cmd con ack con version conn target version conn soft close socket reconnect param remot current messag backlog exhaust multi region snitch forc node region communic privat param remot public void reset inet address remot reset endpoint remot outbound tcp connect conn outbound tcp connect cmd con ack con conn soft close socket releas previous metric creat reset address metric releas metric connect metric reset endpoint public long timeout return metric timeout count public long timeout return metric timeout public void increment timeout metric timeout mark public socket socket throw bind ani avail port encrypt channel config outbound bind ani return factori socket databas descriptor server encrypt option point databas descriptor storag port els return factori socket databas descriptor server encrypt option point databas descriptor storag port util local address els socket socket socket channel open inet socket address point databas descriptor storag port socket config outbound bind ani socket bound socket bind inet socket address util local address return socket inet address point return reset endpoint null reset endpoint boolean encrypt channel switch databas descriptor server encrypt option internod encrypt case return fals noth encrypt return immedi case break case snitch datacent equal snitch datacent util broadcast address return fals break case rack rack check snitch rack equal snitch rack util broadcast address snitch datacent equal snitch datacent util broadcast address return fals break return true public void close null guard simpli test ack con null ack con close socket true cmd con null cmd con close socket true metric releas 