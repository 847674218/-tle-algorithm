licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra servic import java byte array input stream import java data input stream import java file import java import java lang manag manag factori import java net inet address import java net unknown host import java nio byte buffer import java util import java util concurr import java util concurr atom atom integ import java util concurr atom atom long import javax manag bean server import javax manag notif import javax manag notif broadcast support import javax manag object import googl common collect import org apach log level import org apach common lang string util import org slf logger import org slf logger factori import org apach cassandra auth auth import org apach cassandra concurr debugg schedul thread pool executor import org apach cassandra concurr stage import org apach cassandra concurr stage manag import org apach cassandra config meta data import org apach cassandra config databas descriptor import org apach cassandra config meta data import org apach cassandra config schema import org apach cassandra import org apach cassandra tabl import org apach cassandra commitlog commit log import org apach cassandra dht import org apach cassandra dht rang import org apach cassandra configur import org apach cassandra invalid request import org apach cassandra unavail import org apach cassandra gms import org apach cassandra sstabl tabl delet task import org apach cassandra sstabl tabl loader import org apach cassandra util file util import org apach cassandra locat import org apach cassandra metric storag metric import org apach cassandra net async result import org apach cassandra net messag import org apach cassandra net messag servic import org apach cassandra net respons verb handler import org apach cassandra servic anti entropi servic tree request verb handler import org apach cassandra stream import org apach cassandra thrift constant import org apach cassandra thrift endpoint detail import org apach cassandra thrift token rang import org apach cassandra trace trace import org apach cassandra util import static googl common base charset abstract token identifi node identifi space token gossip class maintain histogram load inform node cluster public class storag servic extend notif broadcast support implement endpoint state chang subscrib storag servic bean privat static final logger logger logger factori logger storag servic class public static final int ring delay delay assum ring stabliz notif serial number counter privat final atom long notif serial number atom long privat static int ring delay string newdelay system properti cassandra ring delay newdelay null logger info overrid newdelay return integ pars int newdelay els return pool period short task public static final debugg schedul thread pool executor schedul task debugg schedul thread pool executor schedul task pool task longer execut time usual period public static final debugg schedul thread pool executor task debugg schedul thread pool executor period task task wait shutdown drain public static final debugg schedul thread pool executor option task debugg schedul thread pool executor option task static task set execut exist delay task shutdown polici fals abstract maintain token endpoint metadata inform privat token metadata token metadata token metadata public version valu version valu factori valu factori version valu version valu factori partition public static final storag servic instanc storag servic privat static final storag metric metric storag metric public static partition partition return databas descriptor partition public collect rang token local rang string tabl return rang endpoint tabl util broadcast address public collect rang token local primari rang return primari rang endpoint util broadcast address deprec public rang token local primari rang return primari rang endpoint util broadcast address sake local primari rang intern public list string primari rang return local primari rang list privat final set inet address replic node collect synchron set hash set inet address privat cassandra daemon daemon privat inet address remov node start node bootstrap mode privat boolean bootstrap mode bootstrap join ring told privat boolean survey mode boolean pars boolean system properti cassandra write survey fals intial client shouldn write system tabl privat boolean client mode privat boolean initi privat volatil boolean join fals probabl trace ani request disabl trace enabl privat doubl trace probabl privat static enum mode privat mode oper mode privat final migrat manag migrat manag migrat manag instanc track drain progress privat volatil int total remain privat static final atom integ repair command atom integ privat static schedul rang transfer executor servic rang xfer executor schedul rang transfer executor servic privat final list endpoint lifecycl subscrib lifecycl subscrib copi write array list endpoint lifecycl subscrib privat final object jmx object public void finish bootstrap bootstrap mode fals method updat local token disk public void set token collect token token logger debug enabl logger debug set token token system tabl updat token token token metadata updat normal token token util broadcast address order import gossip fire ad state send vice versa gossip instanc add local applic state applic state valu factori token local token gossip instanc add local applic state applic state valu factori normal local token set mode mode fals public storag servic bean server mbs manag factori platform bean server tri jmx object object org apach cassandra type storag servic mbs regist bean jmx object catch throw runtim regist verb handler messag servic instanc regist verb handler messag servic verb row mutat verb handler messag servic instanc regist verb handler messag servic verb read repair verb handler messag servic instanc regist verb handler messag servic verb read verb handler messag servic instanc regist verb handler messag servic verb rang slice verb handler messag servic instanc regist verb handler messag servic verb index scan verb handler messag servic instanc regist verb handler messag servic verb counter mutat verb handler messag servic instanc regist verb handler messag servic verb truncat verb handler boot strapper summari bootstrap verb interact messag servic instanc regist verb handler messag servic verb boot strapper bootstrap token verb handler messag servic instanc regist verb handler messag servic verb stream request verb handler messag servic instanc regist verb handler messag servic verb stream repli verb handler messag servic instanc regist verb handler messag servic verb replic finish verb handler messag servic instanc regist verb handler messag servic verb respons verb handler messag servic instanc regist verb handler messag servic verb respons verb handler messag servic instanc regist verb handler messag servic verb tree request verb handler messag servic instanc regist verb handler messag servic verb anti entropi servic tree respons verb handler messag servic instanc regist verb handler messag servic verb stream repair task stream repair request messag servic instanc regist verb handler messag servic verb stream repair task stream repair respons messag servic instanc regist verb handler messag servic verb gossip shutdown verb handler messag servic instanc regist verb handler messag servic verb gossip digest syn verb handler messag servic instanc regist verb handler messag servic verb gossip digest ack verb handler messag servic instanc regist verb handler messag servic verb gossip digest ack verb handler messag servic instanc regist verb handler messag servic verb definit updat verb handler messag servic instanc regist verb handler messag servic verb schema check verb handler messag servic instanc regist verb handler messag servic verb migrat request verb handler messag servic instanc regist verb handler messag servic verb snapshot verb handler spin stream servic avail jmx tool stream servic instanc null throw runtim stream servic unavail public void regist daemon cassandra daemon daemon daemon daemon public void regist endpoint lifecycl subscrib subscrib lifecycl subscrib add subscrib public void unregist endpoint lifecycl subscrib subscrib lifecycl subscrib remov subscrib onli call public void stop gossip initi logger warn stop gossip oper request gossip instanc stop initi fals onli call public void start gossip initi logger warn start gossip oper request gossip instanc start int system current time milli initi true onli call public void start server daemon null throw illeg state configur daemon daemon thrift server start public void stop server daemon null throw illeg state configur daemon daemon thrift server stop public boolean server run daemon null return fals return daemon thrift server run public void start nativ transport daemon null throw illeg state configur daemon daemon nativ server start public void stop nativ transport daemon null throw illeg state configur daemon daemon nativ server stop public boolean nativ transport run daemon null return fals return daemon nativ server run public void stop client gossip instanc unregist migrat manag gossip instanc unregist gossip instanc stop messag servic instanc shutdown give task accept befor messag servic shutdown submit stage avoid reject execut tri thread sleep catch interrupt stage manag shutdown public boolean initi return initi public synchron void init client throw configur init client public synchron void init client int delay throw configur initi client mode throw unsupport oper storag servic doe support switch mode return initi true client mode true logger info start client gossip set mode mode fals gossip instanc regist gossip instanc start int system current time milli node ring gather gossip instanc add local applic state applic state valu factori network version messag servic instanc listen util local address sleep gossip warm node befor repli tri thread sleep delay catch interrupt throw assert error public synchron void init server throw configur init server public synchron void init server int delay throw configur logger info cassandra version util releas version string logger info thrift version constant logger info support version string util join client state support version default client state initi client mode throw unsupport oper storag servic doe support switch mode return initi true client mode fals ensur storag proxi initi start tri class org apach cassandra servic storag proxi catch class throw assert error predictor instanc init boolean pars boolean system properti cassandra load ring state true logger info load persist ring state multimap inet address token load token system tabl load token map inet address load host id system tabl load host id inet address load token key set equal util broadcast address entri mistaken ad delet system tabl remov endpoint els token metadata updat normal token load token token metadata updat host load host id gossip instanc add save endpoint boolean pars boolean system properti cassandra renew counter fals logger info renew local node request counter renew local daemon thread executor continu run shutdown hook invok thread drain shutdown thread wrap runnabl overrid public void run throw throw execut interrupt executor servic mutat stage stage manag stage stage mutat stage shutdown return drain alreadi stop server option task shutdown gossip instanc stop progress write origin generat hint written shut messag servic befor mutat stage hint save befor shut messag servic instanc shutdown mutat stage shutdown mutat stage await termin time unit storag proxi instanc verifi hint progress list futur flush array list futur tabl tabl tabl meta data ksm schema instanc meta data tabl ksm durabl write column famili store cfs tabl column famili store flush add cfs forc flush util wait futur flush commit log instanc shutdown block wait miscellan task sstabl commitlog segment delet task shutdown task await termin time unit logger warn miscellan task executor busi minut proceed shutdown storag servic shutdown hook runtim runtim add shutdown hook drain shutdown boolean pars boolean system properti cassandra join ring true join token ring delay els logger info join ring request storag servic join ring initi ring join privat void join token ring int delay throw configur logger info start server gossip join true seed host endpoint map token metadata updat host system tabl local host util broadcast address start gossip servic befor ani info node necessari bootstrap load info won part storag ring add counter state map applic state version valu app state hash map applic state version valu app state put applic state valu factori network version app state put applic state valu factori host system tabl local host app state put applic state valu factori rpcaddress databas descriptor rpc address databas descriptor replac token size app state put applic state valu factori hibern true app state put applic state valu factori releas version gossip instanc regist gossip instanc regist migrat manag gossip instanc start system tabl increment generat app state node ring gather gossip snitch info local rack gossip snitch info gossip schema empti version forc immedi check schema updat migrat manag mayb schedul schema pull schema instanc updat version announc ensur actual schema prepar updat messag servic instanc listen util local address load broadcast instanc start broadcast hint hand manag instanc start batchlog manag instanc start bootstrap haven success bootstrap befor long seed seed user manual set auto bootstrap fals skip stream data node jump direct ring seed check skip sleep singl node cluster case user test attempt replac schema presenc check meaning sleep schema info gossip defeat purpos gori detail set inet address current hash set inet address collect token token logger debug bootstrap variabl object databas descriptor auto bootstrap system tabl bootstrap progress system tabl bootstrap complet databas descriptor seed util broadcast address databas descriptor auto bootstrap system tabl bootstrap complet databas descriptor seed util broadcast address system tabl bootstrap progress logger warn detect previous bootstrap failur retri els system tabl set bootstrap state system tabl bootstrap state set mode mode wait ring inform true sleep delay peer int delay schema proceed check direct schema instanc version equal schema empti version logger debug schema schema instanc version break tri thread sleep catch interrupt throw assert error schema hasn match sleep doe post don expect necessari veri doesn hurt care migrat manag readi bootstrap set mode mode wait schema inform complet true tri thread sleep catch interrupt throw assert error set mode mode schema complet readi bootstrap true logger debug enabl logger debug ring schema info databas descriptor replac token size token metadata member util broadcast address string node alreadi member token ring bootstrap abort replac dead node remov ring throw unsupport oper set mode mode bootstrap token true token boot strapper bootstrap token token metadata load broadcast instanc load info els tri sleep addit server actual aliv give time gossip aliv thread sleep load broadcast catch interrupt throw assert error token array list token string token databas descriptor replac token token add storag servic partition token factori string token check oper error token token token inet address exist token metadata endpoint token exist null gossip instanc endpoint state endpoint exist updat timestamp system current time milli delay throw unsupport oper cannnot replac token live node current add exist set mode mode replac node token token true bootstrap token assert bootstrap mode bootstrap block finish els token system tabl save token token empti collect string initi token databas descriptor initi token initi token size token boot strapper random token token metadata databas descriptor num token databas descriptor num token logger warn generat random token token random token result unbalanc ring http wiki apach org cassandra oper els logger info generat random token token token els token array list token string token initi token token add partition token factori string token logger info save token token configur els alreadi bootstrap token num token set higher config migrat multi token token size databas descriptor num token wait ring info logger info sleep ring delay delay tri thread sleep delay catch interrupt throw assert error logger info calcul token calcul num token token space rang left token token iter token metadata clone token metadata clone onli token map clone updat normal token util broadcast address token left clone predecessor num token token space token current token int tok tok databas descriptor num token tok token left token iter calcul locat token midpoint num iter number bit mantissa includ implicit lead stop earli termin fraction altern add interpol method partition doubl frac doubl tok doubl databas descriptor num token token midpoint partition midpoint int frac frac bug break els frac midpoint frac els midpoint midpoint partition midpoint token add midpoint logger info split previous rang left token els logger info save token token survey mode start particip ring system tabl set bootstrap state system tabl bootstrap state set token token remov exist info replac node current empti inet address exist current gossip instanc replac endpoint exist logger info startup complet serv read assert token metadata sort token size setup default superus auth setup superus els logger info startup complet write survey mode activ becom activ ring member storag servic join ring final ring join public void gossip snitch info endpoint snitch snitch databas descriptor endpoint snitch string snitch datacent util broadcast address string rack snitch rack util broadcast address gossip instanc add local applic state applic state storag servic instanc valu factori datacent gossip instanc add local applic state applic state storag servic instanc valu factori rack rack public synchron void join ring throw join logger info join ring oper request tri join token ring catch configur throw messag els survey mode set token system tabl save token system tabl set bootstrap state system tabl bootstrap state survey mode fals logger info leav write survey mode join ring oper request assert token metadata sort token size setup default superus auth setup superus public boolean join return join public void rebuild string sourc logger info rebuild sourc null ani sourc rang streamer streamer rang streamer token metadata util broadcast address oper type streamer add sourc filter rang streamer failur detector sourc filter failur detector instanc sourc null streamer add sourc filter rang streamer singl datacent filter databas descriptor endpoint snitch sourc string tabl schema instanc system tabl streamer add rang tabl local rang tabl streamer fetch public void set stream throughput sec int valu databas descriptor set stream throughput outbound megabit sec valu logger info setstreamthroughput throttl set valu public int stream throughput sec return databas descriptor stream throughput outbound megabit sec public int compact throughput sec return databas descriptor compact throughput sec public void set compact throughput sec int valu databas descriptor set compact throughput sec valu public boolean increment backup enabl return databas descriptor increment backup enabl public void set increment backup enabl boolean valu databas descriptor set increment backup enabl valu privat void set mode mode boolean log set mode null log privat void set mode mode string msg boolean log oper mode string log msg msg null string string format msg log logger info log msg els logger debug log msg privat void bootstrap collect token token bootstrap mode true system tabl updat token token set token part ring local incorrect bootstrap databas descriptor replac token size exist token bootstrap order import gossip fire ad state send vice versa gossip instanc add local applic state applic state valu factori token token gossip instanc add local applic state applic state valu factori bootstrap token set mode mode sleep pend rang setup true tri thread sleep catch interrupt throw assert error els dont set ani state node bootstrap exist token token metadata updat normal token token util broadcast address trace instanc set mode mode start bootstrap true boot strapper util broadcast address token token metadata bootstrap handl token updat logger info bootstrap complet token token public boolean bootstrap mode return bootstrap mode public token metadata token metadata return token metadata gossip sever event node public synchron boolean report sever doubl incr gossip instanc enabl return fals doubl updat sever util broadcast address incr version valu updat storag servic instanc valu factori sever updat gossip instanc add local applic state applic state updat return true public doubl sever inet address endpoint version valu event endpoint state state gossip instanc endpoint state endpoint endpoint state null event state applic state applic state null return doubl pars doubl event valu return keyspac return rang correspond listen address param keyspac return endpoint map public map list string list string rang endpoint map string keyspac rang token map list string list string map hash map list string list string map entri rang token list inet address entri rang address map keyspac entri set map put entri key list stringifi entri valu return map return rpc address associ endpoint string param endpoint endpoint rpc address return rpc address public string rpcaddress inet address endpoint endpoint equal util broadcast address return databas descriptor rpc address host address els gossip instanc endpoint state endpoint endpoint applic state applic state null return endpoint host address els return gossip instanc endpoint state endpoint endpoint applic state applic state valu keyspac return rang correspond address keyspac param keyspac return endpoint map public map list string list string rang rpcaddress map string keyspac rang token map list string list string map hash map list string list string map entri rang token list inet address entri rang address map keyspac entri set list string rpcaddr array list string entri valu size inet address endpoint entri valu rpcaddr add rpcaddress endpoint map put entri key list rpcaddr return map public map list string list string pend rang endpoint map string keyspac peopl visual represent null set system tabl keyspac null keyspac schema instanc system tabl map list string list string map hash map list string list string map entri rang token collect inet address entri token metadata pend rang keyspac entri set list inet address array list inet address entri valu map put entri key list stringifi return map public map rang token list inet address rang address map string keyspac peopl visual represent null set system tabl keyspac null keyspac schema instanc system tabl list rang token rang rang token metadata sort token return construct rang endpoint map keyspac rang code describ ring string convert token rang string compat param keyspac keyspac fetch inform return list token rang convert string keyspac public list string describ ring string keyspac throw list token rang token rang null tri token rang describ ring keyspac catch invalid request throw messag list string result array list string token rang size token rang token rang token rang result add token rang string return result token rang keyspac param keyspac keyspac fetch inform return list token rang keyspac throw invalid request ring inform avail keyspac public list token rang describ ring string keyspac throw invalid request keyspac null schema instanc system tabl keyspac throw invalid request ring keyspac keyspac list token rang rang array list token rang token token factori partition token factori map entri rang token list inet address entri rang address map keyspac entri set rang rang entri key list inet address address entri valu list string endpoint array list string address size list string rpc endpoint array list string address size list endpoint detail detail array list endpoint detail address size inet address endpoint address endpoint detail detail endpoint detail detail host endpoint host address detail datacent databas descriptor endpoint snitch datacent endpoint detail rack databas descriptor endpoint snitch rack endpoint endpoint add detail host rpc endpoint add rpcaddress endpoint detail add detail token rang token rang string rang left token string rang token endpoint set endpoint detail detail set rpc endpoint rpc endpoint rang add return rang public map string string token endpoint map map token inet address map inet address token metadata normal bootstrap token endpoint map order preserv token ascend order link hash map map string string map string link hash map string string map inet address size list token token array list token map inet address key set collect sort token token token token map string put token string map inet address token host address return map string public string local host return token metadata host util broadcast address string public map string string host map map string string map hash map string string map entri inet address entri token metadata endpoint host map read entri set map put entri key host address entri valu string return map construct rang endpoint map base true view world param rang return map rang replica respons privat map rang token list inet address construct rang endpoint map string keyspac list rang token rang map rang token list inet address rang endpoint map hash map rang token list inet address rang token rang rang rang endpoint map put rang tabl open keyspac replic strategi natur endpoint rang return rang endpoint map handl recept applic state endpoint note valu applic state necessarili chang sinc valu alreadi receiv updat somewher els chang onli applic state piec chang time mani applic state updat receiv time perform kind state machin concern event token associ endpoint oper mode node start bootstrap normal mode bootstrap mode chang mode normal node bootstrap mode pendingrang set token metadata node normal mode part token ring normal progress applic state valu node token bootstrap stay file receiv token readi serv read write token readi leav cluster part decommiss token set decommiss complet valu possibl anywher normal progress newtoken set node current move token ring src token src token src token set endpoint process reloc token deadtoken set node dead remov deadtoken set node dead remov note ani time node state chang visibl node follow bootstrap node dure removetoken decommiss move public void chang inet address endpoint applic state state version valu valu switch state case string state valu valu valu string piec state valu split version valu assert piec length string move piec move equal version valu handl state bootstrap endpoint piec els move equal version valu handl state normal endpoint piec els move equal version valu move equal version valu handl state remov endpoint piec els move equal version valu handl state leav endpoint piec els move equal version valu handl state left endpoint piec els move equal version valu handl state move endpoint piec els move equal version valu handl state reloc endpoint piec break case system tabl updat peer info endpoint releas version valu valu break case system tabl updat peer info endpoint data center valu valu break case system tabl updat peer info endpoint rack valu valu break case system tabl updat peer info endpoint rpc address valu valu break case system tabl updat peer info endpoint schema version valu valu break case system tabl updat peer info endpoint host valu valu break privat byte applic state valu inet address endpoint applic state appstat string vvalu gossip instanc endpoint state endpoint endpoint applic state appstat valu return vvalu byte privat collect token token inet address endpoint string piec gossip instanc vnode endpoint tri return token serial deseri partition data input stream byte array input stream applic state valu endpoint applic state catch throw runtim els return array list partition token factori string piec handl node bootstrap param endpoint bootstrap node param piec bootstrap token string privat void handl state bootstrap inet address endpoint string piec assert piec length pars version valu accord point version version version app state collect token token explicit check becaus bootstrap node bootstrap legaci mode vnode token specifi token token endpoint piec logger debug enabl logger debug node endpoint state bootstrap token token node present token metadata intermedi state node crash print warn clear obsolet stuff continu token metadata member endpoint leav fals howev leav true onli wait time complet leav oper rebootstrap relat short quit common time gossip spread therefor report onli log token metadata leav endpoint logger info node endpoint state jump bootstrap token metadata remov endpoint endpoint token metadata add bootstrap token token endpoint calcul pend rang gossip instanc host endpoint token metadata updat host gossip instanc host endpoint endpoint handl node move normal state node enter token ring particip read param endpoint node param piec token privat void handl state normal final inet address endpoint string piec assert piec length pars version valu accord point version version version app state collect token token token token endpoint piec logger debug enabl logger debug node endpoint state normal token token token metadata member endpoint logger info node endpoint state jump normal client mode endpoint lifecycl subscrib subscrib lifecycl subscrib subscrib endpoint els client mode endpoint lifecycl subscrib subscrib lifecycl subscrib subscrib join cluster endpoint order matter updat host call befor updat normal token gossip instanc host endpoint token metadata updat host gossip instanc host endpoint endpoint set token token updat metadata hash set token set token token updat system tabl hash set token set token local token remov hash set token set inet address endpoint remov hash set inet address multimap inet address token token copi token metadata endpoint token map read final token token token don updat node respons token startup time endpoint inet address current owner token metadata endpoint token current owner null logger debug node endpoint token token token updat metadata add token client mode token updat system tabl add token els endpoint equal current owner set state normal sinc node tri leav fail persist token chang token updat metadata add token els token metadata reloc token token metadata reloc rang token equal endpoint token reloc bookkeep offici token updat metadata add token client mode token updat system tabl add token option task schedul runnabl public void run logger info remov state endpoint token token metadata remov reloc token endpoint time unit token token remov system local current owner equal util broadcast address local token remov add token logger info token reloc token endpoint els token metadata reloc token logger info token reloc ignor updat object token token metadata reloc rang token endpoint els gossip instanc compar endpoint startup endpoint current owner token updat metadata add token client mode token updat system tabl add token current owner longer current endpoint track move becaus host longer ani token remov token copi current owner remov token token copi current owner size endpoint remov add current owner logger info string format node token owner endpoint current owner token endpoint logger debug enabl logger debug reloc rang token metadata print reloc rang els logger info string format node token ignor endpoint current owner token endpoint logger debug enabl logger debug reloc rang token metadata print reloc rang token metadata updat normal token token updat metadata endpoint inet address endpoint remov remov endpoint token updat system tabl empti system tabl updat token endpoint token updat system tabl local token remov empti system tabl updat local token collect token empti list local token remov token metadata move endpoint endpoint move token token metadata remov move endpoint client mode endpoint lifecycl subscrib subscrib lifecycl subscrib subscrib move endpoint calcul pend rang handl node prepar leav ring param endpoint node param piec token privat void handl state leav inet address endpoint string piec assert piec length collect token token token token endpoint piec logger debug enabl logger debug node endpoint state leav token token node previous unknown token match updat tokenmetadata node normal token befor leav pend rang token metadata member endpoint logger info node endpoint state jump leav token metadata updat normal token token endpoint els token metadata token endpoint token logger warn node endpoint leav token mismatch long network partit token metadata updat normal token token endpoint point endpoint member token proceed normal token metadata add leav endpoint endpoint calcul pend rang handl node leav ring happen node decommiss param endpoint reason leav decommiss endpoint leav node param piec token privat void handl state left inet address endpoint string piec assert piec length collect token token integ version messag servic instanc version endpoint token token endpoint piec logger debug enabl logger debug node endpoint state left token token excis token endpoint extract expir time piec version handl node move insid ring param endpoint move endpoint address param piec token privat void handl state move inet address endpoint string piec assert piec length token token partition token factori string piec logger debug enabl logger debug node endpoint state move token token token metadata add move endpoint token endpoint calcul pend rang handl rang token move respect endpoint anoth param endpoint destin move param piec token token privat void handl state reloc inet address endpoint string piec assert piec length list token token array list token piec length string str array copi rang piec piec length token add partition token factori string str logger debug token reloc token endpoint token metadata add reloc token token endpoint calcul pend rang handl notif node activ remov ring removetoken param endpoint node param piec node replica restor privat void handl state remov inet address endpoint string piec assert piec length endpoint equal util broadcast address logger info receiv remov token gossip node rejoin explicit removetoken tri drain catch throw runtim return token metadata member endpoint string state piec collect token remov token token metadata token endpoint version valu equal state excis remov token endpoint extract expir time piec messag servic instanc version endpoint els version valu equal state logger debug enabl logger debug token remov token remov manual endpoint endpoint note endpoint remov token metadata add leav endpoint endpoint calcul pend rang find endpoint coordin remov notifi string coordin gossip instanc endpoint state endpoint endpoint applic state applic state valu split version valu host string coordin grab ani data respons notifi respons node restor replica count endpoint token metadata endpoint host host els gossip told nonexist member notifi gossip remov remov endpoint endpoint privat void excis collect token token inet address endpoint logger info remov token token endpoint hint hand manag instanc delet hint endpoint endpoint remov endpoint endpoint token metadata remov endpoint endpoint token metadata remov bootstrap token token client mode endpoint lifecycl subscrib subscrib lifecycl subscrib subscrib leav cluster endpoint calcul pend rang privat void excis collect token token inet address endpoint long expir time add expir time endpoint expir time excis token endpoint unlik excis endpoint ani notif privat void remov endpoint inet address endpoint gossip instanc remov endpoint endpoint client mode system tabl remov endpoint endpoint protect void add expir time inet address endpoint long expir time expir time gossip instanc add expir time endpoint endpoint expir time protect long extract expir time string piec int version version messag servic piec length return long pars long piec els return els version valu equal piec return long pars long piec els return long pars long piec calcul pend rang accord bootsrap leav node reason doubt write node littl multipl node move calcul biggest rang node clean unneed data afterward write dure movement node leav rang node onli grow node addit rang lose ani current rang result leav therefor remov leav token sake calcul check rang node leav biggest possibl rang regard current leav oper cover subset possibl final rang valu node bootstrap rang node onli smaller complex calcul multipl bootstrap overlap simpli base calcul token ring befor reflect situat leav oper complet bootstrap node ad remov metadata check rang give biggest possibl rang node bootstrap actual final rang smaller doe matter clean data afterward heavi ineffect oper onli onc node chang state cluster manag privat void calcul pend rang string tabl schema instanc system tabl calcul pend rang tabl open tabl replic strategi tabl public static test purpos public static void calcul pend rang abstract replic strategi strategi string tabl token metadata storag servic instanc token metadata multimap rang token inet address pend rang hash multimap creat multi val map token inet address bootstrap token bootstrap token set inet address leav endpoint leav endpoint bootstrap token empti leav endpoint empti move endpoint empti reloc rang empti logger debug enabl logger debug bootstrap leav move node reloc token empti pend rang tabl set pend rang tabl pend rang return multimap inet address rang token address rang strategi address rang copi metadata reflect situat leav oper finish token metadata left metadata clone left rang affect leav node set rang token affect rang hash set rang token inet address endpoint leav endpoint affect rang add address rang endpoint rang find node respons rang leav node rang token rang affect rang set inet address current endpoint immut set copi strategi calcul natur endpoint rang clone onli token map set inet address endpoint immut set copi strategi calcul natur endpoint rang left metadata pend rang put rang set differ endpoint current endpoint stage pend rang updat accord leav oper continu calcul check bootstrap node bootstrap node simpli add remov left metadata check rang inet address endpoint bootstrap token invers key set collect token token bootstrap token invers endpoint left metadata updat normal token token endpoint rang token rang strategi address rang left metadata endpoint pend rang put rang endpoint left metadata remov endpoint endpoint stage pend rang updat accord leav bootstrap node finish calcul check move reloc node move node bootstrap simpli add remov left metadata check rang pair token inet address move move endpoint inet address endpoint move address move node move left token endpoint left metadata updat normal token move left endpoint rang token rang strategi address rang left metadata endpoint pend rang put rang endpoint left metadata remov endpoint endpoint rang reloc map entri token inet address reloc reloc rang entri set inet address endpoint reloc valu address move node token token reloc key left metadata updat normal token token endpoint rang token rang strategi address rang left metadata endpoint pend rang put rang endpoint left metadata remov endpoint endpoint set pend rang tabl pend rang logger debug enabl logger debug pend rang pend rang empti empti print pend rang find live endpoint respons rang param tabl tabl rang belong param rang rang find sourc return multimap address rang address respons privat multimap inet address rang token sourc rang string tabl set rang token rang inet address address util broadcast address multimap rang token inet address rang address tabl open tabl replic strategi rang address token metadata clone onli token map multimap inet address rang token sourc rang hash multimap creat failur detector failur detector failur detector instanc find aliv sourc rang rang token rang rang collect inet address possibl rang rang address rang endpoint snitch snitch databas descriptor endpoint snitch list inet address sourc snitch sort list proxim address possibl rang assert sourc address inet address sourc sourc failur detector aliv sourc sourc rang put sourc rang break return sourc rang send notif node indic finish replic data param remot node send notif privat void send replic notif inet address remot notifi remot token messag msg messag messag servic verb failur detector failur detector failur detector instanc logger debug enabl logger debug notifi remot string replic complet failur detector aliv remot async result iar messag servic instanc send msg remot tri iar databas descriptor rpc timeout time unit return catch timeout tri call endpoint remov ring function check node becom respons rang consequ stream data ineffect doe matter sinc call veri seldom param endpoint node left privat void restor replica count inet address endpoint final inet address notifi endpoint final multimap inet address string fetch sourc hash multimap creat multimap string map entri inet address collect rang token rang fetch hash multimap creat final inet address address util broadcast address string tabl schema instanc system tabl multimap rang token inet address chang rang chang rang leav tabl endpoint set rang token rang hash set rang token map entri rang token inet address entri chang rang entri entri valu equal address rang add entri key multimap inet address rang token sourc rang sourc rang tabl rang map entri inet address collect rang token entri sourc rang map entri set fetch sourc put entri key tabl rang fetch put tabl entri final string tabl rang fetch key set map entri inet address collect rang token entri rang fetch tabl final inet address sourc entri key collect rang token rang entri valu final stream callback callback stream callback public void success synchron fetch sourc fetch sourc remov sourc tabl fetch sourc empti send replic notif notifi endpoint public void failur logger warn stream sourc fail success call success send notif logger debug enabl logger debug request sourc rang string util join rang stream request rang sourc tabl rang callback oper type modifi accept tabl privat multimap rang token inet address chang rang leav string tabl inet address endpoint rang leav endpoint respons collect rang token rang rang endpoint tabl endpoint logger debug enabl logger debug node endpoint rang string util join rang map rang token list inet address current replica endpoint hash map rang token list inet address find rang node store replica rang rang token rang rang current replica endpoint put rang tabl open tabl replic strategi calcul natur endpoint rang token metadata clone onli token map token metadata temp token metadata clone left endpoint leav leav removetoken command present temp remov temp member endpoint temp remov endpoint endpoint multimap rang token inet address chang rang hash multimap creat rang rang check store replica rang leav endpoint present replica endpoint list current replica endpoint list rang rang token rang rang collect inet address replica endpoint tabl open tabl replic strategi calcul natur endpoint rang temp replica endpoint remov current replica endpoint rang logger debug enabl replica endpoint empti logger debug rang rang alreadi replica els logger debug rang rang respons string util join replica endpoint chang rang put rang replica endpoint return chang rang public void join inet address endpoint endpoint state state map entri applic state version valu entri state applic state map entri set chang endpoint entri key entri valu public void aliv inet address endpoint endpoint state state client mode token metadata member endpoint hint hand manag instanc schedul hint deliveri endpoint public void remov inet address endpoint token metadata remov endpoint endpoint calcul pend rang public void dead inet address endpoint endpoint state state messag servic instanc convict endpoint client mode endpoint lifecycl subscrib subscrib lifecycl subscrib subscrib endpoint public void restart inet address endpoint endpoint state state restart befor node mark reset connect pool state aliv dead endpoint state raw load valu public doubl load doubl byte string tabl schema instanc tabl tabl tabl tabl open tabl column famili store cfs tabl column famili store byte cfs live disk space return byte public string load string return file util stringifi file size load public map string string load map map string string map hash map string string map entri inet address doubl entri load broadcast instanc load info entri set map put entri key host address file util stringifi file size entri valu gossip doesn updat special case local node map put util broadcast address host address load string return map public final void deliv hint string host throw unknown host hint hand manag instanc schedul hint deliveri host public collect token local token collect token token system tabl save token assert token null token empti call befor init server set return token method belong bean interfac public list string token return token util broadcast address public list string token string endpoint throw unknown host return token inet address endpoint privat list string token inet address endpoint list string str token array list string token tok token metadata token endpoint str token add tok string return str token public string releas version return util releas version string public string schema version return schema instanc version string public list string leav node return stringifi token metadata leav endpoint public list string move node list string endpoint array list string pair token inet address node token metadata move endpoint endpoint add node host address return endpoint public list string join node return stringifi token metadata bootstrap token valu public list string live node return stringifi gossip instanc live member public list string unreach node return stringifi gossip instanc unreach member public string data file locat string locat databas descriptor data file locat int locat length locat file util canon path locat return locat public string commit log locat return file util canon path databas descriptor commit log locat public string save cach locat return file util canon path databas descriptor save cach locat privat list string stringifi iter inet address endpoint list string string endpoint array list string inet address endpoint string endpoint add host address return string endpoint public int current generat number return gossip instanc current generat number util broadcast address public void forc tabl cleanup string tabl string column famili throw execut interrupt tabl equal tabl throw runtim cleanup system tabl necessari wise counter shot renew counter renew counter shot renew column famili store store valid column famili tabl column famili store forc cleanup counter renew public void scrub string tabl string column famili throw execut interrupt column famili store store valid column famili tabl column famili store scrub public void upgrad tabl string tabl string column famili throw execut interrupt column famili store store valid column famili tabl column famili store sstabl rewrit public void forc tabl compact string tabl string column famili throw execut interrupt column famili store store valid column famili tabl column famili store forc major compact snapshot tabl snapshot specifi param tag tag snapshot null empti param tabl tabl snapshot empti public void snapshot string tag string tabl throw tag null tag equal throw suppli snapshot iter tabl tabl tabl length tabl tabl els array list tabl array list tabl tabl length string tabl tabl add valid tabl tabl tabl check snapshot exist befor actual snapshot tabl tabl tabl tabl snapshot exist tag throw snapshot tag alreadi exist tabl tabl tabl tabl snapshot tag null snapshot specif column famili snapshot specifi param tabl keyspac hold specifi column famili param column famili column famili snapshot param tag tag snapshot null empti public void column famili snapshot string tabl string column famili string tag throw tabl null throw suppli tabl column famili null throw mus suppli column famili tag null tag equal throw suppli snapshot tabl tabl valid tabl tabl tabl snapshot exist tag throw snapshot tag alreadi exist tabl snapshot tag column famili privat tabl valid tabl string tabl throw schema instanc tabl tabl throw tabl tabl doe exist return tabl open tabl remov snapshot tabl tag specifi remov snapshot public void clear snapshot string tag string tabl throw tag null tag iter tabl tabl tabl length tabl tabl els array list tabl temp tabl array list tabl tabl length string tabl tabl temp tabl add valid tabl tabl tabl temp tabl tabl tabl tabl tabl clear snapshot tag logger debug enabl logger debug clear snapshot directori public iter column famili store valid column famili string tabl string throw tabl tabl valid tabl tabl length store interest return tabl column famili store filter interest store set column famili store valid hash set column famili store string column famili store store tabl column famili store store null pass recogn keyspac report continu logger warn string format invalid column famili specifi proceed continu valid add store return valid flush memtabl tabl column famili param tabl param column famili throw public void forc tabl flush final string tabl final string column famili throw execut interrupt column famili store store valid column famili tabl column famili logger debug forc flush keyspac tabl store column famili store forc block flush send notif subscrib param type messag type param messag messag param user object arbitrari object attach notif public void send notif string type string messag object user object notif jmx notif notif type jmx object notif serial number increment messag jmx notif set user data user object send notif jmx notif public int forc repair async final string keyspac final boolean sequenti final boolean local final boolean primari rang final string column famili tabl equal keyspac trace equal keyspac auth equal keyspac return final int cmd repair command increment final collect rang token rang primari rang collect singleton list local primari rang local rang keyspac rang size thread creat repair task cmd keyspac rang sequenti local column famili start return cmd trigger proactiv repair tabl column famili param tabl param column famili throw public void forc tabl repair final string tabl boolean sequenti boolean local final string column famili throw forc tabl repair rang tabl local rang tabl sequenti local column famili public void forc tabl repair primari rang final string tabl boolean sequenti boolean local final string column famili throw forc tabl repair rang tabl local primari rang sequenti local column famili public void forc tabl repair rang string token string token final string tabl boolean sequenti boolean local final string column famili throw token pars token partition token factori string token token pars token partition token factori string token logger info start user request repair rang keyspac column famili pars token pars token tabl column famili forc tabl repair rang tabl collect singleton rang token pars token pars token sequenti local column famili public void forc tabl repair rang final string tabl final collect rang token rang boolean sequenti boolean local final string column famili throw tabl equal tabl trace equal tabl auth equal tabl return creat repair task repair command increment tabl rang sequenti local column famili run privat futur task object creat repair task final int cmd final string keyspac final collect rang token rang final boolean sequenti final boolean local final string column famili futur task object task futur task object wrap runnabl protect void run throw throw string messag string format start repair command repair rang keyspac cmd rang size keyspac logger info messag send notif repair messag int cmd anti entropi servic status ordin list anti entropi servic repair futur futur array list anti entropi servic repair futur rang size rang token rang rang anti entropi servic repair futur futur forc tabl repair rang keyspac sequenti local column famili futur null continu futur add futur wait session differenc befor start tri futur session differenc await catch interrupt messag interrupt wait differenc repair session futur session repair imprecis logger error messag send notif repair messag int cmd anti entropi servic status ordin anti entropi servic repair futur futur futur tri futur messag string format repair session rang finish futur session futur session rang string send notif repair messag int cmd anti entropi servic status ordin catch execut messag string format repair session rang fail error futur session futur session rang string caus messag logger error messag send notif repair messag int cmd anti entropi servic status ordin catch messag string format repair session rang fail error futur session futur session rang string messag logger error messag send notif repair messag int cmd anti entropi servic status ordin send notif repair string format repair command finish cmd int cmd anti entropi servic status ordin null return task public anti entropi servic repair futur forc tabl repair final rang token rang final string tabl boolean sequenti boolean local final string column famili throw array list string array list string column famili store store valid column famili tabl column famili add store column famili empti logger info column famili repair keyspac tabl return null return anti entropi servic instanc submit repair session rang tabl sequenti local array string size public void forc termin repair session anti entropi servic instanc termin session bean interfac method method return predecessor endpoint identifi space inet address predecessor token token return token metadata endpoint token metadata predecessor token method return successor endpoint identifi space public inet address successor token token return token metadata endpoint token metadata successor token primari rang specifi endpoint param endpoint interest return collect rang specifi endpoint public collect rang token primari rang endpoint inet address return token metadata primari rang token metadata token primari rang specifi endpoint param endpoint interest return rang specifi endpoint deprec public rang token primari rang endpoint inet address return token metadata primari rang token metadata token rang endpoint respons tabl param endpoint interest return rang specifi endpoint collect rang token rang endpoint string tabl inet address return tabl open tabl replic strategi address rang rang span ring set token rang sort order rang return rang sort order public list rang token rang list token sort token logger debug enabl logger debug comput rang string util join sort token sort token empti return collect empti list int size sort token size list rang token rang array list rang token size int size rang token rang rang token sort token sort token rang add rang rang token rang rang token sort token size sort token rang add rang return rang method return endpoint respons store specifi key replic param tabl keyspac tabl param column famili param key key find endpoint return endpoint respons key public list inet address natur endpoint string tabl string string key meta data meta data schema instanc tabl definit tabl meta data return natur endpoint tabl partition token meta data key valid string key public list inet address natur endpoint string tabl byte buffer key return natur endpoint tabl partition token key method return endpoint respons store specifi key replic param tabl keyspac tabl param pos posit find endpoint return endpoint respons token public list inet address natur endpoint string tabl ring posit pos return tabl open tabl replic strategi natur endpoint pos method attempt return endpoint respons store specifi key replic param tabl keyspac tabl param key key find endpoint return endpoint respons key public list inet address live natur endpoint tabl tabl byte buffer key return live natur endpoint tabl partition decor key key public list inet address live natur endpoint tabl tabl ring posit pos list inet address endpoint tabl replic strategi natur endpoint pos list inet address live ep array list inet address endpoint size inet address endpoint endpoint failur detector instanc aliv endpoint live ep add endpoint return live ep public void set log level string class qualifi string raw level level level level level raw level org apach log logger logger class qualifi set level level logger info set log level level class class qualifi level doesn raw level log couldn pars raw level return list token rang key togeth estim key count break data node respons piec rough key split public list pair rang token long split string tabl string rang token rang int key split tabl tabl open tabl column famili store cfs column famili store list decor key key key sampl collect singleton cfs rang final long total row count estim key size databas descriptor index interv split count smaller number key sampl avoid huge sampl error final int min sampl split final int max split count key size min sampl split final int split count math max math min max split count int total row count estim key split list token token key token rang key return split token split count privat list pair rang token long split list token token int split count final doubl step doubl token size split count int prev index token prev token token list pair rang token long split list array list expect size split count int split count int index int math step token token token index long row count estim index prev index databas descriptor index interv split add pair creat rang token prev token token row count estim prev index index prev token token return split privat list token key token rang token rang list decor key key list token token list array list expect size key size token add rang left decor key key key token add key token token add rang return token privat list decor key key sampl iter column famili store cfses rang token rang list decor key key array list decor key column famili store cfs cfses iter add key cfs key sampl rang util sort sampl key key rang return key return token node bootstrap node rang public token bootstrap token rang token rang local primari rang list decor key key key sampl column famili store user defin rang token token key size token partition midpoint rang left rang logger debug midpoint assign token token els token key key size token logger debug key sampl size key size assign token token token metadata endpoint token null token metadata member token metadata endpoint token throw runtim chose token token alreadi token metadata endpoint token specifi manual initi token hack prevent give node token fine row key token token instanceof string token token string token string token token replac version valu token metadata normal bootstrap token endpoint map key token throw runtim unabl comput uniqu token node specifi manual initi token return token broadcast leav status updat local token metadata accord privat void start leav gossip instanc add local applic state applic state valu factori leav local token token metadata add leav endpoint util broadcast address calcul pend rang public void decommiss throw interrupt token metadata member util broadcast address throw unsupport oper local node member token ring token metadata clone left sort token size throw unsupport oper normal node ring decommiss pointless string tabl schema instanc system tabl token metadata pend rang tabl util broadcast address size throw unsupport oper data current move node unabl leav ring logger debug enabl logger debug start leav set mode mode sleep pend rang setup true thread sleep runnabl finish leav runnabl public void run stop server gossip instanc stop messag servic instanc shutdown stage manag shutdown set mode mode true respons kill process unbootstrap finish leav privat void leav ring system tabl set bootstrap state system tabl bootstrap state token metadata remov endpoint util broadcast address calcul pend rang gossip instanc add local applic state applic state valu factori left local token gossip comput expir time int delay math max gossip interv milli logger info announc left ring delay tri thread sleep delay catch interrupt throw assert error privat void unbootstrap final runnabl finish map string multimap rang token inet address rang stream hash map string multimap rang token inet address final string tabl schema instanc system tabl multimap rang token inet address rang chang rang leav tabl util broadcast address logger debug enabl logger debug rang transfer string util join rang key set rang stream put tabl rang set mode mode stream data node true count latch latch stream rang rang stream count latch hint latch stream hint wait transfer runnabl signal latch logger debug wait stream ak tri latch await hint latch await catch interrupt throw runtim logger debug stream ack receiv leav ring finish run privat count latch stream hint hint hand manag instanc list endpoint pend hint size return count latch gather live node cluster aren leav list inet address candid array list inet address storag servic instanc token metadata clone left endpoint candid remov util broadcast address iter inet address iter candid iter iter inet address address iter failur detector instanc aliv address iter remov candid empti logger warn unabl stream hint sinc live endpoint return count latch els stream closest peer chosen snitch databas descriptor endpoint snitch sort proxim util broadcast address candid inet address hint destin host candid stream hint rang list singleton entir ring token token storag servic partition minimum token list rang token rang collect singleton list rang token token token count latch latch count latch stream transfer rang hint destin host tabl open tabl collect singleton list tabl open tabl column famili store system tabl rang count stream callback latch hint destin host oper type return latch public void move string token throw tri partition token factori valid token catch configur throw messag move partition token factori string token move node token find token boot accord load param token token boot null find balanc token boot throw ani oper error privat void move token token throw token null throw move undefin null token token metadata sort token token throw target token token alreadi anoth node address current node inet address local address util broadcast address doesn ani sens vnode environ token metadata token local address size logger error invalid request move token node token move thusli throw unsupport oper node token move thusli list string tabl process schema instanc system tabl check data move node string tabl tabl process token metadata pend rang tabl local address size throw unsupport oper data current move node unabl leav ring gossip instanc add local applic state applic state valu factori move token set mode mode string format move local address local token iter token true set mode mode string format sleep befor start stream fetch rang true tri thread sleep catch interrupt throw runtim sleep interrupt messag rang reloc reloc rang reloc collect singleton token tabl process reloc stream set mode mode fetch rang stream rang true reloc log stream map move count latch stream latch reloc stream reloc log request map move count latch fetch latch reloc request tri stream latch await fetch latch await catch interrupt throw runtim interrupt latch wait stream fetch rang finish messag els set mode mode rang fetch stream true set token collect singleton token set token everyth settl logger debug enabl logger debug success move token local token iter privat class rang reloc privat map string multimap inet address rang token rang fetch hash map string multimap inet address rang token privat map string multimap rang token inet address rang stream tabl hash map string multimap rang token inet address privat rang reloc collect token token list string tabl calcul stream token tabl privat void calcul stream collect token token list string tabl inet address local address util broadcast address endpoint snitch snitch databas descriptor endpoint snitch token metadata token meta clone settl token metadata clone settl clone avoid concurr modif calcul natur endpoint token metadata token meta clone token metadata clone onli token map string tabl tabl token token token replic strategi current keyspac aka tabl abstract replic strategi strategi tabl open tabl replic strategi collect current rang keyspac collect rang token current rang rang endpoint tabl local address collect rang node serv move token collect rang token updat rang strategi pend address rang token metadata token local address ring rang endpoint associ determin node ping rang data multimap rang token inet address rang address strategi rang address token meta clone calcul part rang request stream node ring pair set rang token set rang token rang tabl calcul stream fetch rang current rang updat rang loop rang fetch determin node ring respons data interest multimap rang token inet address rang fetch prefer endpoint array list multimap creat rang token fetch rang tabl rang token rang rang address key set rang fetch list inet address endpoint snitch sort list proxim local address rang address rang store rang prefer endpoint set rang fetch prefer endpoint put fetch endpoint calcul endpoint stream current rang situat node handl current rang part rang multimap rang token inet address rang endpoint hash multimap creat rang token stream rang tabl left set inet address current endpoint immut set copi strategi calcul natur endpoint stream token meta clone set inet address endpoint immut set copi strategi calcul natur endpoint stream token meta clone settl logger debug rang stream current endpoint current endpoint endpoint endpoint rang endpoint put stream set differ endpoint current endpoint associ tabl rang endpoint map rang stream tabl put tabl rang endpoint multimap inet address rang token work map rang streamer work map rang fetch prefer endpoint rang fetch put tabl work map logger debug enabl logger debug tabl work map tabl work map privat void log stream map string prefix logger debug work map prefix rang stream tabl privat void log request map string prefix logger debug work map prefix rang fetch privat boolean stream return rang stream tabl empti rang fetch empti privat count latch stream return stream rang rang stream tabl privat count latch request return request rang rang fetch public void reloc collect string src token throw list token token array list token src token size tri string src src token partition token factori valid src token add partition token factori string src catch configur throw messag reloc token token void reloc token collect token src token assert src token null inet address local address util broadcast address collect token local token token metadata token local address set token token hash set token src token iter token token iter token src local token src remov logger warn move sourc destin match src token size logger warn valid token argument specifi noth reloc gossip instanc add local applic state applic state valu factori reloc token set mode mode string format reloc token local address host address true list string tabl schema instanc system tabl set mode mode string format sleep befor start stream fetch rang true tri thread sleep catch interrupt throw runtim sleep interrupt messag rang reloc reloc rang reloc token tabl reloc stream set mode mode fetch rang stream rang true reloc log stream map reloc count latch stream latch reloc stream reloc log request map reloc count latch fetch latch reloc request tri stream latch await fetch latch await catch interrupt throw runtim interrupt latch wait stream fetch rang finish messag els set mode mode rang stream fetch true collect token current token system tabl updat local token token collect token empti list token metadata updat normal token current token util broadcast address gossip instanc add local applic state applic state valu factori token current token gossip instanc add local applic state applic state valu factori normal current token set mode mode fals status token remov public string remov status remov node null return token remov process return string format remov token wait replic confirm token metadata token remov node string util join replic node forc remov oper complet necessari remov oper block forev due node stream failur remov token call resort measur attempt restor replica public void forc remov complet replic node empti token metadata leav endpoint empti logger warn remov confirm string util join replic node inet address endpoint token metadata leav endpoint host token metadata host endpoint gossip instanc advertis token remov endpoint host excis token metadata token endpoint endpoint replic node clear remov node null els throw unsupport oper token forc remov call removetoken remov node die attempt restor replica count node aliv decommiss attempt decommiss fail remov token call fail tri restor replica count final forc remov completeion call forcibl remov node regard replica count param host string token node public void remov node string host string inet address address util broadcast address local host token metadata host address host string host string inet address endpoint token metadata endpoint host host endpoint null throw unsupport oper host collect token token token metadata token endpoint endpoint equal address throw unsupport oper remov gossip instanc live member endpoint throw unsupport oper node endpoint aliv decommiss command remov ring leav endpoint dead alreadi remov token metadata leav endpoint logger warn node endpoint alreadi remov continu remov replic node empti throw unsupport oper node alreadi process remov wait complet removetoken forc fail find endpoint becom respons data string tabl schema instanc system tabl replic factor data lost shouldn wait confirm tabl open tabl replic strategi replic factor continu rang chang ownership node respons rang multimap rang token inet address chang rang chang rang leav tabl endpoint failur detector failur detector failur detector instanc inet address chang rang valu failur detector aliv replic node add els logger warn endpoint receiv data replic endpoint remov node endpoint token metadata add leav endpoint endpoint calcul pend rang gossip handl spoof node state add token node gossip instanc advertis remov endpoint host local host kick stream command restor replica count endpoint address wait replic finish verb handler signal replic node empti tri thread sleep catch interrupt throw assert error excis token endpoint gossip indic token left gossip instanc advertis token remov endpoint host replic node clear remov node null public void confirm replic inet address node replic node empti case node remov coordin restart befor replic finish messag arriv case acknowledg replic node empti replic node remov node els logger info receiv unexpect messag node node remov coordin public boolean client mode return client mode public synchron void request unreclaim space logger info request free disk space system tri thread sleep catch interrupt throw assert error privat boolean unreclaim space column famili store cfs column famili store cfs unreclaim space return true return fals public string oper mode return oper mode string public string drain progress return string format drain column famili remain total shut node write empti memtabl commit log differ drain normal shutdown hook drain wait progress stream complet drain flush columnfamili shutdown hook onli flush durabl public synchron void drain throw interrupt execut executor servic mutat stage stage manag stage stage mutat stage termin logger warn drain node alreadi happen return set mode mode start drain process true stop server option task shutdown gossip instanc stop set mode mode shut messag servic fals messag servic instanc shutdown set mode mode wait stream fals messag servic instanc wait stream set mode mode clear mutat stage fals mutat stage shutdown mutat stage await termin time unit storag proxi instanc verifi hint progress set mode mode flush column famili fals count sinc forc flush block flush writer queue slot empti total tabl tabl tabl system total tabl column famili store size remain total flush list futur flush array list futur tabl tabl tabl system column famili store cfs tabl column famili store flush add cfs forc flush wait flush godaw track progress sinc flush parallel long sever short instant wait futur flush util wait futur remain flush system rest case flush modifi ani system state don bother progress track sinc system data tini flush clear tabl tabl tabl system column famili store cfs tabl column famili store flush add cfs forc flush util wait futur flush column famili store post flush executor shutdown column famili store post flush executor await termin time unit commit log instanc shutdown block wait miscellan task sstabl commitlog segment delet task shutdown task await termin time unit logger warn miscellan task executor busi minut proceed shutdown set mode mode true home test partition set partition unsaf partition partition partition partition databas descriptor partition databas descriptor set partition partition valu factori version valu version valu factori partition return partition token metadata set token metadata unsaf token metadata tmd token metadata token metadata token metadata tmd return public void truncat string keyspac string column famili throw timeout tri storag proxi truncat block keyspac column famili catch unavail throw messag public map inet address float ownership list token sort token token metadata sort token describ ownership return token unspecifi order order map token float token map tree map token float partition describ ownership sort token map inet address float node map link hash map inet address float map entri token float entri token map entri set inet address endpoint token metadata endpoint entri key float token ownership entri valu node map key endpoint node map put endpoint node map endpoint token ownership els node map put endpoint token ownership return node map calcul ownership multipl replic strategi awar ownership calcul total ring ownership divid node replic total ownership multipl number valu depend number replica unawar replic strategi ownership replic throw illeg state node configur proper public link hash map inet address float effect ownership string keyspac throw illeg state schema instanc system tabl size throw illeg state couldn find ani system keyspac infer replic topolog keyspac null replic schema instanc system tabl throw illeg state system keyspac doesnt topolog token metadata metadata token metadata clone onli token map keyspac null keyspac schema instanc system tabl collect collect inet address endpoint group array list collect inet address map node sort map dcs sort sort map string collect inet address sort dcs endpoint tree map string collect inet address sort dcs endpoint put metadata topolog datacent endpoint map collect inet address endpoint sort dcs endpoint valu endpoint group add endpoint map token float token ownership partition describ ownership token metadata sort token link hash map inet address float final ownership map link hash map calcul ownership collect inet address endpoint endpoint group calcul ownership replic add endpoint final ownership map inet address endpoint endpoint float ownership rang token rang rang endpoint keyspac endpoint token ownership key rang ownership token ownership rang final ownership put endpoint ownership return final ownership privat boolean replic list string list list empti return fals int list size meta data ksm schema instanc meta data list meta data ksm schema instanc meta data list ksm strategi class equal ksm strategi class iter element equal ksm strategi option entri set iter ksm strategi option entri set iter return fals return true public list string keyspac list string tableslist array list string schema instanc tabl return collect unmodifi list tableslist public void updat snitch string snitch class boolean dynam integ dynam updat interv integ dynam reset interv doubl dynam bad threshold throw class endpoint snitch snitch databas descriptor endpoint snitch snitch regist mbean dure construct endpoint snitch snitch null tri snitch util construct snitch class snitch catch configur throw class messag dynam databas descriptor set dynam updat interv dynam updat interv databas descriptor set dynam reset interv dynam reset interv databas descriptor set dynam bad threshold dynam bad threshold snitch dynam endpoint snitch snitch point snitch refer instanc databas descriptor set endpoint snitch snitch string schema instanc tabl tabl open replic strategi snitch snitch snitch instanceof dynam endpoint snitch dynam endpoint snitch snitch unregist bean flush largest memtabl op throughput public void flush largest memtabl column famili store largest null column famili store cfs column famili store long total cfs total memtabl live size total largest null total largest total memtabl live size logger debug total estim memtabl size cfs largest cfs largest null logger info unabl reduc heap usag sinc dirti column famili return logger warn flush largest reliev memori pressur largest forc flush seed data endpoint respons futur param rang stream tabl tabl data rang endpoint includ return latch count privat count latch stream rang final map string multimap rang token inet address rang stream tabl build list rang stream host tabl final map string map inet address list rang token session stream tabl hash map string map inet address list rang token number stream session start built build session stream tabl int session count map entri string multimap rang token inet address entri rang stream tabl entri set multimap rang token inet address rang endpoint entri valu rang endpoint empti continu final string tabl entri key map inet address list rang token rang endpoint hash map inet address list rang token final map entri rang token inet address point entri rang endpoint entri final rang token rang point entri key final inet address endpoint point entri valu list rang token cur rang rang endpoint endpoint cur rang null cur rang link list rang token rang endpoint put endpoint cur rang cur rang add rang session count rang endpoint size session stream tabl put tabl rang endpoint final count latch latch count latch session count map entri string map inet address list rang token entri session stream tabl entri set final string tabl entri key final map inet address list rang token rang endpoint entri valu final map entri inet address list rang token rang entri rang endpoint entri set final list rang token rang rang entri valu final inet address endpoint rang entri key call transfer rang flush potenti lot wast stream transfer rang endpoint tabl open tabl rang count stream callback latch endpoint oper type return latch class count stream callback implement stream callback privat final count latch latch privat final inet address target addr count stream callback count latch latch inet address target addr latch latch target addr target addr public void success latch count public void failur logger warn stream target addr fail success call success latch countdown request rang endpoint ring block data fetch readi param rang rang fetch map prefer address rang collect return latch count privat count latch request rang final map string multimap inet address rang token rang final count latch latch count latch rang key set size map entri string multimap inet address rang token entri rang entri set multimap inet address rang token endpoint rang entri valu endpoint rang empti latch count continu final string tabl entri key final set inet address pend hash set inet address endpoint rang key set send messag respect folk stream data final inet address sourc endpoint rang key set collect rang token fetch endpoint rang sourc final stream callback callback stream callback public void success pend remov sourc pend empti latch count public void failur logger warn stream sourc fail success call success latch countdown logger debug enabl logger debug request sourc rang string util join fetch send actual request stream request rang sourc tabl fetch callback oper type return latch calcul pair rang stream fetch rang collect current rang tabl rang move token param current collect rang current token param updat collect rang token chang return pair rang stream fetch current updat rang collect public pair set rang token set rang token calcul stream fetch rang collect rang token current collect rang token updat set rang token stream hash set rang token set rang token fetch hash set rang token rang current boolean intersect fals rang updat intersect ad differ rang fetch ring stream add subtract intersect true intersect stream add seed rang rang updat boolean intersect fals rang current intersect ad differ rang fetch ring fetch add subtract intersect true intersect fetch add fetch rang return pair creat stream fetch public void bulk load string directori file dir file directori dir exist dir directori throw illeg argument invalid directori directori tabl loader client client tabl loader client overrid public void init string keyspac tri set partition databas descriptor partition map entri rang token list inet address entri storag servic instanc rang address map keyspac entri set rang token rang entri key inet address endpoint entri valu add rang endpoint rang endpoint catch throw runtim overrid public boolean valid column famili string keyspac string return schema instanc meta data keyspac null tabl loader loader tabl loader dir client output handler log output tri loader stream catch throw runtim public int count return cassandra daemon public void reschedul fail delet tabl delet task reschedul fail task inherit doc public void load tabl string string column famili store load tabl inherit doc public list string sampl key rang renam getter detail list decor key key array list decor key rang token rang local primari rang key add key sampl column famili store user defin rang list string sampl key array list string key size decor key key key sampl key add key token string return sampl key public void rebuild secondari index string string string idx column famili store rebuild secondari index idx public void reset local schema throw migrat manag reset local schema public void set trace probabl doubl probabl trace probabl probabl public doubl trace probabl return trace probabl public void enabl schedul rang xfer rang xfer executor setup public void disabl schedul rang xfer rang xfer executor tear 