licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java data input import java data output import java import java nio byte buffer import java secur messag digest import java util import org apach cassandra config meta data import org apach cassandra marshal abstract type import org apach cassandra marshal marshal import org apach cassandra tabl serial import org apach cassandra sstabl descriptor import org apach cassandra util data output buffer import org apach cassandra util byte buffer util import org apach cassandra util interv public class rang tombston extend interv byte buffer delet time implement disk atom public static final serial serial serial public rang tombston byte buffer start byte buffer stop long mark delet int local delet time start stop delet time mark delet local delet time public rang tombston byte buffer start byte buffer stop delet time del time super start stop del time public byte buffer return min public int local delet time return data local delet time public long min timestamp return data mark delet public long max timestamp return data mark delet public int serial size type size type size throw unsupport oper public long serial size tabl type size type size type size return type size sizeof short min remain min remain serial flag type size sizeof short max remain max remain delet time serial serial size data type size public void valid field meta data metadata throw marshal abstract type valid metadata type column famili type super metadata subcolumn compar metadata compar valid valid min valid valid max public void updat digest messag digest digest digest updat min duplic digest updat max duplic data output buffer buffer data output buffer tri buffer write long data mark delet buffer write int data local delet time catch throw runtim digest updat buffer data buffer length tombston supersed anoth cover bigger rang public boolean supersed rang tombston compar byte buffer compar data mark delet data mark delet return fals return compar compar min min compar compar max max public static class tracker privat final compar byte buffer compar privat final dequ rang tombston rang array dequ rang tombston privat final sort set rang tombston max order set tree set rang tombston compar rang tombston public int compar rang tombston rang tombston return compar compar max max privat int atom count public tracker compar byte buffer compar compar compar comput rang tombston index block start code column return total serial size tombston write code isn null public long write open marker disk atom column data output disk atom serial atom serial throw long size rang empti return size comput marker written block write open tombston part rang list rang tombston write link list rang tombston outer rang tombston tombston rang column outsid rang skip case updat hasn call compar compar column tombston max continu rang tombston updat rang tombston column tombston max tombston data iter rang tombston iter write iter iter rang tombston iter supersed updat compar break outer updat supersed compar iter remov write add tombston rang tombston tombston write size tombston serial size tabl atom count null atom serial serial tabl tombston return size public int written atom return atom count updat tracker code atom column column check ani track rang useless remov rang tombston add tracker public void updat disk atom atom atom instanceof rang tombston rang tombston rang tombston atom repeat marker alreadi alreadi rang fulli includ functionali lot useless marker compact avoid rang tombston tombston max order set tail set onli care tombston max compar compar max tombston max break sinc assum tombston pass method grow min order check data current tombston includ previous tombston data equal data return rang add max order set add els assert atom instanceof column iter rang tombston iter max order set iter iter rang tombston tombston iter compar compar atom tombston max tombston useless iter remov rang remov tombston els sinc iter grow bound current rang includ column doe return public boolean delet column column rang tombston tombston rang compar compar column tombston max tombston data delet column return true return fals public static class serial implement tabl serial rang tombston public void serial tabl rang tombston data output dos throw byte buffer util write short length min dos dos write byte column serial byte buffer util write short length max dos delet time serial serial data dos public rang tombston deseri tabl data input dis descriptor version version throw byte buffer min byte buffer util read short length dis min remain throw column serial corrupt column creat dis min int dis read unsign byte assert column serial return deseri bodi dis min version public rang tombston deseri bodi data input dis byte buffer min descriptor version version throw byte buffer max byte buffer util read short length dis max remain throw column serial corrupt column creat dis max delet time delet time serial deseri dis return rang tombston min max 