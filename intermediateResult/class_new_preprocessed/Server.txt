licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra transport import java import java net inet address import java net inet socket address import java net unknown host import java util enum map import java util concurr executor import java util concurr atom atom boolean import javax net ssl context import javax net ssl engin import org slf logger import org slf logger factori import org apach cassandra config databas descriptor import org apach cassandra config encrypt option import org apach cassandra secur factori import org apach cassandra servic cassandra daemon import org apach cassandra servic endpoint lifecycl subscrib import org apach cassandra servic migrat listen import org apach cassandra servic migrat manag import org apach cassandra servic storag servic import org apach cassandra transport messag event messag import org jboss netti bootstrap server bootstrap import org jboss netti channel channel import org jboss netti channel channel factori import org jboss netti channel channel pipelin import org jboss netti channel channel pipelin factori import org jboss netti channel channel import org jboss netti channel group channel group import org jboss netti channel group default channel group import org jboss netti channel socket nio nio server socket channel factori import org jboss netti handler execut execut handler import org jboss netti handler ssl ssl handler import org jboss netti log intern logger factori import org jboss netti log slf logger factori public class server implement cassandra daemon server static intern logger factori set default factori slf logger factori privat static final logger logger logger factori logger server class privat final connect tracker connect tracker connect tracker public final inet socket address socket privat final atom boolean run atom boolean fals privat channel factori factori privat execut handler execut handler public server inet socket address socket socket socket event notifi notifi event notifi storag servic instanc regist notifi migrat manag instanc regist notifi public server string hostnam int port inet socket address hostnam port public server inet address host int port inet socket address host port public server int port inet socket address port public void start run compar set fals true run public void stop run compar set true fals close public boolean run return run public void run configur server execut handler execut handler request thread pool executor factori nio server socket channel factori executor cach thread pool executor cach thread pool server bootstrap bootstrap server bootstrap factori bootstrap set option child tcp delay true set event pipelin factori final encrypt option client encrypt option client enc databas descriptor client encrypt option client enc enabl logger info enabl encrypt connect client server bootstrap set pipelin factori secur pipelin factori client enc els bootstrap set pipelin factori pipelin factori bind start accept incom connect logger info start listen client socket channel channel bootstrap bind socket connect tracker channel add channel public void close close open connect connect tracker close factori releas extern resourc factori null execut handler releas extern resourc execut handler null public static class connect tracker implement connect tracker public final channel group channel default channel group privat final enum map event type channel group group enum map event type channel group event type class public connect tracker event type type event type valu group put type default channel group type string public void add connect channel connect connect channel add public void regist event type type channel group type add public void unregist channel channel group group group valu group remov public void send event event group event type write event messag event public void close channel close await uninterrupt privat static class pipelin factori implement channel pipelin factori stateless handler privat static final messag protocol decod messag decod messag protocol decod privat static final messag protocol encod messag encod messag protocol encod privat static final frame decompressor frame decompressor frame decompressor privat static final frame compressor frame compressor frame compressor privat static final frame encod frame encod frame encod privat static final messag dispatch dispatch messag dispatch privat final server server public pipelin factori server server server server public channel pipelin pipelin throw channel pipelin pipelin channel pipelin pipelin add debug log handler pipelin add frame decod frame decod server connect tracker server connect pipelin add frame encod frame encod pipelin add frame decompressor frame decompressor pipelin add frame compressor frame compressor pipelin add messag decod messag decod pipelin add messag encod messag encod pipelin add executor server execut handler pipelin add dispatch dispatch return pipelin privat static class secur pipelin factori extend pipelin factori privat final context ssl context privat final encrypt option encrypt option public secur pipelin factori server server encrypt option encrypt option super server encrypt option encrypt option tri ssl context factori creat context encrypt option fals catch throw runtim fail setup secur pipelin public channel pipelin pipelin throw engin ssl engin ssl context creat engin ssl engin set client mode fals ssl engin set enabl cipher suit encrypt option cipher suit ssl engin set client auth encrypt option requir client auth ssl handler ssl handler ssl handler ssl engin ssl handler set issu handshak true channel pipelin pipelin super pipelin pipelin add ssl ssl handler return pipelin privat static class event notifi implement endpoint lifecycl subscrib migrat listen privat final server server privat event notifi server server server server privat inet address rpc address inet address endpoint tri return inet address storag servic instanc rpcaddress endpoint catch unknown host happen log error return endpoint address sinc good chang logger error problem retriev address endpoint return endpoint public void join cluster inet address endpoint server connect tracker send event topolog chang node rpc address endpoint server socket port public void leav cluster inet address endpoint server connect tracker send event topolog chang remov node rpc address endpoint server socket port public void move inet address endpoint server connect tracker send event topolog chang move node rpc address endpoint server socket port public void inet address endpoint server connect tracker send event status chang node rpc address endpoint server socket port public void inet address endpoint server connect tracker send event status chang node rpc address endpoint server socket port public void creat keyspac string server connect tracker send event schema chang event schema chang chang public void creat column fam string string server connect tracker send event schema chang event schema chang chang public void updat keyspac string server connect tracker send event schema chang event schema chang chang public void updat column fam string string server connect tracker send event schema chang event schema chang chang public void drop keyspac string server connect tracker send event schema chang event schema chang chang public void drop column fam string string server connect tracker send event schema chang event schema chang chang 