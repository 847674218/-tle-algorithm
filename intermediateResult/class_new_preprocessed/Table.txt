licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra import java file import java import java nio byte buffer import java util import java util concurr concurr hash map import java util concurr concurr map import java util concurr execut import java util concurr futur import java util concurr lock reentrant read write lock import googl common base function import googl common collect iter import org slf logger import org slf logger factori import org apach cassandra config import org apach cassandra commitlog commit log import org apach cassandra filter column slice import org apach cassandra filter queri filter import org apach cassandra index secondari index import org apach cassandra index secondari index manag import org apach cassandra configur import org apach cassandra sstabl tabl reader import org apach cassandra locat abstract replic strategi import org apach cassandra servic storag servic import org apach cassandra trace trace repres keyspac public class tabl public static final string system privat static final logger logger logger factori logger tabl class access memtabl acquir thread safeti mayb switch memtabl aquir write lock method full explan enabl fair observ decreas throughput leav public static final reentrant read write lock switch lock reentrant read write lock possibl call tabl open run daemon sens ensur proper directori cassandra daemon static storag servic instanc client mode databas descriptor creat directori tabl public final string column famili store column famili privat final concurr map column famili store column famili store concurr hash map column famili store privat final object index lock privat volatil abstract replic strategi replic strategi public static final function string tabl tabl transform function string tabl public tabl appli string tabl return tabl open tabl public static tabl open string tabl return open tabl schema instanc true public static tabl open tabl string tabl return open tabl schema instanc fals privat static tabl open string tabl schema schema boolean load tabl tabl tabl instanc schema tabl instanc tabl tabl instanc null instanti tabl put absent import onli onc keyspac synchron check befor synchron tabl class tabl instanc schema tabl instanc tabl tabl instanc null open store tabl tabl instanc tabl tabl load tabl schema store tabl instanc tabl instanc tabl construct cach befor cach row call column famili store cfs tabl instanc column famili store cfs init row cach return tabl instanc public static tabl clear string tabl throw return clear tabl schema instanc public static tabl clear string tabl schema schema throw synchron tabl class tabl schema remov tabl instanc tabl null column famili store cfs column famili store unload cfs return remov everi tabl directori appropri data tracker view param directori unread directori possibl tabl necessarili public static void remov unread tabl file directori tabl tabl tabl column famili store base cfs tabl column famili store column famili store cfs base cfs concat index cfs mayb remov unread tabl directori public collect column famili store column famili store return collect unmodifi collect column famili store valu public column famili store column famili store string schema instanc null throw illeg argument string format unknown tabl pair return column famili store public column famili store column famili store column famili store cfs column famili store cfs null throw illeg argument unknown return cfs snapshot specif column famili entir set column famili column famili null timestamp param snapshot tag associ snapshot valu null param column famili column famili snapshot null throw column famili doesn exist public void snapshot string snapshot string column famili throw assert snapshot null boolean snap shot fals column famili store store column famili store valu column famili null store column famili equal column famili snap shot true store snapshot snapshot column famili null snap shot throw fail snapshot column famili column famili doe exist param client suppli null return snapshot public static string timestamp snapshot string client suppli string snapshot long string system current time milli client suppli null client suppli equal snapshot snapshot client suppli return snapshot check snapshot alreadi exist param snapshot user suppli snapshot return true snapshot exist public boolean snapshot exist string snapshot assert snapshot null column famili store store column famili store valu store snapshot exist snapshot return true return fals clear snapshot tabl param snapshot user suppli snapshot empti null snapshot clean public void clear snapshot string snapshot column famili store store column famili store valu store clear snapshot snapshot return list open tabl reader public list tabl reader tabl list tabl reader list array list tabl reader column famili store size column famili store store column famili store valu list add store tabl return list privat tabl string tabl boolean load tabl tabl meta data ksm schema instanc meta data tabl assert ksm null unknown keyspac tabl tri creat replic strategi ksm catch configur throw runtim index lock object databas descriptor concurr writer int index lock length index lock object meta data cfm array list meta data schema instanc tabl definit tabl meta data valu logger debug initi cfm init cfm cfm load tabl public void creat replic strategi meta data ksm throw configur replic strategi null storag servic instanc token metadata unregist replic strategi replic strategi abstract replic strategi creat replic strategi ksm ksm strategi class storag servic instanc token metadata databas descriptor endpoint snitch ksm strategi option invok compact manang public void drop throw assert column famili store key column famili store cfs column famili store remov cfs null return unload cfs disassoci cfs tabl instanc privat void unload column famili store cfs throw tri cfs forc block flush catch execut throw catch interrupt throw cfs invalid add intern structur creat disk file public void init string boolean load tabl column famili store cfs column famili store cfs null creat time server startup ad don worri race startup safe ad multipl identi simultan don scenario column famili store cfs column famili store put absent column famili store creat column famili store load tabl mbean instanti error befor hit case chang cfs null throw illeg state ad multipl map els initi exist happen clear schema node repopul rest cluster assert cfs column famili equal cfs metadata reload cfs reload public row row queri filter filter column famili store store column famili store filter column famili column famili column famili store column famili filter return row filter key column famili public void appli row mutat mutat boolean write commit log appli mutat write commit log true method append row global commit log updat memtabl index param mutat row write modifi call appli sinc commitlog append happen concurr depend executor type param write commit log fals disabl commitlog append entir param updat index fals disabl index updat collat control defrag public void appli row mutat mutat boolean write commit log boolean updat index mutat tabl equal trace trace trace acquir switch lock read lock write mutat commitlog memtabl switch lock read lock lock tri write commit log trace trace append commitlog commit log instanc add mutat decor key key storag servic partition decor key mutat key column famili mutat column famili column famili store cfs column famili store cfs null logger error attempt mutat exist column famili continu trace trace ad memtabl metadata cfs appli key updat index cfs index manag updat key true secondari index manag null updat final switch lock read lock unlock public abstract replic strategi replic strategi return replic strategi param key row index param cfs column famili index row param idx column index compar order public static void index row decor key key column famili store cfs set string idx logger debug enabl logger debug index row cfs metadata key valid string key key collect secondari index index cfs index manag index idx switch lock read lock lock tri index lock row don hold write long larg row releas lock page slice queri pager pager slice queri pager cfs key column slice pager synchron cfs tabl index lock key key column famili pager column famili clone shallow column column cfs index manag index column index add column column cfs index manag index row key key final switch lock read lock unlock privat object index lock byte buffer key return index lock math ab key hash code index lock length public list futur flush list futur futur array list futur column famili store key set futur add column famili store forc flush return futur public static iter tabl return iter transform schema instanc tabl tabl transform public static iter tabl system return iter transform schema instanc system tabl tabl transform public static iter tabl system return iter transform schema system keyspac tabl transform overrid public string string return class simpl 