licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra servic import java lang manag manag factori import java util import java util concurr concurr hash map import java util concurr concurr link queue import java util concurr link block queue import javax manag bean server import javax manag object import org slf logger import org slf logger factori perform latenc consist predict describ href http arxiv org pdf pdf probabilist bound stale practic partial quorum baili predict form replic factor read consist level write consist level read return version version written result latenc predict rough guidelin system oper interfac expos nodetool class accomplish measur latenc read write mont carlo simul predict behavior base latenc captur distribut time coordin send mutat time replica serv valu time replica accept mutat send acknowledg time coordin hear time coordin send read request time replica perform read time replica send read respons time coordin receiv network bound depend network local process time caveat predict onli good latenc collect accur predict requir synchron clock replica collect run sampl latenc latenc chang dramat predict predict conserv worst case predict stale practic follow account read repair account merkl tree exchang multi version stale conserv simul local read write assum coordin cassandra node replica key predict optimist follow predict impact node failur model hint handoff org apach cassandra thrift consist level org apach cassandra locat abstract replic strategi public class predictor implement predictor bean privat static final logger logger logger factori logger predictor class public static final string org apach cassandra servic type predictor privat static final boolean fals privat static final int privat static final int record fix size set latenc read mutat oper store order oper arriv polici evict messag inform store map messag latenc helper class minim number hash map maintain messag class maintain start time messag queue send time repli time send lat correspond repli lat privat class messag latenc collect messag latenc collect long start time start time start time send lat concurr link queue long repli lat concurr link queue long void add send lat long send lat send lat add send lat void add repli lat long repli lat repli lat add repli lat collect long send lat return send lat collect long repli lat return repli lat long start time return start time long start time collect long send lat collect long repli lat replac privat final queue string write messag id link block queue string privat final queue string read messag id link block queue string privat final map string messag latenc collect messag write lat concurr hash map string messag latenc collect privat final map string messag latenc collect messag read lat concurr hash map string messag latenc collect privat random random privat boolean initi fals privat boolean log latenc privat int max log latenc privat int number trial predict privat static final predictor instanc predictor public static predictor instanc return instanc privat predictor init public void enabl consist predict log log latenc true public void disabl consist predict log log latenc fals public boolean log enabl return log latenc public void set max log latenc consist predict int max log max log latenc max log public void set number trial consist predict int num trial number trial predict num trial public void init initi random random bean server mbs manag factori platform bean server tri mbs regist bean object predictor catch throw runtim initi true random sampl latenc privat long random element list long list list size throw runtim data predict return list random int list size calcul averag latenc read write oper set simul latenc privat float list averag list long list long accum long valu list accum valu return float accum list size calcul percentil entri list privat long percentil list long list float percentil collect sort list return list int list size percentil trial sampl latenc replica number repli replica number number replica data data replic factor random sampl respons time privat long random latenc sampl map integ list long sampl int replica number sampl key replica number return random element sampl replica number return random element sampl sampl key set array random int sampl key set size perform predict random sampl collect latenc simul write follow read exact millisecond afterward count number reorder read write calcul probabl stale record oper latenc public predict result predict int int int float time sinc write int number version stale float percentil latenc throw illeg argument throw illeg argument posit throw illeg argument throw illeg argument posit percentil latenc percentil latenc throw illeg argument percentil latenc inclus number version stale throw illeg argument number version stale posit log latenc throw illeg state latenc log enabl map replica number latenc map integ list long latenc order latenc map integ list long latenc order latenc map integ list long latenc order latenc map integ list long latenc order latenc latenc empti latenc empti throw illeg state write latenc record run local insert latenc empti latenc empti throw illeg state read latenc record run local read storag simul read write latenc array list long read latenc array list long array list long write latenc array list long long consist read storag latenc replica mont carlo trial arr hold ith replica latenc array list long trial latenc array list long array list long trial latenc array list long array list long replica write latenc array list long array list long replica read latenc array list long run repeat trial observ stale int number trial predict simul send write replica send read replica record latenc random sampl gather latenc int replica replica replica long trial latenc random latenc sampl latenc replica long trial latenc random latenc sampl latenc replica trial latenc add trial latenc replica write latenc add trial latenc trial latenc read onli replica pick random read respons latenc int replica replica replica long trial latenc random latenc sampl latenc replica long trial latenc random latenc sampl latenc replica trial latenc add trial latenc replica read latenc add trial latenc trial latenc write latenc trial time wth replica respond collect sort replica write latenc long write latenc replica write latenc write latenc add write latenc array list long sort replica read latenc array list long replica read latenc collect sort sort replica read latenc read latenc trial time rth replica respond read latenc add sort replica read latenc read respons reorder messag coordin pick read messag replica write consist read request time write latenc time sinc write int respons number respons number respons number int replica number replica read latenc index sort replica read latenc respons number write latenc time sinc write trial latenc replica number trial latenc replica number consist read break tombston replica case duplic read latenc replica read latenc set replica number clear storag trial trial latenc clear trial latenc clear replica read latenc clear replica write latenc clear float version consist probabl float consist read number trial predict calcul multi version stale exponenti stale probabl number version float consist probabl float math pow doubl version consist probabl number version stale float averag write latenc list averag write latenc float averag read latenc list averag read latenc long percentil write latenc percentil write latenc percentil latenc long percentil read latenc percentil read latenc percentil latenc return predict result time sinc write number version stale consist probabl averag read latenc averag write latenc percentil read latenc percentil latenc percentil write latenc percentil latenc public void start write oper string log latenc return start write oper system current time milli public void start write oper string long start time log latenc return assert messag write lat key write messag id add replac latenc maximum number entri sloppi accept purpos write messag id size max log latenc string evict write messag id remov messag write lat remov evict messag write lat put messag latenc collect start time public void start read oper string log latenc return start read oper system current time milli public void start read oper string long start time log latenc return assert messag read lat key read messag id add replac latenc maximum number entri sloppi accept purpos read messag id size max log latenc string evict read messag id remov messag read lat remov evict messag read lat put messag latenc collect start time public void log write respons string long construct time log latenc return log write respons construct time system current time milli public void log write respons string long respons creation time long receiv time log latenc return messag latenc collect write lat collect messag write lat write lat collect null return long start time write lat collect start time write lat collect add send lat math max respons creation time start time write lat collect add repli lat math max receiv time respons creation time public void log read respons string long construct time log latenc return log read respons construct time system current time milli public void log read respons string long respons creation time long receiv time log latenc return messag latenc collect read lat collect messag read lat read lat collect null return long start time read lat collect start time read lat collect add send lat math max respons creation time start time read lat collect add repli lat math max receiv time respons creation time map integ list long order latenc collect collect long latenc array list collect long messag latenc collect wlc messag write lat valu latenc add wlc send lat return order latenc latenc map integ list long order latenc collect collect long latenc array list collect long messag latenc collect wlc messag write lat valu latenc add wlc repli lat return order latenc latenc map integ list long order latenc collect collect long latenc array list collect long messag latenc collect rlc messag read lat valu latenc add rlc send lat return order latenc latenc map integ list long order latenc collect collect long latenc array list collect long messag latenc collect rlc messag read lat valu latenc add rlc repli lat return order latenc latenc return collect latenc index respons number messag privat map integ list long order latenc collect collect long latenc list map integ list long ret hash map integ list long vari int max respons collect long latenc latenc list list long sort latenc array list long latenc collect sort sort latenc sort latenc size max respons int max respons sort latenc size ret put vector long max respons sort latenc size index awkward sinc talk ith respons int sort latenc size ret add sort latenc return ret 