licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra config import java nio byte buffer import java nio charset charact code import java secur messag digest import java secur algorithm import java util import googl common collect import org slf logger import org slf logger factori import org apach cassandra auth auth import org apach cassandra import org apach cassandra tabl import org apach cassandra marshal abstract type import org apach cassandra sstabl descriptor import org apach cassandra servic migrat manag import org apach cassandra trace trace import org apach cassandra util byte buffer util import org apach cassandra util pair import org cliffc high scale lib block hash map public class schema privat static final logger logger logger factori logger schema class public static final schema instanc schema longest permiss main concern filenam charact filenam sinc schema compon onli charact longer window entir path greater charact limit avoid problem public static final int metadata map faster tabl lookup privat final map string meta data tabl block hash map string meta data tabl object keyspac onli instanc exist ani keyspac privat final map string tabl tabl instanc block hash map string tabl metadata map faster column famili lookup privat final map pair string string map hash map creat map column famili integ version privat final map integ map hash map creat privat volatil version adb public static final empti version public static final immut set string system keyspac immut set tabl trace auth static tri empti version byte messag digest instanc digest catch algorithm throw assert error initi empti schema object public schema load system tabl param tabl def system tabl definit return support chain call public schema load collect meta data tabl def meta data def tabl def load def return load specif keyspac schema param keyspac def keyspac load return support chain call public schema load meta data keyspac def meta data cfm keyspac def meta data valu load cfm set tabl definit keyspac def return tabl instanc param tabl tabl return tabl object null tabl public tabl tabl instanc string tabl return tabl instanc tabl store tabl instanc schema param tabl tabl instanc store throw illeg argument tabl alreadi store public void store tabl instanc tabl tabl tabl instanc key tabl throw illeg argument string format tabl alreadi initi tabl tabl instanc put tabl tabl remov tabl schema param tabl tabl remov return remov tabl instanc null wasn public tabl remov tabl instanc string tabl return tabl instanc remov tabl remov tabl definit system param ksm tabl definit remov public void clear tabl definit meta data ksm tabl remov ksm tabl column famili column famili meta data tabl column famili valid function return null param tabl tabl param column famili return column famili metadata object null wasn public meta data meta data string tabl string assert tabl null meta data ksm tabl tabl return ksm null null ksm meta data column famili metadata identifi param column famili identifi return metadata column famili public meta data meta data pair string string return null null meta data left public meta data meta data descriptor descriptor return meta data descriptor ksname descriptor cfname type column famili keyspac param keyspac param column famili return type column famili public column famili type column famili type string string assert null null meta data meta data meta data return meta data null null meta data type column compar column famili keyspac param keyspac param column famili return compar column famili public abstract type compar string string assert null meta data cfmd meta data cfmd null throw illeg argument unknown column famili keyspac return cfmd compar compar column famili param keyspac param column famili return compar column famili public abstract type compar string string assert null return meta data subcolumn compar valu valid specif column param keyspac param column famili param column column return valu valid specif column default public abstract type valu valid string string byte buffer column return meta data valu valid column metadata tabl param tabl tabl return tabl metadata null wasn public meta data meta data string tabl assert tabl null return tabl tabl return collect system tabl public list string system tabl return immut list copi set differ tabl key set system keyspac metadata tabl param tabl tabl return tabl metadata null wasn public meta data tabl definit string tabl return meta data tabl metadata tabl column famili param tabl tabl return metadata column famili belong tabl public map string meta data tabl meta data string tabl assert tabl null meta data ksm tabl tabl assert ksm null return ksm meta data return collect tabl regist system system system public set string tabl return tabl key set return collect metadata tabl regist system system system public collect meta data tabl definit return tabl valu updat insert tabl definit param ksm metadata tabl public void set tabl definit meta data ksm assert ksm null tabl put ksm ksm column famili queri control method public void add map integ null return map put public convert integ throw unknown column famili map null throw unknown column famili column famili identifi null return public integ convert return map valu map invers null param identifi column famili lookup return ksname cfname pair null drop public pair string string return map invers lookup keyspac column famili identifi param keyspac param column famili return ksname cfname pair null drop public string string return map pair creat load individu column famili definit schema column famili lookup faster param cfm column famili definit load public void load meta data cfm pair string string key pair creat cfm cfm map key key throw runtim string format attempt load alreadi load column famili cfm cfm logger debug ad map cfm map put key cfm column famili data evict schema param cfm column famili definit evict public void purg meta data cfm map remov pair creat cfm cfm version control return current schema version public version return version read schema system tabl calcul digest everi row result digest convert act content base version schema public void updat version tri messag digest version digest messag digest instanc row row system tabl serial schema invalid schema row row ignor schema row row continu row updat digest version digest version byte version digest digest system tabl updat schema version version catch throw runtim updat version announc gossip public void updat version announc updat version migrat manag passiv announc version clear metadata reset version public synchron void clear string tabl system tabl meta data ksm tabl definit tabl meta data cfm ksm meta data valu purg cfm clear tabl definit ksm updat version announc public static boolean invalid schema row row row return row null row mark delet row empti public static boolean ignor schema row row row tri return system keyspac byte buffer util string row key key catch charact code throw runtim 