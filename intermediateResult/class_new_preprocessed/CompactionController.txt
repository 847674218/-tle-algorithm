licens apach softwar foundat contributor licens agreement file distribut work addit inform regard copyright ownership licens file apach licens version licens file complianc licens obtain copi licens http www apach org licens requir applic law agre write softwar distribut licens distribut express impli licens specif languag govern permiss limit licens packag org apach cassandra compact import java util collect import java util collect import java util list import java util set import org slf logger import org slf logger factori import org apach cassandra config databas descriptor import org apach cassandra column famili import org apach cassandra column famili store import org apach cassandra data tracker import org apach cassandra decor key import org apach cassandra sstabl tabl ident iter import org apach cassandra sstabl tabl reader import org apach cassandra servic cach servic import org apach cassandra servic storag servic import org apach cassandra util throttl manag compact option public class compact control privat static final logger logger logger factori logger compact control class public final column famili store cfs privat final data tracker tabl interv tree overlap tree privat final set tabl reader overlap tabl public final int befor public final int merg shard befor privat final throttl throttl throttl cassandra throttl throttl throughput function return instantan throughput target byte millisecond public int target throughput databas descriptor compact throughput sec storag servic instanc bootstrap mode throttl disabl return total throughput int total byte databas descriptor compact throughput sec stream throughput target byte return total byte math max compact manag instanc activ compact public compact control column famili store cfs collect tabl reader sstabl int befor cfs befor cfs refer overlap tabl sstabl constructor subclass overrid purg overlap tree protect compact control column famili store cfs int max valu cfs max valu null privat compact control column famili store cfs int befor set tabl reader overlap tabl assert cfs null cfs cfs befor befor merg counter increment activ memtabl renew befor creation oldest unflush memtabl add minut safe side term thread safeti fine current stop write dure memtabl switch situat merg shard befor int cfs oldest unflush memtabl overlap tabl overlap tabl null collect tabl reader empti set overlap tabl overlap tree overlap tabl null null data tracker build interv tree overlap tabl public string keyspac return cfs tabl public string column famili return cfs column famili return true drop tombston row verison row includ compact set public boolean purg decor key key long max delet timestamp list tabl reader filter tabl overlap tree search key tabl reader sstabl filter tabl sstabl bloom filter present key key sstabl min timestamp max delet timestamp return fals return true public void invalid cach row decor key key cfs invalid cach row key public void remov delet cach decor key key copi cach serial updat cach row raci updat ignor sinc updat row invalid odd tombston consum memori indefinit problem minim https issu apach org jira brows discuss cach servic instanc row cach put copi return column famili cach row cfs raw cach row key cach row null column famili store remov delet cach row befor return abstract compact row implement write merg row question singl sourc row data current version sstabl don purg aren forc deseri scrub write unchang otherwis deseri purg tombston reseri latest version public abstract compact row compact row list tabl ident iter row long row size tabl ident iter row row row size row data size row size databas descriptor memori compact limit string key string cfs metadata key valid string row key key logger info string format compact larg row byte increment cfs tabl cfs column famili key string row size return lazili compact row row return precompact row row conveni method singl sstabl compact public abstract compact row compact row tabl ident iter row return compact row collect singleton list row public void throttl long current byte throttl throttl current byte public void close tabl reader releas refer overlap tabl 